import{j as e,T as a,l as p,ag as d,E as y,V as w,b as j,I as v,a0 as N}from"./index-hfxJ9ND0.js";import{A as b}from"./alert-CiGfdPyF.js";import{E as k}from"./empty-list-DT5Cphlr.js";import{u}from"./useQuery--Ee6qBmG.js";import{u as _,c as S,P as R,g as A}from"./paginated-table-B6jlOu_g.js";import"./side-panel-provider-DzwNjgZ0.js";import{M as g}from"./main-BHTg64jE.js";import{P as C,a as P}from"./preview_list-b9qBPjsx.js";import"./useBaseQuery-CSwYJmhT.js";import"./Table-WVLjXGgi.js";import"./pagination-DmVTMMJU.js";const z="/assets/preview_error-C8aVnTl9.svg",I="/assets/preview_notification-CAba5nmY.svg",T="/assets/preview_error-63_jv1Kp.svg",E="/assets/preview_notification-htPxRhTs.svg",L=[{title:"Monitor Your Kloset Store",description:"We only collect non-sensitive metadata. Your backup contents are never sent to us.",src:P,darkSrc:C},{title:"Alerts",description:"Get error notifications so you can keep your backups secure.",src:T,darkSrc:z},{title:"Weekly Summaries",description:"Receive a concise activity summary in your inbox.",src:E,darkSrc:I}];function F(){return e.jsx(g,{className:"h-full",children:e.jsxs("div",{className:"m-auto flex h-full w-full flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(a,{variant:"heading",size:"xl",weight:"medium",className:"text-primary",children:"Alerting"}),e.jsx(a,{size:"md",className:"text-secondary",children:"Log in to plakar.io to access the alerting features. Get reports and notifications about your Kloset store activity. For free."})]}),e.jsx("div",{className:"mb-16 mt-8 w-full overflow-auto text-center",children:e.jsx("ol",{"aria-label":"Authenticated features",className:"inline-flex list-none gap-4",children:L.map((r,i)=>e.jsx(K,{...r},i))})}),e.jsx(p,{href:{to:"/login",search:{returnUrl:"/alerting"}},className:"w-full max-w-sm",children:"Sign in"})]})})}function K({title:r,description:i,src:l,darkSrc:s}){return e.jsxs("li",{className:"border-primary bg-primary w-70 flex max-w-sm flex-col items-center gap-1 rounded-2xl border p-2",children:[e.jsx("img",{src:l,alt:r,loading:"lazy",className:"w-66 block h-40 max-w-none dark:hidden"}),e.jsx("img",{src:s,alt:r,loading:"lazy",className:"w-66 hidden h-40 max-w-none dark:block"}),e.jsxs("div",{className:"flex flex-col items-center py-2",children:[e.jsx(a,{size:"md",className:"text-secondary",weight:"medium",children:r}),e.jsx(a,{size:"sm",className:"text-tertiary",children:i})]})]})}function J(){const r=d.useNavigate(),i=d.useSearch(),l=d.useLoaderData().item,s=u(N());return s.data?.__type==="unauthenticated"?e.jsx(F,{}):e.jsx(g,{title:"Alerting",description:"Follow the activity of your Kloset store.",children:e.jsx("div",{className:"flex flex-col gap-4",children:s.isPending?e.jsx(y,{}):s.isError?e.jsx(k,{illustrationType:"sad",title:"Unable to load alerting configuration",description:s.error.message,actions:[{children:"Retry",onPress:()=>s.refetch(),variant:"secondary"}]}):s.data.__type==="ok"&&e.jsxs(e.Fragment,{children:[!s.data.configuration.enabled&&e.jsx(b,{title:"Alerting is disabled",variant:"warning",actions:[e.jsx(p,{variant:"secondary",href:{to:"/settings"},children:"Go to settings"},"settings-button")],children:"The alerting service is currently disabled. You can enable it in the settings."}),e.jsx(M,{repository:l.configuration.repository_id.Value,page:i.page,perPage:i.per_page,onPageChange:(c,o)=>r({search:m=>({...m,page:m.per_page!==o?0:c,per_page:o})})})]})})})}function M({repository:r,page:i,perPage:l,onPageChange:s}){const c=u({...w({repository:r,page:i,perPage:l}),select:t=>{if(t.__type==="unauthenticated")throw new Error("You should be authenticated to list reports");return t}}),o=S(),m={pageIndex:i,pageSize:l},x=_({data:c.isSuccess&&c.data.__type==="ok"?c.data.items:[],columns:[o.display({id:"status",meta:{cellClassName:"md:w-[20%]"},header:()=>"Status",cell:t=>{const n=t.row.original,h={OK:"success-circle",WARNING:"warning-triangle",FAILURE:"error-circle",unknown:"info-circle"}[n.report_task.status],f={OK:"text-success",WARNING:"text-warning",FAILURE:"text-error",unknown:""}[n.report_task.status];return e.jsxs("span",{className:"flex flex-col gap-1",children:[e.jsxs(a,{as:"span",size:"md",className:j("flex items-center gap-1 capitalize",f),children:[e.jsx(v,{type:h,size:"md"}),t.row.original.report_task.type.HumanString]}),e.jsx(a,{as:"span",className:"text-secondary",size:"sm",children:t.row.original.report_task.duration.toHumanString()?e.jsxs(e.Fragment,{children:["Completed in"," ",t.row.original.report_task.duration.toHumanString()]}):e.jsx(e.Fragment,{children:"Completed almost instantly"})})]})}}),o.accessor("report_task.name",{meta:{cellClassName:"md:w-[20%]"},header:()=>"Name",cell:t=>{const n=t.getValue();return e.jsx(a,{as:"span",className:"text-primary",children:n==="@agent"||n==="@agentless"?"":n})}}),o.display({meta:{cellClassName:"md:w-[20%]"},id:"timeline",header:()=>"Timeline",cell:t=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(a,{as:"span",className:"text-primary whitespace-nowrap",children:t.row.original.timestamp.relativeToNow()}),e.jsx(a,{as:"span",className:"text-secondary",size:"sm",children:t.row.original.timestamp.toHumanString()})]})})}),o.display({id:"output",header:()=>"Output",cell:t=>e.jsx(e.Fragment,{children:t.row.original.report_task.status!=="OK"&&e.jsx(a,{as:"span",className:"text-primary",size:"sm",children:t.row.original.report_task.error_message})})})],state:{pagination:m},enableRowSelection:!1,enableMultiRowSelection:!1,getRowId:t=>t.id,manualPagination:!0,onPaginationChange:t=>{const n=typeof t=="function"?t(m):t;s(n.pageIndex,n.pageSize)},getCoreRowModel:A()});return e.jsx(R,{query:c,table:x,ariaLabel:"Reports table",variant:"cards",skeleton:"two-rows"})}export{J as component};
