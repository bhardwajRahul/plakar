import{r as w,ao as m,U as b,j as e,T as d,ap as h,aq as j}from"./index-BJrYkkbA.js";import{A as v}from"./alert-B__-qerL.js";import{E as S,a as N}from"./expandable-list-aoQn2xko.js";import{F as R}from"./filters-BWL2AiQB.js";import{I}from"./id-CWkxw1na.js";import{T}from"./tag-B4RmpwG4.js";import{u as f}from"./useQuery-DFVQRQYW.js";import{c as E,u as z,g as C,P as L}from"./paginated-table-NottqT0_.js";import"./side-panel-provider-DxsBlxMi.js";import{M as P}from"./main-CAAnIMo1.js";import"./select-B37njsdh.js";import"./useBaseQuery-CDY4cYzC.js";import"./Table-79HwOb_A.js";import"./useToggleState-C9KbMpY2.js";import"./empty-list-C7hzuEv3.js";const _="This repository uses a non-browsable storage, snapshots cannot be inspected.";function J(){const[o,c]=w.useState({}),u=m.useLoaderData(),g=m.useNavigate(),n=m.useSearch(),l=f(b({importer:n.importer,page:n.page,perPage:n.per_page})),p=E(),r=[p.display({id:"identifier",header:()=>"ID",cell:a=>{const t=a.row.original,s=t.identifier.Value,y=t.total.errors;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(I,{value:s,className:"text-primary"}),e.jsx(S,{length:y})]})}}),p.accessor("timestamp",{header:()=>"Date",cell:a=>{const t=a.getValue();return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(d,{variant:"body",size:"md",className:"text-primary whitespace-nowrap",children:t.relativeToNow()}),e.jsx(d,{variant:"body",size:"sm",className:"text-secondary",children:t.toHumanString()})]})}}),p.display({id:"importer-type",header:()=>"Source",meta:{cellClassName:"w-[60%] max-w-0"},cell:({row:{original:a}})=>{const t=a.tags.filter(s=>s.trim());return e.jsxs("div",{className:"flex w-full min-w-0 items-baseline gap-4",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(N,{items:a.sources.map(s=>({tag:s.importer.type,value:s.importer.origin,subValue:s.importer.directory.toHumanString()}))})}),t.length>0&&e.jsx("span",{className:"flex min-w-0 max-w-[40%] flex-initial flex-wrap items-start gap-1",children:t.filter(s=>s.trim()).map(s=>e.jsx(T,{size:"sm",variant:"blue",children:s},s))})]})}}),p.accessor("total",{id:"summary",header:()=>"Stats",cell:a=>{const t=a.getValue();return e.jsxs("div",{className:"flex flex-col gap-1 whitespace-nowrap",children:[e.jsx(d,{variant:"body",size:"md",className:"text-primary",children:t.size.Pretty}),e.jsxs(d,{variant:"body",size:"sm",className:"text-secondary",children:[t.files," ",t.files===1?"item":"items"]})]})}})],i={pageIndex:n.page,pageSize:n.per_page},x=z({data:l.data?.items??[],rowCount:l.data?.total,columns:r,state:{pagination:i,rowSelection:o},onRowSelectionChange:c,enableMultiRowSelection:!1,onPaginationChange:a=>{const t=typeof a=="function"?a(i):a;g({search:s=>({...s,page:s.per_page!==t.pageSize?0:t.pageIndex,per_page:t.pageSize})})},manualPagination:!0,getCoreRowModel:C()});return e.jsx(P,{title:"Kloset Repository",description:"List your backups, browse their contents, and restore the files you need.",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[!u.browsable&&e.jsx(v,{title:"This snapshot repository is not browsable.",variant:"warning",children:_}),e.jsx(L,{query:l,table:x,filters:e.jsx(A,{}),variant:"cards",skeleton:"two-rows",getLink:a=>({to:"/snapshots/$snapshotId/browse",params:{snapshotId:a.identifier.Value},search:{path:a.sources.length===1?a.sources[0].importer.directory.Value:void 0}}),ariaLabel:"Snapshots table"})]})})}function A(){const o=m.useSearch(),c=m.useNavigate(),{data:u,isPending:g,isError:n}=f(j()),l=u?.items.map(r=>({id:r.name,name:r.name}))||[],p=[{key:"importer",value:o.importer}];return e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(h,{label:"Applied filters",onRemove:r=>{c({search:i=>({...i,importer:r.has("importer")?"":i.importer,page:0})})},children:p.map(({key:r,value:i})=>i?e.jsx(h.Item,{id:r,value:p.find(({key:x})=>x===o.importer)?.value||o.importer},r):null)}),e.jsx(R,{items:[{id:"importer",label:"Source type",options:l,isInvalid:!!o.importer&&!l.some(r=>r.id===o.importer),isDisabled:g||n||l.length===0}],defaultSelected:{importer:o.importer||null},onApply:r=>{c({search:i=>({...i,importer:r.importer||"",page:0})})}})]})}export{J as component};
