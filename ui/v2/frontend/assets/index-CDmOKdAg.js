import{j as e,T as u,K as p,P as N,Q as D,U as _,v as P,b as d,S as h,f as R,s as T,r as A,I as y,V as C,i as E,W as L,H as M}from"./index-BJrYkkbA.js";import{u as g}from"./useQuery-DFVQRQYW.js";import"./side-panel-provider-DxsBlxMi.js";import{M as V}from"./main-CAAnIMo1.js";import{E as j}from"./empty-list-C7hzuEv3.js";import{u as H}from"./use-breakpoint-BDq3u2OF.js";import{$ as O,a as U,b as f,c as F,d as I,e as x}from"./Table-79HwOb_A.js";import{E as Q,a as G}from"./expandable-list-aoQn2xko.js";import{I as K}from"./id-CWkxw1na.js";import"./useBaseQuery-CDY4cYzC.js";import"./tag-B4RmpwG4.js";const W=(s,t,r,n)=>{const o=(r-n*2)/(t-1);return n+s*o},Y=(s,t,r,n,o)=>{const i=r-n*2-o;if(t===0)return r-n-o;const c=i/t,a=r-n-s*c,l=s===0?a-o:a;return Math.max(l,o)},B=s=>{if(s.length<2)return"";let t=`M ${s[0].x},${s[0].y}`;for(let r=1;r<s.length;r++){const n=s[r-1],o=s[r],i=(n.x+o.x)/2,c=i,a=n.y,l=i,m=o.y;t+=` C ${c},${a} ${l},${m} ${o.x},${o.y}`}return t};function X({data:s=[],width:t=100,height:r=100,strokeWidth:n=3,padding:o=0}){if(!s.length)return null;const i=n/2,c=Math.max(...s.map(v=>v.value)),a=s.map((v,z)=>({x:W(z,s.length,t,o),y:Y(v.value,c,r,o,i)})),l=B(a),m=`${l} L ${a[a.length-1].x},${r-o} L ${a[0].x},${r-o} Z`;return e.jsxs("svg",{width:t,height:r,children:[e.jsx("path",{d:m,className:"fill-background-accent-tertiary"}),e.jsx("path",{d:l,fill:"none",className:"stroke-border-accent",strokeWidth:n})]})}function q({value:s=0,size:t=100,strokeWidth:r=10}){const n=Math.max(0,Math.min(100,s)),o=(t-r)/2,i=2*Math.PI*o,c=i*(1-(n*.97+1)/100),a=t/2,l={cx:a,cy:a,r:o,strokeWidth:r,fill:"transparent"};return e.jsxs("div",{className:"relative",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,children:[e.jsx("circle",{...l,className:"stroke-border-secondary"}),n>0&&n<100&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{...l,className:"stroke-border-accent",strokeDasharray:i,strokeDashoffset:c,strokeLinecap:"butt",transform:`rotate(-90 ${a} ${a})`}),e.jsx("circle",{...l,className:"stroke-border-accent",strokeDasharray:`0 ${i}`,strokeDashoffset:c,strokeLinecap:"round",transform:`rotate(-90 ${a} ${a})`})]}),n===100&&e.jsx("circle",{...l,className:"stroke-border-accent",strokeDasharray:360})]}),e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsxs(u,{variant:"body",size:"md",className:"text-primary",monospace:!0,children:[Math.round(n),"%"]})})]})}function J({repositoryId:s}){const t=g(D({repository:s,page:0,perPage:5})),r=()=>{t.refetch()},n={OK:"check",WARNING:"exclamation",FAILURE:"close",unknown:"cloud"},o={OK:"success",WARNING:"warning",FAILURE:"error",unknown:"default"},c=t.data?.__type!=="unauthenticated"?{children:"View all",href:{to:"/alerting"},rightIcon:"arrow-up-right"}:{children:"Sign in to view",href:{to:"/login"},rightIcon:"arrow-up-right"};return e.jsxs(p,{children:[e.jsx(p.Header,{title:"Latest alerting reports",buttonProps:c}),e.jsx(p.Content,{children:e.jsxs(N,{loading:t.isPending,children:[t.error&&e.jsx(j,{illustrationType:"sad",title:"Unable to load the latest alerting reports",description:t.error.message,actions:[{children:"Retry",onPress:r,variant:"secondary"}]}),t.isSuccess&&(t.data.__type==="unauthenticated"?e.jsx(j,{illustrationType:"emperor",title:"Sign in to enable Alerts",description:"Get notified when backups, restores, checks, or maintenance tasks complete or fail.",actions:[{children:"Sign in",href:{to:"/login"},variant:"primary"}]}):t.data.items.length===0?e.jsx(j,{illustrationType:"waving",title:"You don't have any alerting reports yet",description:`Enable alerting to start receiving reports automatically
                  whenever you run backups, restores, checks, or maintenance
                  tasks.`}):t.data.items.map(a=>e.jsx(N.Item,{icon:n[a.report_task.status],status:o[a.report_task.status],title:a.report_task.type.HumanString,description:a.report_task.error_message||"Success",alt:a.timestamp.relativeToNow()},a.id)))]})})]})}const w=30;function Z({label:s,value:t,footer:r}){return e.jsxs("div",{children:[e.jsx(u,{variant:"body",size:"md",className:"text-tertiary mb-3",children:s}),e.jsx(u,{as:"p",variant:"heading",size:"md",className:"text-primary",children:t}),r&&e.jsx(u,{variant:"body",size:"sm",className:"text-tertiary",children:r})]})}function $({label:s,value:t,footer:r,chart:n,className:o}){return e.jsxs("div",{className:`flex justify-between gap-2 ${o}`,children:[e.jsx(Z,{label:s,value:t,footer:r}),n&&e.jsx("div",{className:"flex w-[120px] items-center justify-center",children:n})]})}const ee=()=>e.jsx("div",{className:"bg-border-secondary h-px w-full md:h-full md:w-px"});function te(s){const t=new Date;return t.setDate(t.getDate()-s),t.setHours(0,0,0,0),t}function se(){const{data:s}=g(P()),t=s?.item?.snapshots,{data:r}=g(_({page:0,perPage:1,since:te(w)})),n=s?.item.snapshots.snapshots_per_day.map(a=>({value:a})),o=[e.jsx($,{label:"Total snapshots",value:t?.total??0,footer:r&&`${r.total} over the last ${w} days`,chart:n&&e.jsx(X,{data:n,width:120,height:88})},"snapshots"),t?.logical_size&&e.jsx($,{label:"Logical size",value:t.logical_size.Pretty,footer:t?.storage_size===null?void 0:`${t.storage_size.Pretty} storage size`,chart:t.efficiency!==null&&e.jsx(q,{value:t.efficiency,size:88,strokeWidth:8})},"size")],i=o.flatMap((a,l)=>l<o.length-1?[a,e.jsx(ee,{},`divider-${l}`)]:[a]),c=i.map((a,l)=>l%2===0?"1fr":"1px").join(" ");return e.jsx(p,{children:e.jsx(p.Content,{padding:"lg",children:e.jsx("div",{className:"flex flex-col gap-3 md:grid md:gap-4",style:{gridTemplateColumns:c},children:i})})})}function ae({children:s,className:t}){return e.jsxs(O,{"aria-label":"Snapshots",className:d("text-primary w-full table-auto border-spacing-x-4",t),children:[e.jsxs(U,{className:"sr-only",children:[e.jsx(f,{isRowHeader:!0,children:"ID"}),e.jsx(f,{children:"Source"}),e.jsx(f,{children:"Date modified"}),e.jsx(f,{children:"Size"}),e.jsx(f,{})]}),e.jsx(F,{children:s})]})}function re({id:s,dateModified:t,timeSince:r,sources:n,size:o,itemsLength:i,errorsLength:c,snapshotLink:a}){const l=i!==void 0?`${i} ${i>1?"items":"item"}`:void 0;return e.jsxs(I,{className:d("border-secondary group mx-4 border-b last:border-0",a&&"cursor-pointer"),href:a,children:[e.jsx(x,{className:"py-4 pr-2 align-top",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(K,{value:s}),e.jsx(Q,{length:c})]})}),e.jsx(x,{className:d("align-top",n&&"w-[40%] max-w-0 px-2 py-4"),children:n&&e.jsx(G,{items:n.map(m=>({tag:m.type,value:m.origin??"",subValue:m.directory}))})}),e.jsx(x,{className:d("align-top",r&&"px-2 py-4"),children:e.jsx(k,{value:r,subValue:t})}),e.jsx(x,{className:d("align-top",o&&"px-2 py-4"),children:e.jsx(k,{value:o,subValue:l})}),e.jsx(x,{className:d("w-[36px] align-top",a&&"px-2 py-4"),children:a&&e.jsx("div",{className:"h-[36px] w-[36px]",children:e.jsx("div",{className:"invisible group-hover:visible max-md:visible",children:e.jsx(R,{"aria-label":"View snapshot",icon:"arrow-right",variant:"tertiary",href:a,tooltip:"View snapshot"})})})})]})}function k({value:s,subValue:t}){return!s&&!t?null:e.jsxs("div",{className:"flex flex-col gap-1",children:[s&&e.jsx(u,{variant:"body",size:"md",weight:"medium",className:"md:overflow-hidden md:text-ellipsis md:whitespace-nowrap",children:s}),t&&e.jsx(u,{variant:"body",size:"sm",className:"text-secondary md:overflow-hidden md:text-ellipsis md:whitespace-nowrap",children:t})]})}function ne({withSources:s=!0,withTimeSince:t=!0,withSize:r=!0,withSnapshotLink:n=!0}){return e.jsxs(I,{className:"border-secondary mx-4 border-b last:border-0",children:[e.jsx(x,{className:"py-4 pr-2 align-top",children:e.jsx(h,{variant:"text",size:"md"})}),e.jsx(x,{className:d(s&&"w-[40%] max-w-0 px-2 py-4"),children:s&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(h,{variant:"text",size:"md"}),e.jsx(h,{variant:"text",size:"sm"})]})}),e.jsx(x,{className:d(t&&"px-2 py-4"),children:t&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(h,{variant:"text",size:"md"}),e.jsx(h,{variant:"text",size:"sm"})]})}),e.jsx(x,{className:d(r&&"px-2 py-4"),children:r&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(h,{variant:"text",size:"md"}),e.jsx(h,{variant:"text",size:"sm"})]})}),e.jsx(x,{className:d(n&&"w-[36px] px-2 py-4")})]})}const b=Object.assign(ae,{Row:re,RowSkeleton:ne}),S=10,oe={children:"View all",href:{to:"/snapshots"},rightIcon:"arrow-up-right"};function ie(){const{isMdUp:s}=H(),{data:t,isPending:r,isError:n,refetch:o,error:i}=g(_({page:0,perPage:S})),c=!t?.items||t?.items.length===0;return e.jsxs(p,{children:[e.jsx(p.Header,{title:"Latest snapshots",buttonProps:oe}),e.jsx(p.Content,{noPaddingY:!0,children:r?e.jsx(b,{children:[...Array(S).keys()].map(a=>e.jsx(b.RowSkeleton,{withSources:s,withSize:s},a))}):n?e.jsx(j,{illustrationType:"sad",title:"Unable to load the latest snapshots",description:i.message,actions:[{children:"Retry",onPress:()=>o(),variant:"secondary"}]}):c?e.jsx(j,{illustrationType:"default_nut",title:"No snapshots yet",description:"There are no snapshots available in this Kloset repository."}):e.jsx(b,{children:t.items.map(a=>e.jsx(b.Row,{id:a.identifier.Value,sources:s?a.sources.map(l=>({type:l.importer.type,origin:l.importer.origin,directory:l.importer.directory.Value})):void 0,timeSince:a.timestamp.relativeToNow(),dateModified:a.timestamp.toHumanString(),size:s?a.total.size.Pretty:void 0,itemsLength:s?a.total.files:void 0,errorsLength:a.total.errors,snapshotLink:{to:"/snapshots/$snapshotId/browse",params:{snapshotId:a.identifier.Value},search:{path:`${a.sources[0].importer.directory.Value}`}}},a.identifier.Value))})})]})}function le(){const[s,t]=T("plakar_demo_info_seen",!1),[r,n]=A.useState(!s),o=()=>{n(i=>!i),t(!0)};return e.jsxs("div",{className:"z-100 fixed bottom-6 right-6 flex items-end justify-end md:bottom-8 md:right-8",children:[e.jsx(u,{as:"div",className:d("border-accent bg-primary text-primary z-99 absolute bottom-12 right-0 w-80 overflow-hidden rounded-xl rounded-br-none border p-4 pb-0 shadow-xl transition-all duration-300 ease-out",r?"translate-x-0 opacity-100":"translate-x-60 opacity-0"),children:e.jsxs("div",{className:"relative flex flex-col gap-2",children:[e.jsxs("p",{children:["Welcome to ",e.jsx("b",{children:"Plakar UI demo"}),"!"]}),e.jsxs("p",{children:["This is a playground with ",e.jsx("b",{children:"real data"}),", already signed in to a"," ",e.jsx("b",{children:"demo account"}),"."]}),e.jsxs("p",{children:["Want to keep your data safe? Check out"," ",e.jsx("a",{href:"https://plakar.io/",target:"_blank",className:"text-accent hover:text-accent-hover hover:underline",children:"plakar.io"}),"."]}),e.jsxs("ul",{className:"bg-accent-tertiary -mx-4 mt-1 px-4 py-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(y,{type:"discord",size:"md"}),e.jsxs("p",{children:["Join us on"," ",e.jsx("a",{href:"https://discord.gg/uuegtnF2Q5",target:"_blank",className:"text-accent hover:text-accent-hover hover:underline",children:"Discord"}),"!"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(y,{type:"github",size:"md"})," ",e.jsxs("p",{children:["Star us on"," ",e.jsx("a",{href:"https://github.com/PlakarKorp/plakar",target:"_blank",className:"text-accent hover:text-accent-hover hover:underline",children:"GitHub"}),"!"]})]})]}),e.jsx(C,{type:"waving",className:"absolute -bottom-6 -right-8",width:120})]})}),e.jsx(E,{"aria-label":r?"Close demo info":"Open demo info",className:d("bg-accent text-on-brand z-100 flex cursor-pointer rounded-full px-3 py-3 shadow-xl","hover:bg-accent-hover transition-transform duration-200 ease-in-out hover:scale-105",!r&&"rounded-br-none"),onPress:o,children:r?e.jsx(y,{type:"close",size:"md"}):e.jsx(y,{type:"info-circle",size:"md"})})]})}function be(){const s=L.useLoaderData().item,{data:{demo_mode:t}={}}=g(M());return e.jsxs(V,{title:"Your dashboard",description:"An overview of your data.",children:[e.jsxs("div",{className:"grid gap-3 lg:grid-cols-[2fr_1fr] lg:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:gap-4",children:[e.jsx(se,{}),e.jsx(ie,{})]}),e.jsx("div",{children:e.jsx(J,{repositoryId:s.configuration.repository_id.Value})})]}),t&&e.jsx(le,{})]})}export{be as component};
