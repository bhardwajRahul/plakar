import{j as e,T as f,a5 as h,a6 as N,v as _,w as P,a7 as I,b as x,S as u,t as R,f as T,x as A,r as C,I as b,a8 as E,i as L,a9 as M,X as V}from"./index-CdIc90l8.js";import{u as y}from"./useQuery-BzyMkyU9.js";import{M as O}from"./icon-badge-CJfylEPM.js";import{E as g}from"./empty-list-DCGZXt7T.js";import{R as H}from"./proxy.reporting.reports-BU0VhLis.js";import{u as F}from"./use-breakpoint-vkVmt92D.js";import{$ as U,a as Q,b as j,c as G,d as z,e as m}from"./Table-DqT_aCgx.js";import{E as K,a as Y}from"./expandable-list-DJZPiymV.js";import"./useBaseQuery-Cr4gMxig.js";const W=(s,t,r,a)=>{const o=(r-a*2)/(t-1);return a+s*o},B=(s,t,r,a,o)=>{const c=r-a*2-o;if(t===0)return r-a-o;const l=c/t,n=r-a-s*l,d=s===0?n-o:n;return Math.max(d,o)},X=s=>{if(s.length<2)return"";let t=`M ${s[0].x},${s[0].y}`;for(let r=1;r<s.length;r++){const a=s[r-1],o=s[r],c=(a.x+o.x)/2,l=c,n=a.y,d=c,i=o.y;t+=` C ${l},${n} ${d},${i} ${o.x},${o.y}`}return t};function q({data:s=[],width:t=100,height:r=100,strokeWidth:a=3,padding:o=0}){if(!s.length)return null;const c=a/2,l=Math.max(...s.map(p=>p.value)),n=s.map((p,D)=>({x:W(D,s.length,t,o),y:B(p.value,l,r,o,c)})),d=X(n),i=`${d} L ${n[n.length-1].x},${r-o} L ${n[0].x},${r-o} Z`;return e.jsxs("svg",{width:t,height:r,children:[e.jsx("path",{d:i,className:"fill-background-accent-tertiary"}),e.jsx("path",{d,fill:"none",className:"stroke-border-accent",strokeWidth:a})]})}function J({value:s=0,size:t=100,strokeWidth:r=10}){const a=Math.max(0,Math.min(100,s)),o=(t-r)/2,c=2*Math.PI*o,l=c*(1-(a*.97+1)/100),n=t/2,d={cx:n,cy:n,r:o,strokeWidth:r,fill:"transparent"};return e.jsxs("div",{className:"relative",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,children:[e.jsx("circle",{...d,className:"stroke-border-secondary"}),a>0&&a<100&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{...d,className:"stroke-border-accent",strokeDasharray:c,strokeDashoffset:l,strokeLinecap:"butt",transform:`rotate(-90 ${n} ${n})`}),e.jsx("circle",{...d,className:"stroke-border-accent",strokeDasharray:`0 ${c}`,strokeDashoffset:l,strokeLinecap:"round",transform:`rotate(-90 ${n} ${n})`})]}),a===100&&e.jsx("circle",{...d,className:"stroke-border-accent",strokeDasharray:360})]}),e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsxs(f,{variant:"body",size:"md",className:"text-primary",monospace:!0,children:[Math.round(a),"%"]})})]})}function Z({repositoryId:s}){const t=y(H({repository:s,page:0,perPage:5})),r=()=>{t.refetch()},a={OK:"check",WARNING:"exclamation",FAILURE:"close",unknown:"cloud"},o={OK:"success",WARNING:"warning",FAILURE:"error",unknown:"default"},l=t.data?.__type!=="unauthenticated"?{children:"View all",href:{to:"/alerting"},rightIcon:"arrow-up-right"}:{children:"Sign in to view",href:{to:"/login"},rightIcon:"arrow-up-right"};return e.jsxs(h,{children:[e.jsx(h.Header,{title:"Latest alerting reports",buttonProps:l}),e.jsx(h.Content,{children:e.jsxs(N,{loading:t.isPending,children:[t.error&&e.jsx(g,{illustrationType:"sad",title:"Unable to load the latest alerting reports",description:t.error.message,actions:[{children:"Retry",onPress:r,variant:"secondary"}]}),t.isSuccess&&(t.data.__type==="unauthenticated"?e.jsx(g,{illustrationType:"emperor",title:"Sign in to enable Alerts",description:"Get notified when backups, restores, checks, or maintenance tasks complete or fail.",actions:[{children:"Sign in",href:{to:"/login"},variant:"primary"}]}):t.data.items.length===0?e.jsx(g,{illustrationType:"waving",title:"You don't have any alerting reports yet",description:`Enable alerting to start receiving reports automatically
                  whenever you run backups, restores, checks, or maintenance
                  tasks.`}):t.data.items.map(n=>e.jsx(N.Item,{icon:a[n.report_task.status],status:o[n.report_task.status],title:n.report_task.type.HumanString,description:n.report_task.error_message||"Success",alt:n.timestamp.relativeToNow()},n.id)))]})})]})}const w=30;function ee({label:s,value:t,footer:r}){return e.jsxs("div",{children:[e.jsx(f,{variant:"body",size:"md",className:"text-tertiary mb-3",children:s}),e.jsx(f,{as:"p",variant:"heading",size:"md",className:"text-primary",children:t}),r&&e.jsx(f,{variant:"body",size:"sm",className:"text-tertiary",children:r})]})}function $({label:s,value:t,footer:r,chart:a,className:o}){return e.jsxs("div",{className:`flex justify-between gap-2 ${o}`,children:[e.jsx(ee,{label:s,value:t,footer:r}),a&&e.jsx("div",{className:"flex w-[120px] items-center justify-center",children:a})]})}const te=()=>e.jsx("div",{className:"bg-border-secondary h-px w-full md:h-full md:w-px"});function se(s){const t=new Date;return t.setDate(t.getDate()-s),t.setHours(0,0,0,0),t}function ae(){const{api:s,repository:t}=_(),{data:r}=y(P(s,{repository:t})),a=r?.item?.snapshots,{data:o}=y(I(s,{repository:t,pagination:{page:0,perPage:1},since:se(w)})),c=r?.item.snapshots.snapshots_per_day.map(i=>({value:i})),l=[e.jsx($,{label:"Total snapshots",value:a?.total??0,footer:o&&`${o.total} over the last ${w} days`,chart:c&&e.jsx(q,{data:c,width:120,height:88})},"snapshots"),a?.logical_size&&e.jsx($,{label:"Logical size",value:a.logical_size.Pretty,footer:a?.storage_size===null?void 0:`${a.storage_size.Pretty} storage size`,chart:a.efficiency!==null&&e.jsx(J,{value:a.efficiency,size:88,strokeWidth:8})},"size")],n=l.flatMap((i,p)=>p<l.length-1?[i,e.jsx(te,{},`divider-${p}`)]:[i]),d=n.map((i,p)=>p%2===0?"1fr":"1px").join(" ");return e.jsx(h,{children:e.jsx(h.Content,{padding:"lg",children:e.jsx("div",{className:"flex flex-col gap-3 md:grid md:gap-4",style:{gridTemplateColumns:d},children:n})})})}function re({children:s,className:t}){return e.jsxs(U,{"aria-label":"Snapshots",className:x("text-primary w-full table-auto border-spacing-x-4",t),children:[e.jsxs(Q,{className:"sr-only",children:[e.jsx(j,{isRowHeader:!0,children:"ID"}),e.jsx(j,{children:"Source"}),e.jsx(j,{children:"Date modified"}),e.jsx(j,{children:"Size"}),e.jsx(j,{})]}),e.jsx(G,{children:s})]})}function ne({id:s,dateModified:t,timeSince:r,sources:a,size:o,itemsLength:c,errorsLength:l,snapshotLink:n}){const d=c!==void 0?`${c} ${c>1?"items":"item"}`:void 0;return e.jsxs(z,{className:x("border-secondary group mx-4 border-b last:border-0",n&&"cursor-pointer"),href:n,children:[e.jsx(m,{className:"py-4 pr-2 align-top",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{value:s}),e.jsx(K,{length:l})]})}),e.jsx(m,{className:x("align-top",a&&"w-[40%] max-w-0 px-2 py-4"),children:a&&e.jsx(Y,{items:a.map(i=>({tag:i.type,value:i.origin??"",subValue:i.directory}))})}),e.jsx(m,{className:x("align-top",r&&"px-2 py-4"),children:e.jsx(k,{value:r,subValue:t})}),e.jsx(m,{className:x("align-top",o&&"px-2 py-4"),children:e.jsx(k,{value:o,subValue:d})}),e.jsx(m,{className:x("w-[36px] align-top",n&&"px-2 py-4"),children:n&&e.jsx("div",{className:"h-[36px] w-[36px]",children:e.jsx("div",{className:"invisible group-hover:visible max-md:visible",children:e.jsx(T,{"aria-label":"View snapshot",icon:"arrow-right",variant:"tertiary",href:n,tooltip:"View snapshot"})})})})]})}function k({value:s,subValue:t}){return!s&&!t?null:e.jsxs("div",{className:"flex flex-col gap-1",children:[s&&e.jsx(f,{variant:"body",size:"md",weight:"medium",className:"md:overflow-hidden md:text-ellipsis md:whitespace-nowrap",children:s}),t&&e.jsx(f,{variant:"body",size:"sm",className:"text-secondary md:overflow-hidden md:text-ellipsis md:whitespace-nowrap",children:t})]})}function oe({withSources:s=!0,withTimeSince:t=!0,withSize:r=!0,withSnapshotLink:a=!0}){return e.jsxs(z,{className:"border-secondary mx-4 border-b last:border-0",children:[e.jsx(m,{className:"py-4 pr-2 align-top",children:e.jsx(u,{variant:"text",size:"md"})}),e.jsx(m,{className:x(s&&"w-[40%] max-w-0 px-2 py-4"),children:s&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(u,{variant:"text",size:"md"}),e.jsx(u,{variant:"text",size:"sm"})]})}),e.jsx(m,{className:x(t&&"px-2 py-4"),children:t&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(u,{variant:"text",size:"md"}),e.jsx(u,{variant:"text",size:"sm"})]})}),e.jsx(m,{className:x(r&&"px-2 py-4"),children:r&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(u,{variant:"text",size:"md"}),e.jsx(u,{variant:"text",size:"sm"})]})}),e.jsx(m,{className:x(a&&"w-[36px] px-2 py-4")})]})}const v=Object.assign(re,{Row:ne,RowSkeleton:oe}),S=10,ie={children:"View all",href:{to:"/snapshots"},rightIcon:"arrow-up-right"};function ce(){const{isMdUp:s}=F(),{api:t,repository:r}=_(),{data:a,isPending:o,isError:c,refetch:l,error:n}=y(I(t,{repository:r,pagination:{page:0,perPage:S}})),d=!a?.items||a?.items.length===0;return e.jsxs(h,{children:[e.jsx(h.Header,{title:"Latest snapshots",buttonProps:ie}),e.jsx(h.Content,{noPaddingY:!0,children:o?e.jsx(v,{children:[...Array(S).keys()].map(i=>e.jsx(v.RowSkeleton,{withSources:s,withSize:s},i))}):c?e.jsx(g,{illustrationType:"sad",title:"Unable to load the latest snapshots",description:n.message,actions:[{children:"Retry",onPress:()=>l(),variant:"secondary"}]}):d?e.jsx(g,{illustrationType:"default_nut",title:"No snapshots yet",description:"There are no snapshots available in this Kloset repository."}):e.jsx(v,{children:a.items.map(i=>e.jsx(v.Row,{id:i.identifier.Value,sources:s?i.sources.map(p=>({type:p.importer.type,origin:p.importer.origin,directory:p.importer.directory.Value})):void 0,timeSince:i.timestamp.relativeToNow(),dateModified:i.timestamp.toHumanString(),size:s?i.total.size.Pretty:void 0,itemsLength:s?i.total.files:void 0,errorsLength:i.total.errors,snapshotLink:{to:"/snapshots/$snapshotId/browse",params:{snapshotId:i.identifier.Value},search:{path:`${i.sources[0].importer.directory.Value}`}}},i.identifier.Value))})})]})}function le(){const[s,t]=A("plakar_demo_info_seen",!1),[r,a]=C.useState(!s),o=()=>{a(c=>!c),t(!0)};return e.jsxs("div",{className:"z-100 fixed bottom-6 right-6 flex items-end justify-end md:bottom-8 md:right-8",children:[e.jsx(f,{as:"div",className:x("border-accent bg-primary text-primary z-99 absolute bottom-12 right-0 w-80 overflow-hidden rounded-xl rounded-br-none border p-4 pb-0 shadow-xl transition-all duration-300 ease-out",r?"translate-x-0 opacity-100":"translate-x-60 opacity-0"),children:e.jsxs("div",{className:"relative flex flex-col gap-2",children:[e.jsxs("p",{children:["Welcome to ",e.jsx("b",{children:"Plakar UI demo"}),"!"]}),e.jsxs("p",{children:["This is a playground with ",e.jsx("b",{children:"real data"}),", already signed in to a"," ",e.jsx("b",{children:"demo account"}),"."]}),e.jsxs("p",{children:["Want to keep your data safe? Check out"," ",e.jsx("a",{href:"https://plakar.io/",target:"_blank",className:"text-accent hover:text-accent-hover hover:underline",children:"plakar.io"}),"."]}),e.jsxs("ul",{className:"bg-accent-tertiary -mx-4 mt-1 px-4 py-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(b,{type:"discord",size:"md"}),e.jsxs("p",{children:["Join us on"," ",e.jsx("a",{href:"https://discord.gg/uuegtnF2Q5",target:"_blank",className:"text-accent hover:text-accent-hover hover:underline",children:"Discord"}),"!"]})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(b,{type:"github",size:"md"})," ",e.jsxs("p",{children:["Star us on"," ",e.jsx("a",{href:"https://github.com/PlakarKorp/plakar",target:"_blank",className:"text-accent hover:text-accent-hover hover:underline",children:"GitHub"}),"!"]})]})]}),e.jsx(E,{type:"waving",className:"absolute -bottom-6 -right-8",width:120})]})}),e.jsx(L,{"aria-label":r?"Close demo info":"Open demo info",className:x("bg-accent text-on-brand z-100 flex cursor-pointer rounded-full px-3 py-3 shadow-xl","hover:bg-accent-hover transition-transform duration-200 ease-in-out hover:scale-105",!r&&"rounded-br-none"),onPress:o,children:r?e.jsx(b,{type:"close",size:"md"}):e.jsx(b,{type:"info-circle",size:"md"})})]})}function ye(){const s=M.useLoaderData().item,{data:{demo_mode:t}={}}=y(V());return e.jsxs(O,{icon:"house",iconBadgeType:"accent",title:"Your dashboard",description:"An overview of your data.",children:[e.jsxs("div",{className:"grid gap-3 lg:grid-cols-[2fr_1fr] lg:gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:gap-4",children:[e.jsx(ae,{}),e.jsx(ce,{})]}),e.jsx("div",{children:e.jsx(Z,{repositoryId:s.configuration.repository_id.Value})})]}),t&&e.jsx(le,{})]})}export{ye as component};
