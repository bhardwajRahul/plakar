import{r as b,aD as m,w as j,a7 as S,j as e,t as N,T as g,m as R,v as I,aE as T,aF as h}from"./index-CdIc90l8.js";import{A as E}from"./alert-SgQz-3jM.js";import{E as P,a as z}from"./expandable-list-DJZPiymV.js";import{F as A}from"./filters-D5JKT-uH.js";import{u as y}from"./useQuery-BzyMkyU9.js";import{u as C}from"./useSuspenseQuery-D9MoHFrL.js";import{M as _}from"./icon-badge-CJfylEPM.js";import{c as Q,u as k,g as M,P as O}from"./paginated-table-BobOAkaF.js";import"./useBaseQuery-Cr4gMxig.js";import"./Table-DqT_aCgx.js";import"./empty-list-DCGZXt7T.js";import"./pagination-DnzyOhfo.js";const V="This repository uses a non-browsable storage, snapshots cannot be inspected.";function Y(){const[o,c]=b.useState({}),x=m.useNavigate(),n=m.useSearch(),d=m.useRouteContext(),l=C(j(d.klosetAPI,{repository:void 0})).data.item.browsable,p=y(S(d.klosetAPI,{repository:void 0,importer:n.importer,pagination:{page:n.page,perPage:n.per_page}})),s=Q(),i=[s.display({id:"identifier",header:()=>"ID",cell:t=>{const a=t.row.original,r=a.identifier.Value,v=a.total.errors;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(N,{value:r,className:"text-primary"}),e.jsx(P,{length:v})]})}}),s.accessor("timestamp",{header:()=>"Date",cell:t=>{const a=t.getValue();return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(g,{variant:"body",size:"md",className:"text-primary whitespace-nowrap",children:a.relativeToNow()}),e.jsx(g,{variant:"body",size:"sm",className:"text-secondary",children:a.toHumanString()})]})}}),s.display({id:"importer-type",header:()=>"Source",meta:{cellClassName:"w-[60%] max-w-0 min-w-80"},cell:({row:{original:t}})=>{const a=t.tags.filter(r=>r.trim());return e.jsxs("div",{className:"flex w-full min-w-0 items-baseline gap-4",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(z,{items:t.sources.map(r=>({tag:r.importer.type,value:r.importer.origin,subValue:r.importer.directory.toHumanString()}))})}),a.length>0&&e.jsx("span",{className:"flex min-w-0 max-w-[40%] flex-initial flex-wrap items-start gap-1",children:a.filter(r=>r.trim()).map(r=>e.jsx(R,{size:"sm",variant:"blue_borderless",radius:"sqrt",children:r},r))})]})}}),s.accessor("total",{id:"summary",header:()=>"Stats",cell:t=>{const a=t.getValue();return e.jsxs("div",{className:"flex flex-col gap-1 whitespace-nowrap",children:[e.jsx(g,{variant:"body",size:"md",className:"text-primary",children:a.size.Pretty}),e.jsxs(g,{variant:"body",size:"sm",className:"text-secondary",children:[a.files," ",a.files===1?"item":"items"]})]})}})],u={pageIndex:n.page,pageSize:n.per_page},w=k({data:p.data?.items??[],rowCount:p.data?.total,columns:i,state:{pagination:u,rowSelection:o},onRowSelectionChange:c,enableMultiRowSelection:!1,onPaginationChange:t=>{const a=typeof t=="function"?t(u):t;x({search:r=>({...r,page:r.per_page!==a.pageSize?0:a.pageIndex,per_page:a.pageSize})})},manualPagination:!0,getCoreRowModel:M()});return e.jsx(_,{icon:"folder-tree",iconBadgeType:"stores",title:"Snapshots",description:"Browse backups and restore files.",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[!l&&e.jsx(E,{title:"This snapshot repository is not browsable.",variant:"warning",children:V}),e.jsx(O,{query:p,table:w,filters:e.jsx(L,{}),variant:"cards",skeleton:"two-rows",getLink:l?t=>({to:"/snapshots/$snapshotId/browse",params:{snapshotId:t.identifier.Value},search:{path:t.sources.length===1?t.sources[0].importer.directory.Value:void 0}}):void 0,ariaLabel:"Snapshots table"})]})})}function L(){const o=m.useSearch(),c=m.useNavigate(),{api:x}=I(),{data:n,isPending:d,isError:f}=y(T(x,{repository:void 0})),l=n?.items.map(s=>({id:s.name,name:s.name}))||[],p=[{key:"importer",value:o.importer}];return e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(h,{label:"Applied filters",onRemove:s=>{c({search:i=>({...i,importer:s.has("importer")?"":i.importer,page:0})})},children:p.map(({key:s,value:i})=>i?e.jsx(h.Item,{id:s,value:p.find(({key:u})=>u===o.importer)?.value||o.importer},s):null)}),e.jsx(A,{items:[{id:"importer",label:"Source type",options:l,isInvalid:!!o.importer&&!l.some(s=>s.id===o.importer),isDisabled:d||f||l.length===0}],defaultSelected:{importer:o.importer||null},onApply:s=>{c({search:i=>({...i,importer:s.importer||"",page:0})})}})]})}export{Y as component};
