import{j as e,b as j,I,T as f,D as fe,$ as Q,d as K,e as G,f as H,h as $,i as W,k as Y,l as k,m as he,q as J,S as P,u as me,r as g,n as ge,N as x,o as pe,p as xe,M as v,L as be,s as je,t as ve,v as ye,w as we,x as Ne,A as E,y as X,z as Ce,C as Le,E as He,F as ke,H as ee,J as te,K as Se,O as se,P as b,Q as Ie,U as F,V as Pe,W as Ae,X as ne,Y as _e,Z as ze,_ as R,a0 as ae,a1 as w,a2 as Me,a3 as $e,a4 as Ve}from"./index-CdIc90l8.js";import{u as N}from"./useQuery-BzyMkyU9.js";import{u as ie}from"./use-breakpoint-vkVmt92D.js";import{u as De,a as V}from"./use-side-panel-BrdU6Uh4.js";import{A as Oe}from"./proxy.account.me-CFcDkCU0.js";import{E as Te}from"./empty-list-DCGZXt7T.js";import{u as Ze}from"./use-api-CL3-sM9D.js";import"./useBaseQuery-Cr4gMxig.js";function Ee(t){const s=t.split(" ");return s.length===0?"":s.length===1?s[0].substring(0,2).toUpperCase():s[0].charAt(0).toUpperCase()+s[1].charAt(0).toUpperCase()}function S({icon:t,text:s,url:n,isLoading:a,isOffline:o,className:l}){return e.jsxs("div",{className:j("relative size-8 shrink-0 lg:size-9",l),children:[e.jsx("div",{className:"bg-accent inline-flex h-full w-full shrink-0 flex-col items-center justify-center overflow-hidden rounded-full align-top",children:a?e.jsx("div",{className:"bg-accent-secondary h-full w-full animate-pulse"}):t?e.jsx(I,{type:t,size:"lg",className:"text-on-brand"}):e.jsx(f,{as:"div",size:"sm",weight:"medium",className:"text-on-brand",children:n?e.jsx("img",{src:n,alt:s,className:"h-full w-full object-cover"}):s?Ee(s):e.jsx("img",{alt:"Nestor Doe",src:fe,className:"mr-0.5 mt-4 max-w-12"})})}),o!==void 0&&e.jsx("div",{className:j("border-1 border-background-primary absolute -bottom-0.5 -right-0.5 size-3 rounded-full",a?"bg-warning":o?"bg-error":"bg-success")})]})}function Fe(){return e.jsxs(f,{as:"div",size:"sm",className:"bg-accent-tertiary text-accent grid grid-cols-[auto_1fr] gap-x-2 rounded-md px-2 py-1",children:[e.jsx("div",{className:"row-start-1 flex items-center",children:e.jsx(I,{type:"info-circle",size:"sm"})}),e.jsx("p",{className:"row-start-1",children:e.jsx("strong",{children:"Demo Mode"})}),e.jsx(f,{size:"xs",className:"text-secondary col-start-2 row-start-2",children:"You're signed in as a demo user."})]})}function Re({open:t,setOpen:s,title:n,children:a}){return e.jsx(Q,{isDismissable:!0,isOpen:t,onOpenChange:s,className:"text-primary fixed inset-0 z-50 bg-black/50 data-[entering]:animate-[modal-blur_300ms] data-[exiting]:animate-[modal-blur_300ms_reverse_ease-in]",children:e.jsx(K,{className:"bg-primary fixed inset-y-0 right-0 w-full max-w-2xl overflow-y-scroll p-4 shadow-lg data-[entering]:animate-[modal-slide_300ms] data-[exiting]:animate-[modal-slide_300ms_reverse_ease-in]",children:e.jsxs(G,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-4",children:[e.jsx(f,{variant:"heading",size:"md",slot:"title",children:n}),e.jsx(H,{icon:"close",slot:"close",variant:"tertiary"})]}),a]})})})}function qe({text:t,color:s="accent",underline:n="always",children:a}){return e.jsx($,{label:t,offset:2,maxWidth:400,children:e.jsx(W,{className:j("cursor-help decoration-dashed decoration-1 underline-offset-2 hover:underline",s==="accent"&&"text-accent hover:text-accent-hover",s==="inherit"&&"hover:opacity-80",n==="always"&&"underline"),children:a})})}const Ue="/assets/plakar-illustration-hello-CUlCX5j7.svg";function re({href:t,onClick:s}){const n=!t;return e.jsxs("div",{className:"bg-accent grid grid-cols-[1fr_auto] items-center rounded-sm",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-0.5 py-2 pl-3",children:[e.jsxs(f,{className:"text-on-brand",weight:"medium",size:"sm",children:[n?"Sign in":e.jsx(Y,{href:t,onPress:s,className:"hover:text-on-brand/80 underline",children:"Sign in"})," ","to get access to all features"]}),e.jsx(f,{className:"text-on-brand",size:"xs",children:"Magic link or GitHub"})]}),e.jsx("div",{className:"self-end",children:e.jsx("img",{alt:"plakar.io",src:Ue,className:"h-[70px] w-[90px]"})})]}),n&&e.jsx(k,{leftIcon:"right-to-bracket",variant:"accent-tertiary",className:"mr-2 sm:mr-6",onClick:s,slot:"close",children:"Sign in"})]})}const Be="data:image/svg+xml,%3csvg%20width='71'%20height='14'%20viewBox='0%200%2071%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2013.2324V0.767555H5.38035C8.14965%200.767555%2010.006%202.52043%2010.006%205.17409C10.006%207.85818%208.10096%209.53193%205.25863%209.53193H3.38402V13.2324H0ZM3.38402%206.90262H4.57695C5.76379%206.90262%206.4759%206.2392%206.4759%205.17409C6.4759%204.10289%205.76379%203.4699%204.57695%203.4699H3.38402V6.90262Z'%20fill='white'/%3e%3cpath%20d='M11.2476%2013.2324V0.767555H14.6316V10.5058H19.6712V13.2324H11.2476Z'%20fill='white'/%3e%3cpath%20d='M24.277%2013.2324H20.6252L24.7396%200.767555H29.3652L33.4796%2013.2324H29.8278L29.1096%2010.8466H24.9952L24.277%2013.2324ZM25.7621%208.31466H28.3427L27.1011%204.20027H27.0037L25.7621%208.31466Z'%20fill='white'/%3e%3cpath%20d='M34.6801%2013.2324V0.767555H38.0642V5.80707H38.2346L41.9838%200.767555H45.9278L41.716%206.31833L46.0251%2013.2324H41.9838L39.1841%208.55811L38.0642%2010.0188V13.2324H34.6801Z'%20fill='white'/%3e%3cpath%20d='M50.17%2013.2324H46.5181L50.6325%200.767555H55.2582L59.3726%2013.2324H55.7207L55.0025%2010.8466H50.8882L50.17%2013.2324ZM51.655%208.31466H54.2357L52.994%204.20027H52.8967L51.655%208.31466Z'%20fill='white'/%3e%3cpath%20d='M60.5731%2013.2324V0.767555H65.9535C68.7227%200.767555%2070.5791%202.35001%2070.5791%205.00367C70.5791%206.7322%2069.7879%207.94339%2068.461%208.58246L70.993%2013.2324H67.3168L65.1257%209.11806H63.9571V13.2324H60.5731ZM63.9571%206.48875H65.1501C66.3369%206.48875%2067.049%206.06879%2067.049%205.00367C67.049%203.93247%2066.3369%203.4699%2065.1501%203.4699H63.9571V6.48875Z'%20fill='white'/%3e%3c/svg%3e",Qe="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='24'%20height='24'%20rx='12'%20fill='%230F172A'/%3e%3cpath%20d='M17.4287%209.9511C17.1909%209.19212%2016.801%208.50159%2016.2956%207.91434C16.6544%207.64774%2016.8869%207.21841%2016.8869%206.73504C16.8869%205.92562%2016.2354%205.26992%2015.4325%205.26992C14.7744%205.26992%2014.2189%205.71005%2014.0395%206.31352C13.3975%206.06252%2012.7001%205.92502%2011.9705%205.92502C11.3131%205.92502%2010.6812%206.0373%2010.0929%206.24266C9.89205%205.67583%209.35441%205.26992%208.72258%205.26992C7.91908%205.26992%207.26818%205.92622%207.26818%206.73504C7.26818%207.16077%207.44819%207.54386%207.73609%207.81167C7.18652%208.41993%206.76451%209.14709%206.51237%209.9505V9.95171C4.35701%2010.2015%202.68326%2012.0455%202.68326%2014.2834C2.68326%2016.6919%204.62166%2018.6446%207.01247%2018.6446C8.08181%2018.6446%209.05995%2018.2531%209.81516%2017.6058L13.3385%2017.613L14.1235%2017.6082C14.8787%2018.2543%2015.8557%2018.6446%2016.9238%2018.6446C19.3146%2018.6446%2021.253%2016.6919%2021.253%2014.2834C21.253%2012.0467%2019.5817%2010.2033%2017.4287%209.9511ZM11.9693%206.85933C12.3723%206.85933%2012.7633%206.91218%2013.137%207.01666L12.4194%209.84783C12.3979%209.93309%2012.3288%209.99134%2012.2489%209.99013C12.0933%209.98773%2011.8388%209.98833%2011.6832%209.99074C11.6034%209.99194%2011.5342%209.93369%2011.5122%209.84843L10.7993%207.01846C11.1748%206.91278%2011.5658%206.85933%2011.9687%206.85933H11.9693ZM12.7281%2012.0053L12.2596%2012.4232C12.0933%2012.5715%2011.8424%2012.5715%2011.6761%2012.4232L11.2076%2012.0053C10.9042%2011.7345%2011.0943%2011.2301%2011.4996%2011.2301H12.4367C12.842%2011.2301%2013.0315%2011.7351%2012.7287%2012.0053H12.7281ZM10.0184%209.70672C10.3486%209.70672%2010.6163%2010.0718%2010.6163%2010.5227C10.6163%2010.9737%2010.3486%2011.3388%2010.0184%2011.3388C9.6882%2011.3388%209.42057%2010.9737%209.42057%2010.5227C9.42057%2010.0718%209.6882%209.70672%2010.0184%209.70672ZM14.2225%2015.0076C14.4239%2015.2135%2014.4221%2015.545%2014.2177%2015.7479C14.1164%2015.8488%2013.9846%2015.8987%2013.8523%2015.8987C13.72%2015.8987%2013.5841%2015.8464%2013.4821%2015.7425C13.2074%2015.4621%2013.019%2015.0712%2012.9362%2014.6281C12.5922%2014.7013%2012.2411%2014.7386%2011.8901%2014.7386C11.5896%2014.7386%2011.2892%2014.7116%2010.9936%2014.6575C10.9083%2015.088%2010.7218%2015.4681%2010.4535%2015.7425C10.3516%2015.8464%2010.2175%2015.8987%2010.0834%2015.8987C9.94928%2015.8987%209.81934%2015.8482%209.718%2015.7479C9.51355%2015.545%209.51117%2015.2129%209.71324%2015.0076C9.8551%2014.8629%2010.0065%2014.5524%2010.0065%2014.1153C10.0065%2013.7454%209.88669%2013.3905%209.70191%2013.2122C9.49448%2013.0123%209.48792%2012.6808%209.68641%2012.4718C9.8849%2012.2629%2010.2145%2012.2563%2010.4214%2012.4562C10.7063%2012.7312%2010.9072%2013.1359%2010.9954%2013.5905C11.6147%2013.7334%2012.2674%2013.7256%2012.8831%2013.5665L12.9469%2013.5503C13.0393%2013.1119%2013.236%2012.7234%2013.5125%2012.4562C13.72%2012.2563%2014.049%2012.2629%2014.2475%2012.4718C14.446%2012.6808%2014.4394%2013.0123%2014.232%2013.2122C14.0466%2013.3911%2013.9274%2013.7454%2013.9274%2014.1153C13.9274%2014.5524%2014.0788%2014.8629%2014.2213%2015.0076H14.2225ZM13.9179%2011.3382C13.5876%2011.3382%2013.32%2010.9731%2013.32%2010.5221C13.32%2010.0712%2013.5876%209.70612%2013.9179%209.70612C14.2481%209.70612%2014.5157%2010.0712%2014.5157%2010.5221C14.5157%2010.9731%2014.2481%2011.3382%2013.9179%2011.3382Z'%20fill='white'/%3e%3c/svg%3e",Ke="data:image/svg+xml,%3csvg%20width='72'%20height='14'%20viewBox='0%200%2072%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.818226%2013.2324V0.767502H6.19858C8.96788%200.767502%2010.8242%202.52038%2010.8242%205.17404C10.8242%207.85813%208.91919%209.53188%206.07685%209.53188H4.20225V13.2324H0.818226ZM4.20225%206.90257H5.39518C6.58202%206.90257%207.29413%206.23915%207.29413%205.17404C7.29413%204.10283%206.58202%203.46985%205.39518%203.46985H4.20225V6.90257Z'%20fill='%230F172A'/%3e%3cpath%20d='M12.0658%2013.2324V0.767502H15.4499V10.5057H20.4894V13.2324H12.0658Z'%20fill='%230F172A'/%3e%3cpath%20d='M25.0952%2013.2324H21.4434L25.5578%200.767502H30.1835L34.2978%2013.2324H30.646L29.9278%2010.8465H25.8134L25.0952%2013.2324ZM26.5803%208.3146H29.1609L27.9193%204.20022H27.8219L26.5803%208.3146Z'%20fill='%230F172A'/%3e%3cpath%20d='M35.4984%2013.2324V0.767502H38.8824V5.80702H39.0528L42.802%200.767502H46.746L42.5342%206.31827L46.8434%2013.2324H42.802L40.0023%208.55806L38.8824%2010.0188V13.2324H35.4984Z'%20fill='%230F172A'/%3e%3cpath%20d='M50.9882%2013.2324H47.3364L51.4508%200.767502H56.0764L60.1908%2013.2324H56.539L55.8208%2010.8465H51.7064L50.9882%2013.2324ZM52.4733%208.3146H55.0539L53.8123%204.20022H53.7149L52.4733%208.3146Z'%20fill='%230F172A'/%3e%3cpath%20d='M61.3913%2013.2324V0.767502H66.7717C69.541%200.767502%2071.3973%202.34996%2071.3973%205.00362C71.3973%206.73215%2070.6061%207.94334%2069.2793%208.58241L71.8112%2013.2324H68.135L65.9439%209.11801H64.7753V13.2324H61.3913ZM64.7753%206.48869H65.9683C67.1551%206.48869%2067.8672%206.06873%2067.8672%205.00362C67.8672%203.93242%2067.1551%203.46985%2065.9683%203.46985H64.7753V6.48869Z'%20fill='%230F172A'/%3e%3c/svg%3e";function oe({variant:t="full",isDemo:s}){return e.jsxs("div",{className:"relative inline-flex items-center gap-1 align-top",children:[e.jsx("img",{alt:"plakar.io",src:Qe,className:"w-6 shrink-0"}),t==="full"&&e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"plakar.io",src:Ke,className:"dark:hidden"}),e.jsx("img",{alt:"plakar.io",src:Be,className:"hidden dark:block"})]}),s&&e.jsx(he,{size:"sm",radius:"sqrt",variant:"brand",children:"Demo"})]})}const Ge=t=>J({queryKey:["api","discord","server_stats",t],queryFn:async()=>{const a=(await(await fetch(`https://discord.com/api/invites/${t}`)).json())?.profile?.member_count;if(a===void 0)throw new Error("Invalid response from Discord API");return a},refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1});function We({invite:t,variant:s="default"}){const{data:n,isPending:a,isSuccess:o}=N(Ge(t));return e.jsxs("a",{target:"_blank",href:`https://discord.gg/${t}`,className:j("flex min-w-[60px] gap-1 rounded-sm border px-2 py-1",s==="default"?"border-primary bg-secondary text-secondary hover:bg-secondary-hover":"border-text-on-brand/50 text-on-brand"),children:[e.jsx(I,{type:"discord",size:"md",className:"shrink-0"}),a?e.jsx(P,{variant:"text",size:"xs",width:"100%"}):o?e.jsx(f,{variant:"body",size:"xs",monospace:!0,children:n}):e.jsx(f,{variant:"body",size:"xs",children:"Discord"})]})}const Ye=t=>J({queryKey:["api","github","repo_stars",t],queryFn:async()=>{const n=await(await fetch(`https://api.github.com/repos/${t}`)).json();if(n.stargazers_count===void 0)throw new Error("Invalid response from GitHub API");return n.stargazers_count},refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1});function Je({repo:t,variant:s="default"}){const{data:n,isPending:a,isSuccess:o}=N(Ye(t));return e.jsxs("a",{target:"_blank",href:`https://github.com/${t}`,className:j("flex min-w-[60px] gap-1 rounded-sm border px-2 py-1",s==="default"?"border-primary bg-secondary text-secondary hover:bg-secondary-hover":"border-text-on-brand/50 text-on-brand"),children:[e.jsx(I,{type:"github",size:"md",className:"shrink-0"}),a?e.jsx(P,{variant:"text",size:"xs",width:"100%"}):o?e.jsx(f,{variant:"body",size:"xs",monospace:!0,children:n}):e.jsx(f,{variant:"body",size:"xs",children:"GitHub"})]})}function q(t){const s=t.match(/^(v?[^-]+)-(.*)\.([a-f0-9]{7,})$/);return s?{Value:t,Pretty:`${s[1]}-${s[2]}.${s[3].substring(0,7)}`,Channel:`${s[1]}-${s[2]}`}:{Value:t,Pretty:t,Channel:t}}function Xe(t){const s=me();return t.find(o=>s({to:o,fuzzy:!0,pending:!0}))??t.find(o=>s({to:o,fuzzy:!0}))}const le=()=>{const t=g.useContext(ge);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t};function ce({navItems:t,subNavItems:s,isExpanded:n,version:a,isFloating:o,canExpand:l,isDemo:c,user:r,controls:i,footer:h,handleToggle:d,onCloseMenu:m}){const{mode:u,toggleMode:A}=le(),_=n?"full":"icon",z=n&&!o?"chevrons-left":"chevrons-right",O=s.find(p=>p.label==="Logout"),C=s.find(p=>p.label==="Login"),M=s.find(p=>p.label==="Settings");return e.jsxs("div",{className:"flex min-h-full flex-col justify-between gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"ml-2 flex items-baseline justify-between",children:[e.jsx(Y,{href:t[0].href,children:e.jsx(oe,{variant:_,isDemo:c&&n})}),n&&e.jsx(it,{value:a,channel:c})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("span",{className:"flex min-w-0 items-center justify-between gap-2",children:[e.jsxs("span",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("div",{className:"flex w-[39px] justify-center",children:r.isAuthenticated?e.jsx(S,{text:r.name||"",url:r.avatarUrl,isLoading:r.isPending,isOffline:!1}):e.jsx(S,{icon:"incognito",isLoading:r.isPending,isOffline:!0})}),n&&(r.isPending?e.jsx(P,{variant:"text",size:"sm",width:135}):e.jsx(f,{className:"text-tertiary truncate",size:"sm",weight:"medium",children:r.isAuthenticated?r.name||"You are logged in":"Guest"}))]}),n&&e.jsxs("span",{className:"flex items-center gap-2",children:[!r.isAuthenticated&&!r.isPending&&e.jsx(H,{icon:"right-to-bracket",size:"sm",variant:"tertiary",tooltip:"Sign in",href:C?.href}),i]})]}),e.jsx(x,{"aria-label":"main navigation",children:t.map(({subItems:p,...L},T)=>p&&p.length>0?e.jsx(x.Group,{label:L.label,hideTitle:!n,children:p.map((Z,ue)=>e.jsx(x.Item,{...Z,onAction:m},`${Z.label}${ue}`))},`${L.label}${T}`):e.jsx(x.Item,{...L,onAction:m},`${L.label}${T}`))})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[n&&!r.isPending&&e.jsxs(e.Fragment,{children:[c&&r.isAuthenticated&&e.jsx(Fe,{}),!c&&!r.isAuthenticated&&e.jsx(re,{href:C?.href,onClick:m})]}),h&&g.cloneElement(h,{forceClose:!n}),e.jsxs("div",{className:"border-primary flex flex-col gap-8 border-t pt-4",children:[e.jsxs(x,{"aria-label":"settings navigation",children:[e.jsx(x.Item,{"aria-label":"Toggle theme",icon:u.icon,label:u.label,onAction:A,className:"cursor-pointer"}),M&&e.jsx(x.Item,{icon:"gear",label:"Settings",href:M?.href,onAction:m,isSelected:M?.isSelected,isDisabled:!r.isAuthenticated}),r.isAuthenticated?e.jsx(x.Item,{icon:"right-to-bracket",label:"Sign out",href:O?.href,onAction:m,isSelected:O?.isSelected,isDisabled:c}):e.jsx(x.Item,{icon:"right-to-bracket",label:"Sign in",href:C?.href,onAction:m,isSelected:C?.isSelected})]}),e.jsxs("div",{className:"flex h-[26px] justify-between gap-2",children:[n&&e.jsxs("div",{className:"flex w-full items-center justify-center gap-2 lg:justify-start",children:[e.jsx(We,{invite:"uuegtnF2Q5"}),e.jsx(Je,{repo:"PlakarKorp/plakar"})]}),d&&e.jsx(H,{"aria-label":"Toggle sidebar",icon:z,size:"sm",variant:"tertiary",onPress:d,tooltip:"Toggle sidebar",isDisabled:!l,className:j(!n&&"w-full text-center")})]})]})]})]})}function et({subNavItems:t,user:s,isDemo:n=!1}){const{mode:a,toggleMode:o}=le(),l=t.find(i=>i.label==="Logout"),c=t.find(i=>i.label==="Login"),r=t.find(i=>i.label==="Settings");return e.jsxs(pe,{children:[e.jsx(W,{"aria-label":"Profile",className:"cursor-pointer",children:s.isAuthenticated?e.jsx(S,{text:s.name||"",url:s.avatarUrl,isLoading:s.isPending,isOffline:!1}):e.jsx(S,{icon:"incognito",isOffline:!0})}),!s.isPending&&e.jsx(xe,{placement:"bottom end",offset:4,children:e.jsxs(v,{children:[e.jsx(v.Item,{leftIcon:a.icon,label:a.label,onAction:o,className:"cursor-pointer"}),s.isAuthenticated?e.jsxs(e.Fragment,{children:[r&&e.jsx(v.Item,{leftIcon:"gear",label:"Settings",href:r.href}),e.jsx(v.Item,{leftIcon:"right-to-bracket",label:"Sign out",href:l?.href,isDisabled:n})]}):e.jsx(v.Item,{leftIcon:"right-to-bracket",label:"Sign in",href:c?.href})]})})]})}function tt(t){const[s,n]=g.useState(!1),{navItems:a,subNavItems:o,user:l,isDemo:c}=t,r=a.flatMap(i=>i.subItems||i).find(i=>i.isSelected);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"border-primary bg-primary flex items-center justify-between border-b p-2 pl-4 lg:hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{to:"/",children:e.jsx(oe,{variant:"icon"})}),e.jsx(k,{variant:"tertiary",leftIcon:"bars",size:"sm",onPress:()=>n(!0),children:r?.label})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(et,{subNavItems:o,user:l,isDemo:c})})]}),e.jsx(Q,{isOpen:s,onOpenChange:n,className:"z-2 fixed inset-0 bg-black/50 data-[entering]:animate-[modal-fade_150ms] data-[exiting]:animate-[modal-fade_reverse_150ms] xl:hidden",isDismissable:!0,children:e.jsx(K,{className:"bg-primary w-70 fixed left-0 h-full overflow-auto shadow-xl data-[entering]:animate-[modal-slide-right_200ms_ease-out] data-[exiting]:animate-[modal-slide-right_150ms_reverse_ease-in]",children:e.jsx(G,{"aria-label":"Navigation",className:"h-full overflow-y-auto p-4",children:e.jsx(ce,{...t,isExpanded:!0,isFloating:!1,canExpand:!1,onCloseMenu:()=>n(!1)})})})})]})}function st(){const{position:t}=De(),{preview:s}=je({strict:!1}),{is3xlDown:n}=ie();return!!s&&t==="horizontal"&&n}function nt(t){const{isLgUp:s,isXlUp:n}=ie(),a=st(),[o,l]=g.useState(!0),[c,r]=g.useState(!1);if(!s)return e.jsx(tt,{...t});const i=!a&&n,h=o&&i||c,d=c&&!(o&&i)||!s,m=!a,u=()=>{r(!0)},A=()=>{r(!1)},_=()=>{l(z=>!z),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("aside",{className:j("border-primary bg-primary z-2 absolute h-full overflow-y-auto border-r p-4",h?"w-70":"w-18",d&&"shadow-xl"),onMouseEnter:u,onMouseLeave:A,children:e.jsx(ce,{...t,isExpanded:h,isFloating:d,canExpand:i,handleToggle:_})}),e.jsx("div",{className:j("h-full",h&&!d?"w-70":"w-18",m&&"transition-[width] duration-150 ease-out")})]})}function at({children:t,...s}){return e.jsxs("div",{className:"flex h-full min-h-0 flex-col overflow-hidden lg:flex-row",children:[e.jsx(nt,{...s}),e.jsx("div",{className:"relative h-full min-h-0 flex-1",children:e.jsx("main",{className:"h-full overflow-auto",children:t})})]})}function it({value:t,channel:s=!1}){const n=s?q(t).Channel:q(t).Pretty,a=e.jsx(f,{as:o=>e.jsx("button",{...o}),variant:"body",size:"xs",className:"text-tertiary",children:n});return n!==t?e.jsx($,{label:t,children:a}):a}const U=[{label:"Dashboard",href:{to:"/"},icon:"house"},{label:"Snapshots",href:{to:"/snapshots"},icon:"folder-tree"},{label:"Alerting",href:{to:"/alerting"},icon:"list-check"},{label:"Analytics",href:{to:"/analytics"},icon:"chart-pie"},{label:"Integrations",href:{to:"/integrations"},icon:"plug"}],B=[{label:"Login",href:{to:"/login"}},{label:"Logout",href:{to:"/logout"}},{label:"Settings",href:{to:"/settings"}}],y=()=>e.jsx(P,{variant:"text",size:"xs"});function rt({repositoryInfo:t,isPending:s}){const n=t?.configuration,a=t?.location;return s?[{label:"ID",value:y()},{label:"Location",value:y()},{label:"Chunking",value:y()},{label:"Compression",value:y()},{label:"Encryption",value:y()}]:[{label:"ID",value:e.jsx(ve,{value:n?.repository_id?.Value??"-",size:"xs",className:"h-4"})},{label:"Location",value:a?e.jsx($,{label:a,children:e.jsx("span",{role:"button",children:a})}):"-"},{label:"Chunking",value:n?.chunking?.algorithm??"Chunking disabled",tooltip:"A chunking algorithm splits data into smaller pieces, or “chunks,” based on specific rules (e.g., fixed size or content-defined). This enables efficient deduplication by identifying and eliminating redundant data. Plakar currently uses FastCDC, a fast and content-aware chunking algorithm."},{label:"Compression",value:n?.compression?.algorithm??"Not compressed",tooltip:"A compression algorithm reduces the size of data by encoding patterns and redundancies, helping save storage space and speed up transfers. Different algorithms offer trade-offs between speed, compression ratio, and resource usage. Plakar currently uses LZ4, a high-speed compression algorithm optimized for fast storage and retrieval."},{label:"Encryption",value:n?.encryption?.data_algorithm??"Not encrypted",tooltip:"An encryption algorithm protects data by transforming it into an unreadable format, ensuring confidentiality and integrity. In encrypted repositories, the only way to access the data is with the correct passphrase — without it, the data remains completely inaccessible."}]}function ot({label:t,value:s,tooltip:n}){return e.jsx(X.Item,{title:n?e.jsx(qe,{text:n,color:"inherit",children:t}):t,description:s})}function lt({forceClose:t}){const{api:s}=ye(),{isPending:n,isError:a,data:o}=N(we(s,{repository:void 0})),[l,c]=Ne("kloset-desription-open",!0),r=rt({repositoryInfo:o?.item,isPending:n});return a?null:e.jsx(E,{defaultExpandedKeys:l?["kloset"]:[],expandedKeys:t||!l?[]:["kloset"],className:"border-primary overflow-hidden border-t pl-3 pr-2 pt-4",children:e.jsx(E.Item,{id:"kloset",title:"Kloset store",icon:"box-archive",onExpandedChange:()=>c(!l),children:e.jsx("div",{className:"pt-1",children:e.jsx(X,{direction:"row",size:"xs",singleColumn:!0,children:r.map(i=>e.jsx(ot,{label:i.label,value:i.value,tooltip:i.tooltip},i.label))})})})})}const ct=["info","warning","error","critical"],dt=["unread","read","pinned","discarded"],ut=te({id:b(),user_id:b(),level:b().transform(t=>ct.includes(t)?t:"unknown"),type:b(),status:b().transform(t=>dt.includes(t)?t:"unknown"),code:b(),message:b(),details:Ie(),created_at:b().transform(F),updated_at:b().transform(F),flags:se().transform(t=>({isBanner:!!(t&1)}))}),ft=te({total:se(),items:Se(ut)});async function ht({repository:t,pagination:s,status:n}){let a;const o=new URLSearchParams({...Le(s),repository_id:t,reverse:"1"});n&&o.set("status",n);const l=`/api/proxy/v1/account/notifications?${o}`,c=await He(()=>ee(l),ke);if(c.error)return{__type:"unauthenticated"};try{a=await c.data.json()}catch{throw new Error(`the API endpoint ${l} returned HTTP/${c.data.status} with an invalid JSON payload`)}return{__type:"ok",notifications:ft.parse(a)}}const D=({repository:t,status:s})=>Ce({queryKey:["api","api.plakar.io","account","getAccountNotifications",t,s],refetchInterval:60*1e3,queryFn:async({pageParam:n})=>({...await ht({repository:t,pagination:{page:n.page,perPage:n.perPage},status:s}),page:n.page,perPage:n.perPage}),initialPageParam:{page:0,perPage:50},getNextPageParam:n=>n.notifications===void 0||(n.page+1)*n.perPage>=n.notifications.total?null:{page:n.page+1,perPage:n.perPage}});async function mt({notificationIds:t,status:s}){await ee("/api/proxy/v1/account/notifications/set-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notification_ids:t,status:s})})}function de(){const t=Pe();return Ae({mutationFn:async(...s)=>{if((await t.ensureQueryData(ne())).demo_mode)throw new Error("It is not possible to mark notifications as read in demo mode.");return mt(...s)},onSuccess:()=>{t.invalidateQueries({queryKey:["api","api.plakar.io","account","getAccountNotifications"]})}})}const gt={unknown:"default",info:"default",warning:"warning",error:"error",critical:"error"},pt={unknown:void 0,info:void 0,warning:"Warning",error:"Error",critical:"Critical Error"};function xt({repository:t}){const s=V(D({repository:t})),n=_e(),a=de();if(s.isPending)return e.jsx(ze,{});if(s.isError)return e.jsx(Te,{illustrationType:"sad",title:"Something went wrong while fetching notifications.",description:s.error.message});const o=s.data.pages[0],l=s.data.pages.flatMap(i=>i.notifications?.items).filter(i=>i!==void 0);if(o.__type==="unauthenticated")return e.jsx(re,{onClick:()=>n({to:"/login"})});if(l.length===0)return e.jsx("div",{className:"text-sm",children:"You have no unread notifications."});const c=l.some(i=>i.status==="unread"),r=()=>{a.mutate({notificationIds:l.filter(i=>i.status==="unread").map(i=>i.id),status:"read"},{onError:i=>{i instanceof ae?w({content:{children:i.responsePayload,variant:"error"}}):w({content:{children:i.toString(),variant:"error"}})}})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[c&&e.jsx("div",{className:"self-end",children:e.jsx(k,{leftIcon:"check",variant:"secondary",size:"sm",onPress:r,children:"Mark all as read"})}),e.jsx(R,{ariaLabel:"Notifications",children:l.map(i=>e.jsx(R.Item,{severity:gt[i.level],title:pt[i.level],description:i.message,date:i.created_at.relativeToNow(),unread:i.status==="unread"},i.id))}),s.hasNextPage&&e.jsx(k,{size:"sm",variant:"secondary",onPress:()=>s.fetchNextPage(),isDisabled:s.isFetchingNextPage,children:"Load more"})]})}function bt({repository:t,open:s,setOpen:n}){return e.jsx(Re,{open:s,setOpen:n,title:"Notifications",children:e.jsx(xt,{repository:t})})}function jt({repository:t,onPress:s}){const n=V(D({repository:t,status:"unread"})),a=n.data?.pages[0].__type==="ok"?n.data.pages[0].notifications.total:void 0;return e.jsxs("span",{className:j(a!==void 0&&a>0&&"relative inline-block pr-2"),children:[e.jsx(H,{"aria-label":"Open notifications",variant:"tertiary",icon:(a!==void 0&&a>0,"bell"),onPress:s,size:"sm",tooltip:"Notifications"}),a!==void 0&&a>0&&e.jsx("span",{className:"px-0.75 pointer-events-none absolute -top-2 right-0 flex min-w-4 items-center justify-center rounded-full bg-red-500 text-xs font-medium text-white",children:a>99?"99+":a})]})}function vt(t){const s=g.useRef(!1),{data:n,isPending:a}=V(D({repository:t,status:"unread"})),{mutate:o}=de(),c=n?.pages.map(u=>u.notifications?.items).flat().filter(u=>u?.flags.isBanner).reverse()?.[0],r=c?.level??"unknown",i=c?.id,h=c?.message,d=c?.flags.isBanner,m={unknown:"default",info:"default",warning:"warning",error:"error",critical:"error"}[r];g.useEffect(()=>{s.current||a||!i||!d||(w({content:{variant:m,title:r,buttonProps:{children:"Mark as read",variant:"secondary",slot:"close",onPress:()=>{o({notificationIds:[i],status:"read"},{onError:u=>{u instanceof ae?w({content:{children:u.responsePayload,variant:"error"}}):w({content:{children:u.toString(),variant:"error"}})}})}},children:h,closable:!1},sticky:!0}),s.current=!0)},[a,m,i,r,h,d,o])}function yt({repository:t,version:s,children:n}){const[a,o]=g.useState(!1);Ze(),vt(t);const l=N(Oe()),{data:{demo_mode:c}={}}=N(ne()),r=Xe([...U,...B].map(d=>String(d.href?.to))),i=g.useMemo(()=>U.map(d=>({...d,isSelected:r===d.href?.to})),[r]),h=g.useMemo(()=>B.map(d=>({...d,isSelected:r===d.href?.to})),[r]);return e.jsxs(Me,{children:[e.jsx(at,{navItems:i,subNavItems:h,user:{name:l.data?.name,avatarUrl:l.data?.avatar_url,isPending:l.isPending,isAuthenticated:!!l.data},version:s,controls:e.jsx(jt,{repository:t,onPress:()=>o(d=>!d)}),footer:e.jsx(lt,{}),isDemo:c,children:n}),e.jsx(bt,{open:a,setOpen:o,repository:t})]})}function Pt(){const t=$e.useLoaderData();return e.jsx(yt,{repository:t.repository_id,version:t.version,children:e.jsx(Ve,{})})}export{Pt as component};
