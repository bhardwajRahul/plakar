import{aB as Me,a3 as O,aC as Oe,aD as Be,a4 as T,aE as Ae,aF as $e,aG as Ue,r as m,aH as He,aI as We,aJ as qe,aK as Qe,X as Ge,R as S,aL as Ye,aM as Pe,Y as se,a0 as ae,a1 as Je,a2 as G,aN as me,aO as Se,aP as Ne,aQ as Xe,aR as Ze,aS as et,aT as tt,j as e,aU as pe,T as b,i as M,aV as st,b as P,I as w,a7 as at,h as k,aW as it,aX as nt,aY as rt,ak as ot,f as H,aZ as Fe,M as W,S as xe,l as D,n as lt,o as ct,t as q,a_ as I,ap as be,a$ as ee,ae as ke,af as Ce,ag as dt,b0 as ut,b1 as te,b2 as V,b3 as ft,b4 as ht,b5 as mt,b6 as pt,z as Y,b7 as De,s as xt,b8 as B,b9 as bt,ba as ie,bb as gt,bc as yt,B as jt,bd as vt}from"./index-BJrYkkbA.js";import{u as J}from"./useQuery-DFVQRQYW.js";import{c as wt,u as $t,g as Pt,P as St}from"./paginated-table-NottqT0_.js";import{P as Nt,a as ge,b as Ft}from"./side-panel-provider-DxsBlxMi.js";import{u as kt}from"./use-breakpoint-BDq3u2OF.js";import{u as Ct,a as ne}from"./use-side-panel-29PCeUs6.js";import{M as Dt}from"./main-CAAnIMo1.js";import{F as zt}from"./filters-BWL2AiQB.js";import{$ as It,a as Tt,S as Rt}from"./select-B37njsdh.js";import{A as re}from"./alert-B__-qerL.js";import{T as Kt}from"./tag-B4RmpwG4.js";import{$ as Lt,a as Vt,b as _t,c as Et,e as _,d as Mt}from"./Table-79HwOb_A.js";import{I as oe}from"./id-CWkxw1na.js";import{b as Ot}from"./breadcrumbs-for-path-DmZdZ2n2.js";import"./useBaseQuery-CDY4cYzC.js";import"./useToggleState-C9KbMpY2.js";import"./empty-list-C7hzuEv3.js";const ze=new WeakMap;function Q(s,t,a){return s?(typeof t=="string"&&(t=t.replace(/\s+/g,"")),`${ze.get(s)}-${a}-${t}`):""}function Bt(s,t,a){let{key:i,isDisabled:n,shouldSelectOnPressUp:o}=s,{selectionManager:r,selectedKey:c}=t,d=i===c,l=n||t.isDisabled||t.selectionManager.isDisabled(i),{itemProps:f,isPressed:u}=Me({selectionManager:r,key:i,ref:a,isDisabled:l,shouldSelectOnPressUp:o,linkBehavior:"selection"}),p=Q(t,i,"tab"),g=Q(t,i,"tabpanel"),{tabIndex:x}=f,y=t.collection.getItem(i),$=O(y?.props,{labelable:!0});delete $.id;let L=Oe(y?.props),{focusableProps:v}=Be({isDisabled:l},a);return{tabProps:T($,v,L,f,{id:p,"aria-selected":d,"aria-disabled":l||void 0,"aria-controls":d?g:void 0,tabIndex:l?void 0:x,role:"tab"}),isSelected:d,isDisabled:l,isPressed:u}}function At(s,t,a){let i=Ae(a)?void 0:0;var n;const o=Q(t,(n=s.id)!==null&&n!==void 0?n:t?.selectedKey,"tabpanel"),r=$e({...s,id:o,"aria-labelledby":Q(t,t?.selectedKey,"tab")});return{tabPanelProps:T(r,{tabIndex:i,role:"tabpanel","aria-describedby":s["aria-describedby"],"aria-details":s["aria-details"]})}}class Ut{getKeyLeftOf(t){return this.flipDirection?this.getNextKey(t):this.getPreviousKey(t)}getKeyRightOf(t){return this.flipDirection?this.getPreviousKey(t):this.getNextKey(t)}isDisabled(t){var a,i;return this.disabledKeys.has(t)||!!(!((i=this.collection.getItem(t))===null||i===void 0||(a=i.props)===null||a===void 0)&&a.isDisabled)}getFirstKey(){let t=this.collection.getFirstKey();return t!=null&&this.isDisabled(t)&&(t=this.getNextKey(t)),t}getLastKey(){let t=this.collection.getLastKey();return t!=null&&this.isDisabled(t)&&(t=this.getPreviousKey(t)),t}getKeyAbove(t){return this.tabDirection?null:this.getPreviousKey(t)}getKeyBelow(t){return this.tabDirection?null:this.getNextKey(t)}getNextKey(t){let a=t;do a=this.collection.getKeyAfter(a),a==null&&(a=this.collection.getFirstKey());while(a!=null&&this.isDisabled(a));return a}getPreviousKey(t){let a=t;do a=this.collection.getKeyBefore(a),a==null&&(a=this.collection.getLastKey());while(a!=null&&this.isDisabled(a));return a}constructor(t,a,i,n=new Set){this.collection=t,this.flipDirection=a==="rtl"&&i==="horizontal",this.disabledKeys=n,this.tabDirection=i==="horizontal"}}function Ht(s,t,a){let{orientation:i="horizontal",keyboardActivation:n="automatic"}=s,{collection:o,selectionManager:r,disabledKeys:c}=t,{direction:d}=Ue(),l=m.useMemo(()=>new Ut(o,d,i,c),[o,c,i,d]),{collectionProps:f}=He({ref:a,selectionManager:r,keyboardDelegate:l,selectOnFocus:n==="automatic",disallowEmptySelection:!0,scrollRef:a,linkBehavior:"selection"}),u=We();ze.set(t,u);let p=$e({...s,id:u});return{tabListProps:{...T(f,p),role:"tablist","aria-orientation":i,tabIndex:void 0}}}function Wt(s){var t,a;let i=It({...s,onSelectionChange:s.onSelectionChange?d=>{var l;d!=null&&((l=s.onSelectionChange)===null||l===void 0||l.call(s,d))}:void 0,suppressTextValueWarning:!0,defaultSelectedKey:(a=(t=s.defaultSelectedKey)!==null&&t!==void 0?t:ye(s.collection,s.disabledKeys?new Set(s.disabledKeys):new Set))!==null&&a!==void 0?a:void 0}),{selectionManager:n,collection:o,selectedKey:r}=i,c=m.useRef(r);return m.useEffect(()=>{let d=r;s.selectedKey==null&&(n.isEmpty||d==null||!o.getItem(d))&&(d=ye(o,i.disabledKeys),d!=null&&n.setSelectedKeys([d])),(d!=null&&n.focusedKey==null||!n.isFocused&&d!==c.current)&&n.setFocusedKey(d),c.current=d}),{...i,isDisabled:s.isDisabled||!1}}function ye(s,t){let a=null;if(s){var i,n,o,r;for(a=s.getFirstKey();a!=null&&(t.has(a)||!((n=s.getItem(a))===null||n===void 0||(i=n.props)===null||i===void 0)&&i.isDisabled)&&a!==s.getLastKey();)a=s.getKeyAfter(a);a!=null&&(t.has(a)||!((r=s.getItem(a))===null||r===void 0||(o=r.props)===null||o===void 0)&&o.isDisabled)&&a===s.getLastKey()&&(a=s.getFirstKey())}return a}const X=m.createContext(null),K=m.createContext(null),qt=m.forwardRef(function(t,a){[t,a]=Ge(t,a,X);let{children:i,orientation:n="horizontal"}=t;return i=m.useMemo(()=>typeof i=="function"?i({orientation:n,defaultChildren:null}):i,[i,n]),S.createElement(Ye,{content:i},o=>S.createElement(Qt,{props:t,collection:o,tabsRef:a}))});function Qt({props:s,tabsRef:t,collection:a}){let{orientation:i="horizontal"}=s,n=Wt({...s,collection:a,children:void 0}),{focusProps:o,isFocused:r,isFocusVisible:c}=ae({within:!0}),d=m.useMemo(()=>({orientation:i,isFocusWithin:r,isFocusVisible:c}),[i,r,c]),l=G({...s,defaultClassName:"react-aria-Tabs",values:d}),f=O(s,{global:!0});return S.createElement("div",{...T(f,l,o),ref:t,slot:s.slot||void 0,"data-focused":r||void 0,"data-orientation":i,"data-focus-visible":c||void 0,"data-disabled":n.isDisabled||void 0},S.createElement(Se,{values:[[X,s],[K,n]]},l.children))}const Gt=m.forwardRef(function(t,a){return m.useContext(K)?S.createElement(Yt,{props:t,forwardedRef:a}):S.createElement(Pe,t)});function Yt({props:s,forwardedRef:t}){let a=m.useContext(K),{CollectionRoot:i}=m.useContext(Ne),{orientation:n="horizontal",keyboardActivation:o="automatic"}=Ze(X),r=se(t),{tabListProps:c}=Ht({...s,orientation:n,keyboardActivation:o},a,r),d=G({...s,children:null,defaultClassName:"react-aria-TabList",values:{orientation:n,state:a}}),l=O(s,{global:!0});return delete l.id,S.createElement("div",{...T(l,d,c),ref:r,"data-orientation":n||void 0},S.createElement(i,{collection:a.collection,persistedKeys:et(a.selectionManager.focusedKey)}))}class Ie extends tt{}Ie.type="item";const Jt=qe(Ie,(s,t,a)=>{let i=m.useContext(K),n=se(t),{tabProps:o,isSelected:r,isDisabled:c,isPressed:d}=Bt({key:a.key,...s},i,n),{focusProps:l,isFocused:f,isFocusVisible:u}=ae(),{hoverProps:p,isHovered:g}=Je({isDisabled:c,onHoverStart:s.onHoverStart,onHoverEnd:s.onHoverEnd,onHoverChange:s.onHoverChange}),x=G({...s,id:void 0,children:a.rendered,defaultClassName:"react-aria-Tab",values:{isSelected:r,isDisabled:c,isFocused:f,isFocusVisible:u,isPressed:d,isHovered:g}}),y=a.props.href?"a":"div",$=O(s,{global:!0});return delete $.id,delete $.onClick,S.createElement(y,{...T($,x,o,l,p),ref:n,"data-selected":r||void 0,"data-disabled":c||void 0,"data-focused":f||void 0,"data-focus-visible":u||void 0,"data-pressed":d||void 0,"data-hovered":g||void 0},x.children)}),Xt=Qe(function(t,a){const i=m.useContext(K);let n=se(a),{id:o,...r}=t,{tabPanelProps:c}=At(t,i,n),{focusProps:d,isFocused:l,isFocusVisible:f}=ae(),u=i.selectedKey===t.id,p=G({...t,defaultClassName:"react-aria-TabPanel",values:{isFocused:l,isFocusVisible:f,isInert:me(!u),state:i}});if(!u&&!t.shouldForceMount)return null;let g=O(r,{global:!0});delete g.id;let x=u?T(g,c,d,p):p;return S.createElement("div",{...x,ref:n,"data-focused":l||void 0,"data-focus-visible":f||void 0,inert:me(!u||t.inert),"data-inert":u?void 0:"true"},S.createElement(Se,{values:[[X,null],[K,null]]},S.createElement(Ne.Provider,{value:Xe},p.children)))});function Zt({text:s,altText:t,onUnselect:a,children:i}){const n=S.Children.count(i)>0;return e.jsxs(Tt,{"aria-label":"Selection controls",className:"bg-foreground-black m-4 flex w-fit items-center rounded-lg shadow-lg drop-shadow-lg",children:[e.jsxs(pe,{"aria-label":"Items selected",className:"flex flex-col px-4 py-2 text-center",children:[e.jsxs("div",{className:"flex items-baseline gap-1 whitespace-nowrap",children:[e.jsx(b,{className:"text-on-brand",weight:"medium",size:"sm",children:s}),t&&e.jsx(b,{className:"text-on-brand",size:"xs",children:t})]}),e.jsx(b,{as:o=>e.jsx(M,{onPress:a,...o}),size:"xs",className:"text-tertiary cursor-pointer underline",children:"Unselect all"})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx(st,{orientation:"vertical",className:"bg-border-primary w-[1px] shrink-0 self-stretch"}),e.jsx(pe,{"aria-label":"Actions",className:"flex gap-2 p-2",children:i})]})]})}function es({variant:s,ariaLabel:t,items:a,selected:i,className:n,onSelectionChange:o}){return e.jsxs(qt,{selectedKey:i,onSelectionChange:o,className:n,children:[e.jsx(Gt,{"aria-label":t,items:a,className:P({"flex w-fit gap-2":s==="underlined","border-secondary bg-tertiary flex gap-1 rounded-lg border p-1":s==="pill","flex flex-col gap-4":s==="vertical"}),children:a.map(r=>e.jsxs(Jt,{id:r.id,className:P("flex flex-1 cursor-pointer items-center justify-center gap-3",s==="underlined"&&{"border-b-2 px-4 py-3":!0,"text-secondary hover:border-secondary hover:text-secondary data-selected:border-accent-heavy data-selected:text-primary border-transparent":i!==r.id,"border-accent-heavy text-primary":i===r.id},s==="pill"&&{"text-tertiary hover:bg-tertiary-hover data-selected:bg-accent data-selected:text-on-brand h-10 rounded-lg px-2 py-1.5":!0},s==="vertical"&&{"text-on-brand justify-start border-l-4 px-4 py-3":!0,"border-transparent":i!==r.id,"border-on-accent":i===r.id}),href:r.href,children:[e.jsx(b,{as:"span",size:s==="vertical"?"md":"sm",weight:i===r.id?"medium":"normal",children:r.title}),r.icon&&e.jsx(w,{type:r.icon,size:"md"}),r.tag&&e.jsx(Kt,{variant:"heavy",radius:"sqrt",className:"-my-2",children:r.tag})]},r.id))}),e.jsx(Pe,{items:a,children:r=>e.jsx(Xt,{className:"flex h-full min-h-0 flex-col",children:r.content&&e.jsx("div",{className:"border-primary flex min-h-0 flex-1 flex-col border-t",children:r.content})})})]})}function ts(s,t){if(s===void 0)return{shouldBlockFn:()=>!0,withResolver:!1};if("shouldBlockFn"in s)return s;if(typeof s=="function")return{shouldBlockFn:async()=>await s(),enableBeforeUnload:!0,withResolver:!1};const a=!!(s.condition??!0),i=s.blockerFn;return{shouldBlockFn:async()=>a&&i!==void 0?await i():a,enableBeforeUnload:a,withResolver:i===void 0}}function ss(s,t){const{shouldBlockFn:a,enableBeforeUnload:i=!0,disabled:n=!1,withResolver:o=!1}=ts(s),r=at(),{history:c}=r,[d,l]=m.useState({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0});return m.useEffect(()=>{const f=async u=>{function p(v){const F=r.parseLocation(v),R=r.getMatchedRoutes(F.pathname,void 0);if(R.foundRoute===void 0)throw new Error(`No route found for location ${v.href}`);return{routeId:R.foundRoute.id,fullPath:R.foundRoute.fullPath,pathname:F.pathname,params:R.routeParams,search:F.search}}const g=p(u.currentLocation),x=p(u.nextLocation),y=await a({action:u.action,current:g,next:x});if(!o)return y;if(!y)return!1;const L=await new Promise(v=>{l({status:"blocked",current:g,next:x,action:u.action,proceed:()=>v(!1),reset:()=>v(!0)})});return l({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0}),L};return n?void 0:c.block({blockerFn:f,enableBeforeUnload:i})},[a,i,n,o,c,r]),d}function Te({contentType:s,size:t="lg"}){return s?.startsWith("image")?e.jsx(w,{type:"md-image",size:t}):s==="application/pdf"?e.jsx(w,{type:"md-picture-as-pdf",size:t}):s?.startsWith("video")?e.jsx(w,{type:"md-video-file",size:t}):s?.startsWith("audio")?e.jsx(w,{type:"md-audio-file",size:t}):s==="application/zip"?e.jsx(w,{type:"md-folder-zip",size:t}):e.jsx(w,{type:"md-file-copy",size:t})}function as(s){return s.isSetuid()?"bg-red-500/80 text-white ring-red-500/80":s.isSetgid()?"bg-orange-500/80 text-white ring-orange-500/80":s.isSticky()?"bg-cyan-500/80 text-white ring-cyan-500/80":"text-primary"}function le({mode:s,size:t="sm"}){const a=`${(s.Value&511).toString(8)}`,i=[s.isSetuid()&&"SETUID",s.isSetgid()&&"SETGID",s.isSticky()&&"STICKY"].filter(n=>n).join(" | ");return e.jsx(k,{label:`${a} ${i}`,children:e.jsx("button",{children:e.jsx(b,{as:"span",variant:"body",size:t,weight:"medium",monospace:!0,className:P("rounded-xs whitespace-nowrap",as(s)),children:s.toString()})})})}function is(s){return typeof s=="function"}function je(s,...t){return is(s)?s(...t):s}function ns(s){return s||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}class rs extends it{constructor(t){super({pluginId:"pacer",debug:t?.debug})}}const os=(s,t)=>{Re.emit(s,t)},Re=new rs;function ve(){return{canLeadingExecute:!0,executionCount:0,isPending:!1,lastArgs:void 0,status:"idle",maybeExecuteCount:0}}const ls={enabled:!0,leading:!1,trailing:!0,wait:0};class cs{constructor(t,a){this.fn=t,this.store=new nt(ve()),this.setOptions=i=>{this.options={...this.options,...i},this.#s()||this.cancel()},this.#e=i=>{this.store.setState(n=>{const o={...n,...i},{isPending:r}=o;return{...o,status:this.#s()?r?"pending":"idle":"disabled"}}),os("Debouncer",this)},this.#s=()=>!!je(this.options.enabled,this),this.#n=()=>je(this.options.wait,this),this.maybeExecute=(...i)=>{if(!this.#s())return;this.#e({maybeExecuteCount:this.store.state.maybeExecuteCount+1});let n=!1;this.options.leading&&this.store.state.canLeadingExecute&&(this.#e({canLeadingExecute:!1}),n=!0,this.#a(...i)),this.options.trailing&&this.#e({isPending:!0,lastArgs:i}),this.#t&&clearTimeout(this.#t),this.#t=setTimeout(()=>{this.#e({canLeadingExecute:!0}),this.options.trailing&&!n&&this.#a(...i)},this.#n())},this.#a=(...i)=>{this.#s()&&(this.fn(...i),this.#e({executionCount:this.store.state.executionCount+1,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(i,this))},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&(this.#i(),this.#a(...this.store.state.lastArgs))},this.#i=()=>{this.#t&&(clearTimeout(this.#t),this.#t=void 0)},this.cancel=()=>{this.#i(),this.#e({canLeadingExecute:!0,isPending:!1})},this.reset=()=>{this.#e(ve())},this.key=ns(a.key),this.options={...ls,...a},this.#e(this.options.initialState??{}),Re.on("d-Debouncer",i=>{i.payload.key===this.key&&(this.#e(i.payload.store.state),this.setOptions(i.payload.options))})}#t;#e;#s;#n;#a;#i}function ds(s,t,a=()=>({})){const[i]=m.useState(()=>new cs(s,t)),n=rt(i.store,a);return i.fn=s,i.setOptions(t),m.useEffect(()=>()=>{i.cancel()},[i]),m.useMemo(()=>({...i,state:n}),[i,n])}function us({search:s,searchPlaceholder:t,filters:a,onSearch:i}){const[n,o]=m.useState(s);m.useEffect(()=>{o(s)},[s]);const r=ds(l=>i(l),{wait:300}),c=l=>{const f=l?String(l):"";o(f),r.maybeExecute(f)},d=()=>{o(""),r.cancel(),i("")};return e.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2 md:flex-nowrap",children:[e.jsx("div",{className:"order-1 flex-1",children:e.jsx(ot,{icon:"magnifying-glass",placeholder:t,className:"w-full sm:max-w-64 sm:flex-1",value:n,onChange:c,"aria-label":"Search by name",suffix:n?e.jsx(M,{"aria-label":"Clear text",onPress:d,className:"inline-flex",children:e.jsx(w,{type:"close",size:"md"})}):void 0})}),a]})}function fs(s){const t=["k","M","B"],a=[1e3,1e6,1e9];let i=`${s}`;for(let n=a.length-1;n>=0;n--){const o=a[n];if(s>=o){i=`${(s/o).toFixed(1).replace(/\.0$/,"")}${t[n]}`;break}}return{Value:s,Pretty:i}}function hs({keys:s,action:t}){m.useEffect(()=>{const a=i=>{const n=i.target,o=n.tagName.toLowerCase();o==="input"||o==="textarea"||o==="select"||n.isContentEditable||s.includes(i.key)&&(i.preventDefault(),i.stopPropagation(),t(i.key))};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[s,t])}function ms(s){const[a,i]=m.useState(s);return m.useEffect(()=>{if(s){i(!1);return}const n=setTimeout(()=>{i(!0)},100);return()=>clearTimeout(n)},[s,100]),a}function ps({controls:s=[],main:t,sidebar:a,onCollapse:i}){const{position:n,moveSidebar:o}=Ct(),r=m.useRef(null),c=()=>{const x=r.current;x&&(x.isCollapsed()?x.expand():i?i():x.collapse())},[d,l]=m.useState(!1),{isMdDown:f}=kt(),u=f?"vertical":n,p=u==="horizontal"?20:3,g=u==="horizontal"?30:10;return e.jsx("div",{className:"h-full",children:e.jsxs(Nt,{autoSaveId:"sidebar",direction:u,children:[e.jsx(ge,{id:"main",order:1,minSize:g,className:"relative",children:e.jsx("div",{className:"h-full overflow-auto",children:t})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:P("border-primary relative flex items-center justify-center",u==="horizontal"?"border-l-1":"border-t-1"),children:e.jsx("div",{className:"absolute inset-0 -m-2"})}),e.jsx(ge,{id:"sidebar",order:2,defaultSize:50,minSize:p,className:"bg-primary min-h-[50px] min-w-[58px] flex-shrink-0 overflow-hidden md:pt-4",collapsible:!0,collapsedSize:p,ref:r,onCollapse:()=>l(!0),onExpand:()=>l(!1),children:e.jsxs("div",{className:"flex h-full flex-col gap-4",children:[e.jsx("div",{className:"hidden px-4 lg:block",children:e.jsx(xs,{moveSidebar:o,collapseSidebar:c,controls:s,position:u,collapsed:d})}),e.jsx("div",{className:"flex min-h-0 flex-1 flex-col overflow-auto",children:e.jsx("div",{className:"h-full pt-4 md:pt-0",children:a})})]})})]})]})})}function xs({moveSidebar:s,collapseSidebar:t,controls:a,position:i,collapsed:n}){return e.jsxs("div",{className:"text-action-tertiary flex items-center justify-between gap-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{tooltip:n?"Expand sidebar":"Collapse sidebar",variant:"tertiary",size:"sm",icon:i==="horizontal"?n?"chevrons-left":"chevrons-right":n?"chevrons-up":"chevrons-down",onPress:t}),a.length>0&&e.jsx("div",{className:"border-primary ml-2 flex gap-2 border-l pl-2",children:a.map(o=>e.jsx(H,{tooltip:o.tooltip,variant:"tertiary",size:"sm",icon:o.icon,isDisabled:o.isDisabled,onPress:o.onPress},o.icon))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{tooltip:"Move the sidebar to the right",variant:"tertiary",size:"sm",icon:"sidebar-right",onPress:()=>s("horizontal"),isDisabled:i==="horizontal"}),e.jsx(H,{tooltip:"Move the sidebar to the bottom",variant:"tertiary",size:"sm",icon:"sidebar-bottom",onPress:()=>s("vertical"),isDisabled:i==="vertical"})]})]})}function Ke({snapshot:s,vfsEntry:t,variant:a="default",onSnapshotChange:i}){const n=ne(Fe({snapshot:s,vfsEntry:t,page:0,perPage:5}));if(n.error)return e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"md",className:"text-secondary",children:"Unable to load snapshot history"}),e.jsxs(b,{size:"sm",className:"text-secondary",children:["An error occurred while fetching the snapshot history. You can try to reload the page: ",n.error.message]})]});if(n.isPending)return e.jsx(W,{className:P(a==="compact"&&"max-h-[300px] min-w-[320px]"),unstyled:a==="default","aria-label":"Loading timeline",children:Array.from({length:7}).map((l,f)=>e.jsx(W.Item,{leftIcon:"clock",label:e.jsx(xe,{variant:"text",size:"sm",className:"w-[144px]"}),altText:e.jsx(xe,{variant:"text",size:"xs",className:"w-[100px]"}),closeOnSelect:!1,className:P(a==="default"&&"border-primary mb-2 rounded-xl border p-4")},f))});const r=n.data.pages.map(l=>l.response.items).flat().map(l=>we(s,l,t,i,a)),d=n.data.pages[n.data.pages.length-1].response.total-r.length;return d>0&&(d>1&&r.push({id:"more",className:"border-0",label:e.jsxs(b,{variant:"body",size:"sm",className:P("text-tertiary",n.isFetching&&"animate-pulse"),children:[d-1," more snapshot",d-1>1?"s":""]}),alt:e.jsx(D,{variant:"secondary",size:a==="compact"?"sm":"md",onPress:()=>n.fetchNextPage(),isDisabled:n.isFetching,isPending:n.isFetching,children:"Load more"}),icon:"circle-plus",closeOnSelect:!1}),n.data.pages[0].lastEntry&&r.push(we(s,n.data.pages[0].lastEntry,t,i,a))),e.jsx(W,{className:P(a==="compact"&&"max-h-[300px] min-w-[320px] overflow-auto"),unstyled:a==="default","aria-label":"Timeline",children:r.map(l=>e.jsx(W.Item,{leftIcon:l.icon,label:l.label,altText:l.alt,onAction:l.onAction,className:P(a==="default"&&"mb-2 rounded-xl border p-4",l.className),closeOnSelect:l.closeOnSelect},l.id))})}const we=function(s,t,a,i,n){const o=a.object?a.object.contentMAC!==t.vfs_entry.object?.contentMAC:a.mac!==t.vfs_entry.mac,r=s.identifier.Value===t.snapshot.identifier.Value,c=r?void 0:()=>{i(t.snapshot.identifier.Value)};return{id:t.snapshot.identifier.Value,label:e.jsxs("div",{className:"group flex items-baseline gap-2",children:[e.jsx(b,{variant:"body",size:"sm",weight:"medium",className:P("text-primary",r&&"underline"),monospace:!0,children:t.snapshot.identifier.toHumanString()}),o&&e.jsx(w,{type:"not-equal",size:"xs"}),!r&&e.jsx(b,{variant:"body",size:n==="compact"?"xs":"sm",className:"text-tertiary",children:o?"Differences":"No changes"})]}),alt:t.snapshot.timestamp.relativeToNow(),icon:"clock",className:r?"border-accent-heavy":"cursor-pointer border-primary",onAction:c}};function bs({snapshot:s,childEntry:t,onSnapshotChange:a}){const{file_info:{mod_time:i,mode:n,uid:o,username:r,gid:c,groupname:d}}=t,l=[{title:"Last modified",description:e.jsx(k,{label:i.Value,children:e.jsx("span",{role:"button",children:i.toHumanString()})}),tooltip:i.Value},{title:"Mode",description:e.jsx(le,{mode:n})},{title:"Owner user",description:e.jsxs(e.Fragment,{children:[o," ",r]})},{title:"Owner group",description:e.jsxs(e.Fragment,{children:[c," ",d]})},{title:"Version",description:e.jsxs(lt,{children:[e.jsxs(M,{className:"flex items-center gap-1 font-mono",children:[s.identifier.toHumanString(),e.jsx(w,{type:"caret-down",size:"sm"})]}),e.jsx(ct,{offset:4,children:e.jsx(Ke,{snapshot:s,vfsEntry:t,variant:"compact",onSnapshotChange:a})})]})}];return e.jsx(q,{direction:"row",size:"sm",children:l.map(f=>e.jsx(q.Item,{...f},f.title))})}function gs(){const{mime:s,filename:t}=I.useSearch(),a=I.useNavigate(),i=m.useCallback(r=>a({search:c=>({...c,page:0,filename:r||void 0})}),[a]),o=[{key:"mime",value:s}].filter(({value:r})=>r);return e.jsx(us,{search:t,searchPlaceholder:"Search filename: *.txt, tmp_*...",onSearch:i,filters:e.jsxs(e.Fragment,{children:[o.length>0&&e.jsx("div",{className:"order-3 w-full md:order-2 md:w-auto",children:e.jsx(be,{label:"Applied filters",onRemove:r=>{a({search:c=>({...c,mime:r.has("mime")?"":c.mime,page:0})})},children:o.map(({key:r,value:c})=>e.jsx(be.Item,{id:r,value:ee.find(({id:d})=>d===s)?.name||c},r))})}),e.jsx("div",{className:"order-2 md:order-3",children:e.jsx(zt,{items:[{id:"mime",label:"File type",options:ee}],defaultSelected:{mime:s||null},onApply:r=>{a({search:c=>({...c,mime:r.mime||"",page:0})})}})})]})})}const ys=Ce({id:dt()}).transform(s=>({url:`${ut}/api/snapshot/vfs/downloader-sign-url/${s.id}?format=tarball`}));async function js({snapshotId:s,paths:t}){const a=`/api/snapshot/vfs/downloader/${s}`,i=await ke(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.map(o=>({pathname:o}))})});let n;try{n=await i.json()}catch{throw new Error(`the API endpoint ${a} returned HTTP/${i.status} with an invalid JSON payload`)}try{return ys.parse(n)}catch(o){throw new Error(`Failed to parse ${a} response: ${o}`)}}function vs({snapshot:s,childEntries:t,removeSelection:a}){const[i,n]=m.useState(!1),o=t.filter(l=>l.file_info.mode.isDir()).sort((l,f)=>l.file_info.name.localeCompare(f.file_info.name)),r=t.filter(l=>l.file_info.mode.isRegular()).sort((l,f)=>l.file_info.name.localeCompare(f.file_info.name)),c=te(o.reduce((l,f)=>l+(f.summary?.Total.size.Value??0),0)+r.reduce((l,f)=>l+(f.file_info.size.Value??0),0)),d=async()=>{n(!0);const l=await js({snapshotId:s.identifier.Value,paths:t.map(u=>u.path)}),f=document.createElement("a");f.style.display="none",f.target="_blank",f.href=l.url,document.body.appendChild(f),f.click(),document.body.removeChild(f),n(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(ws,{numberOfItemsSelected:o.length+r.length}),e.jsx(Zt,{text:`${t.length} selected`,altText:c.Pretty,onUnselect:a,children:e.jsx(D,{variant:"primary",onPress:d,isPending:i,leftIcon:"download",children:"Download"})})]})}function ws({numberOfItemsSelected:s}){const{proceed:t,reset:a,status:i}=ss({shouldBlockFn:({current:n,next:o})=>!(s<2||n.pathname===o.pathname),withResolver:!0,enableBeforeUnload:!1});return e.jsx(V,{isDismissable:!0,isOpen:i==="blocked",onOpenChange:()=>a?.(),"aria-label":"Leaving the page?",children:e.jsxs(V.Dialog,{children:[e.jsx(V.Header,{title:"Leaving the page?",description:e.jsxs(e.Fragment,{children:["You have selected ",e.jsx("strong",{children:s})," files and directories."]})}),e.jsx(V.Content,{children:"If you leave this page, your selection will be lost."}),e.jsxs(V.Footer,{className:"flex flex-wrap justify-end gap-2",children:[e.jsx(D,{variant:"secondary",onPress:()=>a?.(),children:"Stay here"}),e.jsx(D,{variant:"error",onPress:()=>t?.(),children:"Leave the page"})]})]})})}function $s({snapshot:s,vfsEntry:t}){const a=t.summary?.Total.errors??"several";return e.jsxs(re,{title:"Unable to backup some files in this directory",variant:"error",actions:e.jsx(D,{variant:"secondary",href:{to:"/snapshots/$snapshotId/errors",params:{snapshotId:s.identifier.Value},search:{path:t.path}},children:"View Errors"}),children:["Backup completed with ",e.jsxs("strong",{children:[a," errors"]})," in this directory and its subdirectories."]})}const Ps=Ce({total:mt(),items:ht(pt)});async function Ss({snapshotId:s,path:t,pagination:a}){const i=new URLSearchParams({...ft(a)}),n=`/api/snapshot/vfs/chunks/${s}:${encodeURIComponent(t)}?${i}`,o=await ke(n);let r;try{r=await o.json()}catch{throw new Error(`the API endpoint ${n} returned HTTP/${o.status} with an invalid JSON payload`)}try{return Ps.parse(r)}catch(c){throw new Error(`Failed to parse ${n} response: ${c}`)}}function Ns({preview:s,snapshot:t}){return e.jsxs("div",{className:"flex w-full flex-col gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(b,{as:"h3",size:"sm",className:"text-primary",weight:"medium",variant:"heading",children:"General information"}),e.jsx(Fs,{fileEntry:s})]}),s.file_info.mode.isRegular()&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(b,{as:"h3",size:"sm",className:"text-primary",weight:"medium",variant:"heading",children:"Advanced"}),e.jsx(ks,{snapshot:t,fileEntry:s})]})]})}function Fs({fileEntry:s}){const{mode:t,mod_time:a,size:i,uid:n,username:o,gid:r,groupname:c}=s.file_info,d=s.object,l=[{show:t.isRegular(),label:"Checksum",content:e.jsx(oe,{value:d?.contentMAC??"",size:"sm",weight:"medium"})},{label:"Modified",content:e.jsx(k,{label:a.Value,children:e.jsx("span",{role:"button",children:a.toHumanString()})})},{label:"Size",content:e.jsx(k,{label:`${i.Value.toString()} bytes`,children:e.jsx("span",{role:"button",children:i.Pretty})})},{label:"Mode",content:e.jsx(le,{mode:t,size:"sm"})},{show:t.isSymlink(),label:"Symlink target",content:s.symlink_target},{show:t.isRegular(),label:"Content Type",content:d?.content_type},{label:"Owner user",content:`${n} ${o}`},{label:"Owner group",content:`${r} ${c}`},{show:t.isRegular(),label:"Entropy",content:d?.entropy.toFixed(2)}];return e.jsx(q,{direction:"col",size:"sm",children:l.filter(f=>f.show!==!1).map(({label:f,content:u})=>e.jsx(q.Item,{title:f,description:u},f))})}function ks({snapshot:s,fileEntry:t}){const a=ne({queryKey:["chunks",s.identifier.Value,t.path],initialPageParam:{page:0,perPage:10},queryFn:async({pageParam:o})=>Ss({snapshotId:s.identifier.Value,path:t.path,pagination:{page:o.page,perPage:o.perPage}}),getNextPageParam:(o,r,c)=>{if(o&&!((c.page+1)*c.perPage>=o.total))return{page:c.page+1,perPage:c.perPage}}});if(a.isError)return null;if(a.isPending)return e.jsx(Y,{});const i=a.data.pages.flatMap(o=>o.items),n=i.map((o,r)=>{const c=i.slice(0,r).reduce((d,l)=>d+l.length,0);return{...o,offset:c}});return e.jsxs("div",{className:"flex w-full flex-col items-center gap-4",children:[e.jsx("div",{className:"bg-tertiary w-full shrink-0 overflow-x-auto rounded-sm",children:e.jsxs(Lt,{className:"w-full table-auto border-separate border-spacing-4 text-left","aria-label":"Chunks table",children:[e.jsx(Vt,{className:"text-tertiary",children:["Index","Offset","Length","Chunk","Entropy"].map(o=>e.jsx(_t,{isRowHeader:o==="Index",className:o==="Index"?"w-1/9":"w-2/9",children:e.jsx(b,{size:"sm",children:o})},o))}),e.jsx(Et,{className:"text-primary",children:n.map((o,r)=>e.jsxs(b,{size:"sm",weight:"medium",as:c=>e.jsx(Mt,{...c},r),children:[e.jsx(_,{children:r}),e.jsx(_,{children:o.offset}),e.jsx(_,{children:o.length}),e.jsx(_,{children:e.jsx(oe,{value:o.contentMAC,size:"sm",weight:"medium"})}),e.jsx(_,{children:o.entropy.toFixed(2)})]},r))})]})}),a.hasNextPage&&e.jsx(D,{size:"md",variant:"secondary",onPress:()=>a.fetchNextPage(),children:"Load more"})]})}function Cs({snapshot:s,entry:t}){return t.file_info.mode.isRegular()?e.jsx(Ds,{snapshot:s,entry:t}):e.jsx(E,{type:"warning",children:"Cannot preview non-regular files."})}function Ds({snapshot:s,entry:t}){const a=te(10485760),i=te(1024*1024*50),[n,o]=m.useState(t.file_info.size.Value>=a.Value),{data:r,error:c,isPending:d}=J(De({snapshot:s.identifier.Value,path:t.path}));return d?e.jsx(Y,{}):c?e.jsx(E,{type:"error",children:c.message}):e.jsx("div",{className:"flex h-full min-h-0 flex-col gap-4",children:t.file_info.size.Value>=i.Value?e.jsxs(E,{type:"warning",children:["The file is ",t.file_info.size.Pretty,", exceeding the"," ",i.Pretty," display size limit."]}):n?e.jsx(E,{type:"warning",actions:[e.jsx(D,{onPress:()=>o(!1),variant:"secondary",children:"Display the file anyway"})],children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("p",{children:["The file is ",t.file_info.size.Pretty,", which may take a while to load."]})})}):r.type.resolved==="text"||r.type.resolved=="json"?e.jsx(zs,{snapshot:s,path:t.path,signature:r.signature,entropy:t.object?.entropy,contentType:t.object?.content_type,contentMAC:t.object?.contentMAC}):r.type.resolved==="image"?e.jsx(Is,{snapshot:s,path:t.path,signature:r.signature}):r.type.resolved==="pdf"?e.jsx(Ts,{snapshot:s,path:t.path,signature:r.signature}):r.type.resolved==="video"?e.jsx(Rs,{snapshot:s,path:t.path,signature:r.signature}):r.type.resolved==="audio"?e.jsx(Ks,{snapshot:s,path:t.path,signature:r.signature}):e.jsxs(E,{type:"warning",children:["Unknown file type: ",r.type.raw]})})}function E({type:s,...t}){return e.jsx("div",{className:"p-4",children:e.jsx(re,{variant:s==="error"?"error":"warning",title:"Unable to preview file",...t})})}function zs({snapshot:s,path:t,signature:a,entropy:i,contentType:n,contentMAC:o}){const r=[{id:"highlight",name:"Syntax highlighting"},{id:"plain",name:"Plain text preview"},{id:"rendered",name:"Rendered"}],[c,d]=xt("filePreviewType","highlight"),[l,f]=m.useState(!1),u=c==="highlight"?"code":c==="plain"?"text_styled":"auto",g=new B(s.identifier.Value,t).getPublicUrl(a,{render:u}),x=$=>{$!==c&&(d(String($)),f(!1))},y=ms(l);return e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col",children:[y&&e.jsx(Y,{className:"bg-[#282a36]"}),e.jsx("iframe",{src:g,onLoad:()=>f(!0),sandbox:"",className:P("h-full min-h-0 w-full flex-1",y&&"hidden"),style:{colorScheme:"dark",backgroundColor:"black"}}),e.jsxs("div",{className:"border-terminal bg-terminal flex w-full flex-wrap items-center justify-between border-t px-3 py-1",children:[e.jsxs(b,{size:"xs",className:"text-terminal flex flex-1 flex-wrap items-baseline justify-start gap-x-6",children:[e.jsx("span",{children:n}),i&&e.jsxs("span",{className:"hidden md:block",children:["Entropy:"," ",e.jsx(b,{as:"span",size:"sm",weight:"medium",children:i.toFixed(2)})]}),o&&e.jsx(oe,{value:o,size:"xs",className:"hidden md:block"})]}),e.jsx(Rt,{selectedKey:c,defaultSelectedKey:r[0].id,options:r,onSelectionChange:x,variant:"terminal",className:"w-46"})]})]})}function Is({snapshot:s,path:t,signature:a}){const n=new B(s.identifier.Value,t).getPublicUrl(a);return e.jsx("div",{className:"max-h-full max-w-full object-contain",children:e.jsx("img",{src:n})})}function Ts({snapshot:s,path:t,signature:a}){const n=new B(s.identifier.Value,t).getPublicUrl(a);return e.jsx("embed",{src:n,type:"application/pdf",width:"100%",height:"100%"})}function Rs({snapshot:s,path:t,signature:a}){const n=new B(s.identifier.Value,t).getPublicUrl(a);return e.jsx("video",{controls:!0,width:"100%",children:e.jsx("source",{src:n})})}function Ks({snapshot:s,path:t,signature:a}){const n=new B(s.identifier.Value,t).getPublicUrl(a);return e.jsx("audio",{controls:!0,children:e.jsx("source",{src:n})})}function Ls({vfsEntry:s}){const{file_info:t}=s,a=[e.jsx(le,{mode:t.mode}),e.jsx(k,{label:`${t.size.Value.toString()} bytes`,children:e.jsx("span",{role:"button",children:t.size.Pretty})}),e.jsxs(e.Fragment,{children:[t.uid," ",t.username]}),e.jsxs(e.Fragment,{children:[t.gid," ",t.groupname]}),e.jsx(k,{label:t.mod_time.Value,children:e.jsx("span",{role:"button",children:t.mod_time.toHumanString()})})];return e.jsx("div",{className:"border-accent-heavy ml-4 flex shrink-0 overflow-x-auto border-l-2 pl-2",children:e.jsx("div",{className:"flex gap-4",children:a.map((i,n)=>e.jsx(b,{size:"sm",weight:"medium",className:"text-primary whitespace-nowrap",children:i},n))})})}function Vs({snapshot:s,path:t,onSnapshotChange:a}){const i=J(bt({snapshot:s.identifier.Value,path:t}));return i.isPending?e.jsx(Y,{}):i.isError?e.jsx("div",{className:"p-4",children:e.jsx(re,{variant:"error",title:"Unable to preview file",children:i.error.message})}):e.jsx(_s,{snapshot:s,vfsEntry:i.data.item,onSnapshotChange:a})}function _s({snapshot:s,vfsEntry:t,onSnapshotChange:a}){const{data:i,isPending:n,isError:o}=J(De({snapshot:s.identifier.Value,path:t.path})),r=ne(Fe({snapshot:s,vfsEntry:t,page:0,perPage:5})),c=fs(r.data?.pages[0].response.total||0),d=[{id:"preview",title:"Preview",content:e.jsx(Cs,{snapshot:s,entry:t})},{id:"timeline",title:"Timeline",tag:c.Value?c.Pretty:void 0,content:e.jsx("div",{className:"p-4",children:e.jsx(Ke,{snapshot:s,vfsEntry:t,onSnapshotChange:a})})},{id:"details",title:"Details",content:e.jsx("div",{className:"p-4",children:e.jsx(Ns,{snapshot:s,preview:t})})}],[l,f]=m.useState(d[0].id),{mode:u}=t.file_info,p=u.isRegular(),g=u.isSymlink();return e.jsxs("div",{className:"flex h-full flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsxs(b,{as:"h2",className:"text-primary flex items-center gap-2",children:[p&&e.jsx(Te,{contentType:t.object?.content_type}),g&&e.jsx(w,{type:"md-link",size:"xl"}),ie.basename(t.path)]}),e.jsx(D,{leftIcon:"download",variant:"tertiary",size:"sm",href:i?.downloadUrl,isDisabled:n||!i?.downloadUrl||o,download:!0,children:"Download"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Ls,{vfsEntry:t})}),e.jsx(es,{ariaLabel:"Preview tabs",variant:"underlined",items:d,className:"flex h-full min-h-0 flex-col",selected:l,onSelectionChange:x=>f(String(x))})]})}function Es({snapshotId:s,scannedDirectory:t,path:a}){return e.jsx(jt,{children:Ot(s,t,a)})}const Z=wt();function Ms({snapshot:s,vfsEntry:t,page:a,perPage:i,filters:n,onPageChange:o,onPathChange:r,onSnapshotChange:c,preview:d,onPreviewChange:l}){const f=Object.values(n).some(h=>h),u=J({...gt({snapshot:s.identifier.Value,vfsEntry:t,page:a,perPage:i,search:f?{contentTypes:n.mime?.contentTypes,filename:n.filename}:void 0}),placeholderData:vt}),p=m.useMemo(()=>[Z.accessor("file_info.name",{header:()=>"Name",cell:({row:{original:h}})=>{const{mode:j,name:C}=h.file_info,N=j.isDir(),z=j.isRegular(),A=j.isSymlink(),U=h.summary?.Total.errors??0,Ee=N&&C!==".."&&U>0,he=ie.relative(t.path,h.parent_path);return e.jsxs("div",{className:"grid grid-cols-[auto_1fr] items-center gap-1",children:[e.jsxs("div",{className:"flex h-6 items-center",children:[N&&e.jsxs(e.Fragment,{children:[Ee&&e.jsx(k,{label:`${U} errors in this directory`,offset:4,children:e.jsx(w,{type:"md-error",size:"xl",className:"text-error",role:"button"})}),e.jsx(w,{type:"md-folder",size:"xl"})]}),z&&e.jsx(Te,{contentType:h.object?.content_type}),A&&e.jsx(w,{type:"md-link",size:"xl"})]}),N?e.jsx(b,{variant:"body",size:"sm",className:P("cursor-pointer break-all text-left hover:underline"),as:M,onPress:()=>{N&&r(h.path)},children:C}):e.jsx(b,{variant:"body",size:"sm",className:"break-all",as:"span",children:C}),he&&u.data?.isSearching&&e.jsx(b,{variant:"body",size:"xs",className:"text-tertiary col-start-2 w-fit cursor-pointer break-all text-left hover:underline",as:M,onPress:()=>{r(h.parent_path)},children:he})]})}}),Z.display({id:"size",meta:{cellClassName:"md:w-[15%]"},header:()=>"Size",cell:({row:{original:h}})=>{if(h.file_info.name==="..")return;const C=h.file_info.mode.isDir()?h.summary?.Total.size:h.file_info.size,N=C?.Value?.toString()??"0",z=C?.Pretty,A=h.weight.directory,U=A>1?` (${A.toFixed(0)}%)`:"";return e.jsx(k,{label:`${N} bytes`,offset:4,children:e.jsx("span",{className:"inline-block",role:"button",children:e.jsxs(b,{variant:"body",size:"sm",className:"text-secondary w-fit whitespace-nowrap",children:[z,U]})})})}}),Z.accessor("file_info.mod_time",{meta:{cellClassName:"md:w-[20%]"},header:()=>"Modified",cell:h=>{const j=h.getValue();if(!(h.row.original.file_info.name===".."||!j.toHumanString()))return e.jsx(k,{label:j.Value,offset:4,children:e.jsx("span",{className:"inline-block",role:"button",children:e.jsx(b,{variant:"body",size:"sm",className:"text-secondary",children:j.toHumanString()})})})}})],[r,u.data?.isSearching,t.path]),g={pageIndex:a,pageSize:i},[x,y]=m.useState([]),$=x.reduce((h,j)=>(h[j.path]=!0,h),{}),L=$t({data:u.data?.items??[],rowCount:u.data&&yt(u.data)?u.data.total:void 0,columns:p,state:{pagination:g,rowSelection:$},enableRowSelection:h=>h.original.file_info.name!=="..",onRowSelectionChange:h=>{const j=typeof h=="function"?h($):h;y(C=>Object.keys(j).map(N=>C.find(z=>N===z.path)||u.data?.items.find(z=>N===z.path)).filter(N=>N!==void 0))},getRowId:h=>h.path,manualPagination:!0,onPaginationChange:h=>{const j=typeof h=="function"?h(g):h;o(j.pageIndex,j.pageSize)},getCoreRowModel:Pt()}),v=u.data?.items??[],F=v.findIndex(h=>h.path===d),R=v.slice(F+1),Le=F===-1?[]:v.slice(0,F).reverse(),ce=R.findIndex(h=>!h.file_info.mode.isDir()),de=Le.findIndex(h=>!h.file_info.mode.isDir()),ue=ce===-1,fe=de===-1,Ve=()=>{if(ue)return;const h=v[F+1+ce];h&&l(h.path)},_e=()=>{if(fe)return;const h=v[F-de-1];h&&l(h.path)};return e.jsx(ps,{main:e.jsx(Dt,{title:t.file_info.name,isLoading:u.isFetching,breadcrumb:e.jsx(Es,{snapshotId:s.identifier,scannedDirectory:s.sources[0].importer.directory,path:t.path}),children:e.jsxs("div",{className:P(x.length>0&&"mb-18"),children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(bs,{snapshot:s,childEntry:t,onSnapshotChange:c}),t.summary&&t.summary.Total.errors>0&&e.jsx($s,{snapshot:s,vfsEntry:t}),e.jsx(St,{query:u,table:L,softSelectionState:[v.find(h=>h.path===d)??null,h=>{h&&l(h.path)}],isSoftSelectionEnabledForRow:h=>!h.file_info.mode.isDir(),filters:e.jsx(gs,{}),ariaLabel:"Snapshot files table",isLoading:u.isFetching})]}),x.length>0&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 -translate-y-1/2",children:e.jsx(vs,{snapshot:s,childEntries:x,removeSelection:()=>y([])})})]})}),sidebar:d&&e.jsx(Vs,{snapshot:s,path:d,onSnapshotChange:c}),controls:[{icon:"chevron-down",tooltip:"Next file",isDisabled:ue,onPress:Ve},{icon:"chevron-up",tooltip:"Previous file",isDisabled:fe,onPress:_e}],onCollapse:()=>l(void 0)})}function ia(){const s=I.useParams(),t=I.useLoaderDeps(),a=I.useSearch(),i=I.useLoaderData(),n=I.useNavigate(),o=ee.find(u=>u.id===a.mime),r=()=>n({to:"/snapshots"}),c=m.useCallback(u=>n({params:{snapshotId:s.snapshotId},search:p=>({...p,path:u,page:0})}),[n,s.snapshotId]),d=m.useCallback((u,p)=>n({search:g=>({...g,page:g.per_page!==p?0:u,per_page:p})}),[n]),l=m.useCallback(u=>{n({params:{snapshotId:u},search:p=>({...p,page:0})})},[n]),f=m.useCallback(u=>{n({params:{snapshotId:s.snapshotId},search:p=>({...p,preview:u}),replace:!0})},[n,s.snapshotId]);return hs({keys:["Escape"],action:()=>{const u=ie.dirname(t.path);u===""||u==="/"||u.length<i.getSnapshotResponse.item.sources[0].importer.directory.Value.length?r():c(u+"/")}}),e.jsx(Ms,{snapshot:i.getSnapshotResponse.item,vfsEntry:i.getSnapshotPathResponse.item,page:a.page,perPage:a.per_page,filters:{mime:o,filename:a.filename},onPageChange:d,onPathChange:c,onSnapshotChange:l,preview:a.preview,onPreviewChange:f},s.snapshotId)}export{ia as component};
