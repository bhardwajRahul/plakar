import{r as v,aF as m,w as j,a8 as S,j as e,t as N,T as g,ah as R,v as I,aG as T,aH as h}from"./index-Aj8lmPfQ.js";import{A as E}from"./alert-DTC5gTl3.js";import{E as P,a as z}from"./expandable-list-DmmBacHh.js";import{F as A}from"./filters-CDn4ay5S.js";import{u as y}from"./useQuery-D2qmIidq.js";import{u as C}from"./useSuspenseQuery-DpMyaBMz.js";import{M as _}from"./main-Ds-kxHfS.js";import{c as Q,u as k,g as M,P as O}from"./paginated-table-DM9J9R9a.js";import"./useBaseQuery-CGDUSr1J.js";import"./Table-C77OlBPR.js";import"./empty-list-CA93N3UA.js";import"./pagination-Bv4QYb70.js";const V="This repository uses a non-browsable storage, snapshots cannot be inspected.";function Y(){const[o,c]=v.useState({}),x=m.useNavigate(),n=m.useSearch(),d=m.useRouteContext(),l=C(j(d.klosetAPI,{repository:void 0})).data.item.browsable,p=y(S(d.klosetAPI,{repository:void 0,importer:n.importer,pagination:{page:n.page,perPage:n.per_page}})),s=Q(),i=[s.display({id:"identifier",header:()=>"ID",cell:a=>{const t=a.row.original,r=t.identifier.Value,b=t.total.errors;return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(N,{value:r,className:"text-primary"}),e.jsx(P,{length:b})]})}}),s.accessor("timestamp",{header:()=>"Date",cell:a=>{const t=a.getValue();return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(g,{variant:"body",size:"md",className:"text-primary whitespace-nowrap",children:t.relativeToNow()}),e.jsx(g,{variant:"body",size:"sm",className:"text-secondary",children:t.toHumanString()})]})}}),s.display({id:"importer-type",header:()=>"Source",meta:{cellClassName:"w-[60%] max-w-0 min-w-80"},cell:({row:{original:a}})=>{const t=a.tags.filter(r=>r.trim());return e.jsxs("div",{className:"flex w-full min-w-0 items-baseline gap-4",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(z,{items:a.sources.map(r=>({tag:r.importer.type,value:r.importer.origin,subValue:r.importer.directory.toHumanString()}))})}),t.length>0&&e.jsx("span",{className:"flex min-w-0 max-w-[40%] flex-initial flex-wrap items-start gap-1",children:t.filter(r=>r.trim()).map(r=>e.jsx(R,{size:"sm",variant:"blue_borderless",radius:"sqrt",children:r},r))})]})}}),s.accessor("total",{id:"summary",header:()=>"Stats",cell:a=>{const t=a.getValue();return e.jsxs("div",{className:"flex flex-col gap-1 whitespace-nowrap",children:[e.jsx(g,{variant:"body",size:"md",className:"text-primary",children:t.size.Pretty}),e.jsxs(g,{variant:"body",size:"sm",className:"text-secondary",children:[t.files," ",t.files===1?"item":"items"]})]})}})],u={pageIndex:n.page,pageSize:n.per_page},w=k({data:p.data?.items??[],rowCount:p.data?.total,columns:i,state:{pagination:u,rowSelection:o},onRowSelectionChange:c,enableMultiRowSelection:!1,onPaginationChange:a=>{const t=typeof a=="function"?a(u):a;x({search:r=>({...r,page:r.per_page!==t.pageSize?0:t.pageIndex,per_page:t.pageSize})})},manualPagination:!0,getCoreRowModel:M()});return e.jsx(_,{icon:"folder-tree",iconBadgeType:"stores",title:"Snapshots",description:"Browse backups and restore files.",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[!l&&e.jsx(E,{title:"This snapshot repository is not browsable.",variant:"warning",children:V}),e.jsx(O,{query:p,table:w,filters:e.jsx(H,{}),variant:"cards",skeleton:"two-rows",getLink:l?a=>({to:"/snapshots/$snapshotId/$source/browse",params:{snapshotId:a.identifier.Value,source:0},search:{path:a.sources[0].importer.directory.Value}}):void 0,ariaLabel:"Snapshots table"})]})})}function H(){const o=m.useSearch(),c=m.useNavigate(),{api:x}=I(),{data:n,isPending:d,isError:f}=y(T(x,{repository:void 0})),l=n?.items.map(s=>({id:s.name,name:s.name}))||[],p=[{key:"importer",value:o.importer}];return e.jsxs("div",{className:"flex w-full items-center justify-end gap-2",children:[e.jsx(h,{label:"Applied filters",onRemove:s=>{c({search:i=>({...i,importer:s.has("importer")?"":i.importer,page:0})})},children:p.map(({key:s,value:i})=>i?e.jsx(h.Item,{id:s,value:p.find(({key:u})=>u===o.importer)?.value||o.importer},s):null)}),e.jsx(A,{items:[{id:"importer",label:"Source type",options:l,isInvalid:!!o.importer&&!l.some(s=>s.id===o.importer),isDisabled:d||f||l.length===0}],defaultSelected:{importer:o.importer||null},onApply:s=>{c({search:i=>({...i,importer:s.importer||"",page:0})})}})]})}export{Y as component};
