import{aB as vn,a4 as De,aC as wn,aD as Sn,a5 as me,aE as Pn,aF as _t,aG as zn,r as p,aH as jn,aI as $n,aJ as Cn,aK as Nn,Y as In,R as X,aL as En,aM as Tt,Z as dt,a1 as ut,a2 as kn,a3 as Oe,aN as St,aO as Ht,aP as Kt,aQ as Rn,aR as Dn,aS as Ln,aT as Fn,j as a,aU as Pt,T as _,h as Ee,aV as Mn,i as q,I as G,a8 as An,f as ae,aW as Vt,M as Me,S as zt,B as le,t as _n,v as Tn,m as He,aX as Hn,aY as Kn,aZ as fe,al as Vn,aq as jt,a_ as rt,af as Bt,ag as Ot,ah as Bn,a$ as On,b0 as ot,b1 as je,b2 as Un,b3 as Gn,b4 as Wn,b5 as qn,F as Ue,b6 as Ut,u as Xn,b7 as Le,b8 as Jn,b9 as ft,ba as Qn,e as Ae,bb as Yn,bc as Zn,bd as es}from"./index-BX768Frx.js";import{u as Ge}from"./useQuery-DHwdh6Ld.js";import{c as ts,u as ns,g as ss,P as is}from"./paginated-table-BoD1fFcj.js";import{u as pt,a as as}from"./use-side-panel-CNojKWDu.js";import{F as rs}from"./filters-Dgl_na4J.js";import{$ as os,a as ls,S as cs}from"./select-fQyM9_P4.js";import{A as ht}from"./alert-BrzNrLBf.js";import{T as ds}from"./tag-DIbqHQC5.js";import{$ as us,a as fs,b as ps,c as hs,e as $e,d as ms}from"./Table-CYzl-NNc.js";import{I as mt}from"./id-DHkDYjrH.js";import{M as xs}from"./main-B6XIaWoX.js";import{u as bs}from"./use-breakpoint-BeTowhVH.js";import"./useBaseQuery-DCSHiJ5h.js";import"./useToggleState-DWs3jB3l.js";import"./empty-list-CHaQSvfG.js";const Gt=new WeakMap;function Ke(e,t,n){return e?(typeof t=="string"&&(t=t.replace(/\s+/g,"")),`${Gt.get(e)}-${n}-${t}`):""}function gs(e,t,n){let{key:s,isDisabled:i,shouldSelectOnPressUp:r}=e,{selectionManager:o,selectedKey:l}=t,c=s===l,d=i||t.isDisabled||t.selectionManager.isDisabled(s),{itemProps:h,isPressed:u}=vn({selectionManager:o,key:s,ref:n,isDisabled:d,shouldSelectOnPressUp:r,linkBehavior:"selection"}),f=Ke(t,s,"tab"),m=Ke(t,s,"tabpanel"),{tabIndex:x}=h,v=t.collection.getItem(s),w=De(v?.props,{labelable:!0});delete w.id;let z=wn(v?.props),{focusableProps:C}=Sn({isDisabled:d},n);return{tabProps:me(w,C,z,h,{id:f,"aria-selected":c,"aria-disabled":d||void 0,"aria-controls":c?m:void 0,tabIndex:d?void 0:x,role:"tab"}),isSelected:c,isDisabled:d,isPressed:u}}function ys(e,t,n){let s=Pn(n)?void 0:0;var i;const r=Ke(t,(i=e.id)!==null&&i!==void 0?i:t?.selectedKey,"tabpanel"),o=_t({...e,id:r,"aria-labelledby":Ke(t,t?.selectedKey,"tab")});return{tabPanelProps:me(o,{tabIndex:s,role:"tabpanel","aria-describedby":e["aria-describedby"],"aria-details":e["aria-details"]})}}class vs{getKeyLeftOf(t){return this.flipDirection?this.getNextKey(t):this.getPreviousKey(t)}getKeyRightOf(t){return this.flipDirection?this.getPreviousKey(t):this.getNextKey(t)}isDisabled(t){var n,s;return this.disabledKeys.has(t)||!!(!((s=this.collection.getItem(t))===null||s===void 0||(n=s.props)===null||n===void 0)&&n.isDisabled)}getFirstKey(){let t=this.collection.getFirstKey();return t!=null&&this.isDisabled(t)&&(t=this.getNextKey(t)),t}getLastKey(){let t=this.collection.getLastKey();return t!=null&&this.isDisabled(t)&&(t=this.getPreviousKey(t)),t}getKeyAbove(t){return this.tabDirection?null:this.getPreviousKey(t)}getKeyBelow(t){return this.tabDirection?null:this.getNextKey(t)}getNextKey(t){let n=t;do n=this.collection.getKeyAfter(n),n==null&&(n=this.collection.getFirstKey());while(n!=null&&this.isDisabled(n));return n}getPreviousKey(t){let n=t;do n=this.collection.getKeyBefore(n),n==null&&(n=this.collection.getLastKey());while(n!=null&&this.isDisabled(n));return n}constructor(t,n,s,i=new Set){this.collection=t,this.flipDirection=n==="rtl"&&s==="horizontal",this.disabledKeys=i,this.tabDirection=s==="horizontal"}}function ws(e,t,n){let{orientation:s="horizontal",keyboardActivation:i="automatic"}=e,{collection:r,selectionManager:o,disabledKeys:l}=t,{direction:c}=zn(),d=p.useMemo(()=>new vs(r,c,s,l),[r,l,s,c]),{collectionProps:h}=jn({ref:n,selectionManager:o,keyboardDelegate:d,selectOnFocus:i==="automatic",disallowEmptySelection:!0,scrollRef:n,linkBehavior:"selection"}),u=$n();Gt.set(t,u);let f=_t({...e,id:u});return{tabListProps:{...me(h,f),role:"tablist","aria-orientation":s,tabIndex:void 0}}}function Ss(e){var t,n;let s=os({...e,onSelectionChange:e.onSelectionChange?c=>{var d;c!=null&&((d=e.onSelectionChange)===null||d===void 0||d.call(e,c))}:void 0,suppressTextValueWarning:!0,defaultSelectedKey:(n=(t=e.defaultSelectedKey)!==null&&t!==void 0?t:$t(e.collection,e.disabledKeys?new Set(e.disabledKeys):new Set))!==null&&n!==void 0?n:void 0}),{selectionManager:i,collection:r,selectedKey:o}=s,l=p.useRef(o);return p.useEffect(()=>{let c=o;e.selectedKey==null&&(i.isEmpty||c==null||!r.getItem(c))&&(c=$t(r,s.disabledKeys),c!=null&&i.setSelectedKeys([c])),(c!=null&&i.focusedKey==null||!i.isFocused&&c!==l.current)&&i.setFocusedKey(c),l.current=c}),{...s,isDisabled:e.isDisabled||!1}}function $t(e,t){let n=null;if(e){var s,i,r,o;for(n=e.getFirstKey();n!=null&&(t.has(n)||!((i=e.getItem(n))===null||i===void 0||(s=i.props)===null||s===void 0)&&s.isDisabled)&&n!==e.getLastKey();)n=e.getKeyAfter(n);n!=null&&(t.has(n)||!((o=e.getItem(n))===null||o===void 0||(r=o.props)===null||r===void 0)&&r.isDisabled)&&n===e.getLastKey()&&(n=e.getFirstKey())}return n}const We=p.createContext(null),we=p.createContext(null),Ps=p.forwardRef(function(t,n){[t,n]=In(t,n,We);let{children:s,orientation:i="horizontal"}=t;return s=p.useMemo(()=>typeof s=="function"?s({orientation:i,defaultChildren:null}):s,[s,i]),X.createElement(En,{content:s},r=>X.createElement(zs,{props:t,collection:r,tabsRef:n}))});function zs({props:e,tabsRef:t,collection:n}){let{orientation:s="horizontal"}=e,i=Ss({...e,collection:n,children:void 0}),{focusProps:r,isFocused:o,isFocusVisible:l}=ut({within:!0}),c=p.useMemo(()=>({orientation:s,isFocusWithin:o,isFocusVisible:l}),[s,o,l]),d=Oe({...e,defaultClassName:"react-aria-Tabs",values:c}),h=De(e,{global:!0});return X.createElement("div",{...me(h,d,r),ref:t,slot:e.slot||void 0,"data-focused":o||void 0,"data-orientation":s,"data-focus-visible":l||void 0,"data-disabled":i.isDisabled||void 0},X.createElement(Ht,{values:[[We,e],[we,i]]},d.children))}const js=p.forwardRef(function(t,n){return p.useContext(we)?X.createElement($s,{props:t,forwardedRef:n}):X.createElement(Tt,t)});function $s({props:e,forwardedRef:t}){let n=p.useContext(we),{CollectionRoot:s}=p.useContext(Kt),{orientation:i="horizontal",keyboardActivation:r="automatic"}=Dn(We),o=dt(t),{tabListProps:l}=ws({...e,orientation:i,keyboardActivation:r},n,o),c=Oe({...e,children:null,defaultClassName:"react-aria-TabList",values:{orientation:i,state:n}}),d=De(e,{global:!0});return delete d.id,X.createElement("div",{...me(d,c,l),ref:o,"data-orientation":i||void 0},X.createElement(s,{collection:n.collection,persistedKeys:Ln(n.selectionManager.focusedKey)}))}class Wt extends Fn{}Wt.type="item";const Cs=Cn(Wt,(e,t,n)=>{let s=p.useContext(we),i=dt(t),{tabProps:r,isSelected:o,isDisabled:l,isPressed:c}=gs({key:n.key,...e},s,i),{focusProps:d,isFocused:h,isFocusVisible:u}=ut(),{hoverProps:f,isHovered:m}=kn({isDisabled:l,onHoverStart:e.onHoverStart,onHoverEnd:e.onHoverEnd,onHoverChange:e.onHoverChange}),x=Oe({...e,id:void 0,children:n.rendered,defaultClassName:"react-aria-Tab",values:{isSelected:o,isDisabled:l,isFocused:h,isFocusVisible:u,isPressed:c,isHovered:m}}),v=n.props.href?"a":"div",w=De(e,{global:!0});return delete w.id,delete w.onClick,X.createElement(v,{...me(w,x,r,d,f),ref:i,"data-selected":o||void 0,"data-disabled":l||void 0,"data-focused":h||void 0,"data-focus-visible":u||void 0,"data-pressed":c||void 0,"data-hovered":m||void 0},x.children)}),Ns=Nn(function(t,n){const s=p.useContext(we);let i=dt(n),{id:r,...o}=t,{tabPanelProps:l}=ys(t,s,i),{focusProps:c,isFocused:d,isFocusVisible:h}=ut(),u=s.selectedKey===t.id,f=Oe({...t,defaultClassName:"react-aria-TabPanel",values:{isFocused:d,isFocusVisible:h,isInert:St(!u),state:s}});if(!u&&!t.shouldForceMount)return null;let m=De(o,{global:!0});delete m.id;let x=u?me(m,l,c,f):f;return X.createElement("div",{...x,ref:i,"data-focused":d||void 0,"data-focus-visible":h||void 0,inert:St(!u||t.inert),"data-inert":u?void 0:"true"},X.createElement(Ht,{values:[[We,null],[we,null]]},X.createElement(Kt.Provider,{value:Rn},f.children)))});function Is({text:e,altText:t,onUnselect:n,children:s}){const i=X.Children.count(s)>0;return a.jsxs(ls,{"aria-label":"Selection controls",className:"bg-foreground-black m-4 flex w-fit items-center rounded-lg shadow-lg drop-shadow-lg",children:[a.jsxs(Pt,{"aria-label":"Items selected",className:"flex flex-col px-4 py-2 text-center",children:[a.jsxs("div",{className:"flex items-baseline gap-1 whitespace-nowrap",children:[a.jsx(_,{className:"text-on-brand",weight:"medium",size:"sm",children:e}),t&&a.jsx(_,{className:"text-on-brand",size:"xs",children:t})]}),a.jsx(_,{as:r=>a.jsx(Ee,{onPress:n,...r}),size:"xs",className:"text-tertiary cursor-pointer underline",children:"Unselect all"})]}),i&&a.jsxs(a.Fragment,{children:[a.jsx(Mn,{orientation:"vertical",className:"bg-border-primary w-[1px] shrink-0 self-stretch"}),a.jsx(Pt,{"aria-label":"Actions",className:"flex flex-wrap gap-2 px-2 py-2",children:s})]})]})}function Es({variant:e,ariaLabel:t,items:n,selected:s,className:i,onSelectionChange:r}){return a.jsxs(Ps,{selectedKey:s,onSelectionChange:r,className:i,children:[a.jsx(js,{"aria-label":t,items:n,className:q({"flex w-fit gap-2":e==="underlined","border-secondary bg-tertiary flex gap-1 rounded-lg border p-1":e==="pill","flex flex-col gap-4":e==="vertical"}),children:n.map(o=>a.jsxs(Cs,{id:o.id,className:q("flex flex-1 cursor-pointer items-center justify-center gap-3",e==="underlined"&&{"border-b-2 px-4 py-3":!0,"text-secondary hover:border-secondary hover:text-secondary data-selected:border-accent-heavy data-selected:text-primary border-transparent":s!==o.id,"border-accent-heavy text-primary":s===o.id},e==="pill"&&{"text-tertiary hover:bg-tertiary-hover data-selected:bg-accent data-selected:text-on-brand h-10 rounded-lg px-2 py-1.5":!0},e==="vertical"&&{"text-on-brand justify-start border-l-4 px-4 py-3":!0,"border-transparent":s!==o.id,"border-on-accent":s===o.id}),href:o.href,children:[a.jsx(_,{as:"span",size:e==="vertical"?"md":"sm",weight:s===o.id?"medium":"normal",children:o.title}),o.icon&&a.jsx(G,{type:o.icon,size:"md"}),o.tag&&a.jsx(ds,{variant:"heavy",radius:"sqrt",className:"-my-2",children:o.tag})]},o.id))}),a.jsx(Tt,{items:n,children:o=>a.jsx(Ns,{className:"flex h-full min-h-0 flex-col",children:o.content&&a.jsx("div",{className:"border-primary flex min-h-0 flex-1 flex-col border-t",children:o.content})})})]})}function ks(e,t){if(e===void 0)return{shouldBlockFn:()=>!0,withResolver:!1};if("shouldBlockFn"in e)return e;if(typeof e=="function")return{shouldBlockFn:async()=>await e(),enableBeforeUnload:!0,withResolver:!1};const n=!!(e.condition??!0),s=e.blockerFn;return{shouldBlockFn:async()=>n&&s!==void 0?await s():n,enableBeforeUnload:n,withResolver:s===void 0}}function Rs(e,t){const{shouldBlockFn:n,enableBeforeUnload:s=!0,disabled:i=!1,withResolver:r=!1}=ks(e),o=An(),{history:l}=o,[c,d]=p.useState({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0});return p.useEffect(()=>{const h=async u=>{function f(C){const E=o.parseLocation(C),L=o.getMatchedRoutes(E.pathname,void 0);if(L.foundRoute===void 0)throw new Error(`No route found for location ${C.href}`);return{routeId:L.foundRoute.id,fullPath:L.foundRoute.fullPath,pathname:E.pathname,params:L.routeParams,search:E.search}}const m=f(u.currentLocation),x=f(u.nextLocation),v=await n({action:u.action,current:m,next:x});if(!r)return v;if(!v)return!1;const z=await new Promise(C=>{d({status:"blocked",current:m,next:x,action:u.action,proceed:()=>C(!1),reset:()=>C(!0)})});return d({status:"idle",current:void 0,next:void 0,action:void 0,proceed:void 0,reset:void 0}),z};return i?void 0:l.block({blockerFn:h,enableBeforeUnload:s})},[n,s,i,r,l,o]),c}function Ds(e){return e.isSetuid()?"bg-red-500/80 text-white ring-red-500/80":e.isSetgid()?"bg-orange-500/80 text-white ring-orange-500/80":e.isSticky()?"bg-cyan-500/80 text-white ring-cyan-500/80":"text-primary"}function xt({mode:e,size:t="sm"}){const n=`${(e.Value&511).toString(8)}`,s=[e.isSetuid()&&"SETUID",e.isSetgid()&&"SETGID",e.isSticky()&&"STICKY"].filter(i=>i).join(" | ");return a.jsx(ae,{label:`${n} ${s}`,children:a.jsx("button",{children:a.jsx(_,{as:"span",variant:"body",size:t,weight:"medium",monospace:!0,className:q("rounded-xs whitespace-nowrap",Ds(e)),children:e.toString()})})})}function qt({snapshot:e,vfsEntry:t,variant:n="default",onSnapshotChange:s}){const i=pt(Vt({snapshot:e,vfsEntry:t,page:0,perPage:5}));if(i.error)return a.jsxs(a.Fragment,{children:[a.jsx(_,{size:"md",className:"text-secondary",children:"Unable to load snapshot history"}),a.jsxs(_,{size:"sm",className:"text-secondary",children:["An error occurred while fetching the snapshot history. You can try to reload the page: ",i.error.message]})]});if(i.isPending)return a.jsx(Me,{className:q(n==="compact"&&"max-h-[300px] min-w-[320px]"),unstyled:n==="default","aria-label":"Loading timeline",children:Array.from({length:7}).map((d,h)=>a.jsx(Me.Item,{leftIcon:"clock",label:a.jsx(zt,{variant:"text",size:"sm",className:"w-[144px]"}),altText:a.jsx(zt,{variant:"text",size:"xs",className:"w-[100px]"}),closeOnSelect:!1,className:q(n==="default"&&"border-primary mb-2 rounded-xl border p-4")},h))});const o=i.data.pages.map(d=>d.response.items).flat().map(d=>Ct(e,d,t,s,n)),c=i.data.pages[i.data.pages.length-1].response.total-o.length;return c>0&&(c>1&&o.push({id:"more",className:"border-0",label:a.jsxs(_,{variant:"body",size:"sm",className:q("text-tertiary",i.isFetching&&"animate-pulse"),children:[c-1," more snapshot",c-1>1?"s":""]}),alt:a.jsx(le,{variant:"secondary",size:n==="compact"?"sm":"md",onPress:()=>i.fetchNextPage(),isDisabled:i.isFetching,isPending:i.isFetching,children:"Load more"}),icon:"circle-plus",closeOnSelect:!1}),i.data.pages[0].lastEntry&&o.push(Ct(e,i.data.pages[0].lastEntry,t,s,n))),a.jsx(Me,{className:q(n==="compact"&&"max-h-[300px] min-w-[320px] overflow-auto"),unstyled:n==="default","aria-label":"Timeline",children:o.map(d=>a.jsx(Me.Item,{leftIcon:d.icon,label:d.label,altText:d.alt,onAction:d.onAction,className:q(n==="default"&&"mb-2 rounded-xl border p-4",d.className),closeOnSelect:d.closeOnSelect},d.id))})}const Ct=function(e,t,n,s,i){const r=n.object?n.object.contentMAC!==t.vfs_entry.object?.contentMAC:n.mac!==t.vfs_entry.mac,o=e.identifier.Value===t.snapshot.identifier.Value,l=o?void 0:()=>{s(t.snapshot.identifier.Value)};return{id:t.snapshot.identifier.Value,label:a.jsxs("div",{className:"group flex items-baseline gap-2",children:[a.jsx(_,{variant:"body",size:"sm",weight:"medium",className:q("text-primary",o&&"underline"),monospace:!0,children:t.snapshot.identifier.toHumanString()}),r&&a.jsx(G,{type:"not-equal",size:"xs"}),!o&&a.jsx(_,{variant:"body",size:i==="compact"?"xs":"sm",className:"text-tertiary",children:r?"Differences":"No changes"})]}),alt:t.snapshot.timestamp.relativeToNow(),icon:"clock",className:o?"border-accent-heavy":"cursor-pointer border-primary",onAction:l}};function Ls({snapshot:e,childEntry:t,onSnapshotChange:n}){const{file_info:{mod_time:s,mode:i,uid:r,username:o,gid:l,groupname:c}}=t,d=[{title:"Last modified",description:a.jsx(ae,{label:s.Value,children:a.jsx("span",{role:"button",children:s.toHumanString()})}),tooltip:s.Value},{title:"Mode",description:a.jsx(xt,{mode:i})},{title:"Owner user",description:a.jsxs(a.Fragment,{children:[r," ",o]})},{title:"Owner group",description:a.jsxs(a.Fragment,{children:[l," ",c]})},{title:"Version",description:a.jsxs(_n,{children:[a.jsxs(Ee,{className:"flex items-center gap-1 font-mono",children:[e.identifier.toHumanString(),a.jsx(G,{type:"caret-down",size:"sm"})]}),a.jsx(Tn,{offset:4,children:a.jsx(qt,{snapshot:e,vfsEntry:t,variant:"compact",onSnapshotChange:n})})]})}];return a.jsx(He,{direction:"row",size:"sm",children:d.map(h=>a.jsx(He.Item,{...h},h.title))})}function Fs(e){return typeof e=="function"}function Nt(e,...t){return Fs(e)?e(...t):e}function Ms(e){return e||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}class As extends Hn{constructor(t){super({pluginId:"pacer",debug:t?.debug})}}const _s=(e,t)=>{Xt.emit(e,t)},Xt=new As;function It(){return{canLeadingExecute:!0,executionCount:0,isPending:!1,lastArgs:void 0,status:"idle",maybeExecuteCount:0}}const Ts={enabled:!0,leading:!1,trailing:!0,wait:0};class Hs{constructor(t,n){this.fn=t,this.store=new Kn(It()),this.setOptions=s=>{this.options={...this.options,...s},this.#n()||this.cancel()},this.#e=s=>{this.store.setState(i=>{const r={...i,...s},{isPending:o}=r;return{...r,status:this.#n()?o?"pending":"idle":"disabled"}}),_s("Debouncer",this)},this.#n=()=>!!Nt(this.options.enabled,this),this.#a=()=>Nt(this.options.wait,this),this.maybeExecute=(...s)=>{if(!this.#n())return;this.#e({maybeExecuteCount:this.store.state.maybeExecuteCount+1});let i=!1;this.options.leading&&this.store.state.canLeadingExecute&&(this.#e({canLeadingExecute:!1}),i=!0,this.#s(...s)),this.options.trailing&&this.#e({isPending:!0,lastArgs:s}),this.#t&&clearTimeout(this.#t),this.#t=setTimeout(()=>{this.#e({canLeadingExecute:!0}),this.options.trailing&&!i&&this.#s(...s)},this.#a())},this.#s=(...s)=>{this.#n()&&(this.fn(...s),this.#e({executionCount:this.store.state.executionCount+1,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(s,this))},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&(this.#i(),this.#s(...this.store.state.lastArgs))},this.#i=()=>{this.#t&&(clearTimeout(this.#t),this.#t=void 0)},this.cancel=()=>{this.#i(),this.#e({canLeadingExecute:!0,isPending:!1})},this.reset=()=>{this.#e(It())},this.key=Ms(n.key),this.options={...Ts,...n},this.#e(this.options.initialState??{}),Xt.on("d-Debouncer",s=>{s.payload.key===this.key&&(this.#e(s.payload.store.state),this.setOptions(s.payload.options))})}#t;#e;#n;#a;#s;#i}function Ks(e,t){return new Hs(e,t).maybeExecute}function Vs(){const{mime:e,filename:t}=fe.useSearch(),n=fe.useNavigate(),[s,i]=p.useState(!1),[r,o]=p.useState(t),[l,c]=p.useState(t),d=p.useRef(Ks(c,{wait:300})).current;p.useEffect(()=>{o(t)},[t]),p.useEffect(()=>{s&&n({search:m=>({...m,page:0,filename:l||void 0})})},[l,n,s]);const h=m=>{i(!0);const x=m?String(m):"";o(x),d(x)},f=[{key:"mime",value:e}].filter(({value:m})=>m);return a.jsxs("div",{className:"flex w-full flex-wrap items-center gap-2 md:flex-nowrap",children:[a.jsx("div",{className:"order-1 flex-1",children:a.jsx(Vn,{icon:"magnifying-glass",placeholder:"Search filename: *.txt, tmp_*â€¦",className:"w-full sm:max-w-64 sm:flex-1",value:r,onChange:h,"aria-label":"Search filename",suffix:r?a.jsx(Ee,{"aria-label":"Clear text",onPress:()=>h(null),className:"inline-flex",children:a.jsx(G,{type:"close",size:"md"})}):void 0})}),f.length>0&&a.jsx("div",{className:"order-3 w-full md:order-2 md:w-auto",children:a.jsx(jt,{label:"Applied filters",onRemove:m=>{n({search:x=>({...x,mime:m.has("mime")?"":x.mime,page:0})})},children:f.map(({key:m,value:x})=>a.jsx(jt.Item,{id:m,value:rt.find(({id:v})=>v===e)?.name||x},m))})}),a.jsx("div",{className:"order-2 md:order-3",children:a.jsx(rs,{items:[{id:"mime",label:"File type",options:rt}],defaultSelected:{mime:e||null},onApply:m=>{n({search:x=>({...x,mime:m.mime||"",page:0})})}})})]})}const Bs=Ot({id:Bn()}).transform(e=>({url:`${On}/api/snapshot/vfs/downloader-sign-url/${e.id}?format=tarball`}));async function Os({snapshotId:e,paths:t}){const n=`/api/snapshot/vfs/downloader/${e}`,s=await Bt(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t.map(r=>({pathname:r}))})});let i;try{i=await s.json()}catch{throw new Error(`the API endpoint ${n} returned HTTP/${s.status} with an invalid JSON payload`)}try{return Bs.parse(i)}catch(r){throw new Error(`Failed to parse ${n} response: ${r}`)}}function Us({snapshot:e,childEntries:t,removeSelection:n}){const[s,i]=p.useState(!1),r=t.filter(d=>d.file_info.mode.isDir()).sort((d,h)=>d.file_info.name.localeCompare(h.file_info.name)),o=t.filter(d=>d.file_info.mode.isRegular()).sort((d,h)=>d.file_info.name.localeCompare(h.file_info.name)),l=ot(r.reduce((d,h)=>d+(h.summary?.Total.size.Value??0),0)+o.reduce((d,h)=>d+(h.file_info.size.Value??0),0)),c=async()=>{i(!0);const d=await Os({snapshotId:e.identifier.Value,paths:t.map(u=>u.path)}),h=document.createElement("a");h.style.display="none",h.target="_blank",h.href=d.url,document.body.appendChild(h),h.click(),document.body.removeChild(h),i(!1)};return a.jsxs(a.Fragment,{children:[a.jsx(Gs,{numberOfItemsSelected:r.length+o.length}),a.jsx(Is,{text:`${t.length} selected`,altText:l.Pretty,onUnselect:n,children:a.jsx(le,{variant:"primary",onPress:c,isPending:s,leftIcon:"download",children:"Download"})})]})}function Gs({numberOfItemsSelected:e}){const{proceed:t,reset:n,status:s}=Rs({shouldBlockFn:({current:i,next:r})=>!(e<2||i.pathname===r.pathname),withResolver:!0,enableBeforeUnload:!1});return a.jsx(je,{isDismissable:!0,isOpen:s==="blocked",onOpenChange:()=>n?.(),"aria-label":"Leaving the page?",children:a.jsxs(je.Dialog,{children:[a.jsx(je.Header,{title:"Leaving the page?",description:a.jsxs(a.Fragment,{children:["You have selected ",a.jsx("strong",{children:e})," files and directories."]})}),a.jsx(je.Content,{children:"If you leave this page, your selection will be lost."}),a.jsxs(je.Footer,{className:"flex flex-wrap justify-end gap-2",children:[a.jsx(le,{variant:"secondary",onPress:()=>n?.(),children:"Stay here"}),a.jsx(le,{variant:"error",onPress:()=>t?.(),children:"Leave the page"})]})]})})}function Ws({snapshot:e,vfsEntry:t}){const n=t.summary?.Total.errors??"several";return a.jsxs(ht,{title:"Unable to backup some files in this directory",variant:"error",actions:a.jsx(le,{variant:"secondary",href:{to:"/snapshots/$snapshotId/errors",params:{snapshotId:e.identifier.Value},search:{path:t.path}},children:"View Errors"}),children:["Backup completed with ",a.jsxs("strong",{children:[n," errors"]})," in this directory and its subdirectories."]})}function Jt({contentType:e,size:t="lg"}){return e?.startsWith("image")?a.jsx(G,{type:"md-image",size:t}):e==="application/pdf"?a.jsx(G,{type:"md-picture-as-pdf",size:t}):e?.startsWith("video")?a.jsx(G,{type:"md-video-file",size:t}):e?.startsWith("audio")?a.jsx(G,{type:"md-audio-file",size:t}):e==="application/zip"?a.jsx(G,{type:"md-folder-zip",size:t}):a.jsx(G,{type:"md-file-copy",size:t})}const qs=Ot({total:Wn(),items:Gn(qn)});async function Xs({snapshotId:e,path:t,pagination:n}){const s=new URLSearchParams({...Un(n)}),i=`/api/snapshot/vfs/chunks/${e}:${encodeURIComponent(t)}?${s}`,r=await Bt(i);let o;try{o=await r.json()}catch{throw new Error(`the API endpoint ${i} returned HTTP/${r.status} with an invalid JSON payload`)}try{return qs.parse(o)}catch(l){throw new Error(`Failed to parse ${i} response: ${l}`)}}function Js({preview:e,snapshot:t}){return a.jsxs("div",{className:"flex w-full flex-col gap-8",children:[a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx(_,{as:"h3",size:"sm",className:"text-primary",weight:"medium",variant:"heading",children:"General information"}),a.jsx(Qs,{fileEntry:e})]}),e.file_info.mode.isRegular()&&a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx(_,{as:"h3",size:"sm",className:"text-primary",weight:"medium",variant:"heading",children:"Advanced"}),a.jsx(Ys,{snapshot:t,fileEntry:e})]})]})}function Qs({fileEntry:e}){const{mode:t,mod_time:n,size:s,uid:i,username:r,gid:o,groupname:l}=e.file_info,c=e.object,d=[{show:t.isRegular(),label:"Checksum",content:a.jsx(mt,{value:c?.contentMAC??"",size:"sm",weight:"medium"})},{label:"Modified",content:a.jsx(ae,{label:n.Value,children:a.jsx("span",{role:"button",children:n.toHumanString()})})},{label:"Size",content:a.jsx(ae,{label:`${s.Value.toString()} bytes`,children:a.jsx("span",{role:"button",children:s.Pretty})})},{label:"Mode",content:a.jsx(xt,{mode:t,size:"sm"})},{show:t.isSymlink(),label:"Symlink target",content:e.symlink_target},{show:t.isRegular(),label:"Content Type",content:c?.content_type},{label:"Owner user",content:`${i} ${r}`},{label:"Owner group",content:`${o} ${l}`},{show:t.isRegular(),label:"Entropy",content:c?.entropy.toFixed(2)}];return a.jsx(He,{direction:"col",size:"sm",children:d.filter(h=>h.show!==!1).map(({label:h,content:u})=>a.jsx(He.Item,{title:h,description:u},h))})}function Ys({snapshot:e,fileEntry:t}){const n=pt({queryKey:["chunks",e.identifier.Value,t.path],initialPageParam:{page:0,perPage:10},queryFn:async({pageParam:r})=>Xs({snapshotId:e.identifier.Value,path:t.path,pagination:{page:r.page,perPage:r.perPage}}),getNextPageParam:(r,o,l)=>{if(r&&!((l.page+1)*l.perPage>=r.total))return{page:l.page+1,perPage:l.perPage}}});if(n.isError)return null;if(n.isPending)return a.jsx(Ue,{});const s=n.data.pages.flatMap(r=>r.items),i=s.map((r,o)=>{const l=s.slice(0,o).reduce((c,d)=>c+d.length,0);return{...r,offset:l}});return a.jsxs("div",{className:"flex w-full flex-col items-center gap-4",children:[a.jsx("div",{className:"bg-tertiary w-full shrink-0 overflow-x-auto rounded-sm",children:a.jsxs(us,{className:"w-full table-auto border-separate border-spacing-4 text-left","aria-label":"Chunks table",children:[a.jsx(fs,{className:"text-tertiary",children:["Index","Offset","Length","Chunk","Entropy"].map(r=>a.jsx(ps,{isRowHeader:r==="Index",className:r==="Index"?"w-1/9":"w-2/9",children:a.jsx(_,{size:"sm",children:r})},r))}),a.jsx(hs,{className:"text-primary",children:i.map((r,o)=>a.jsxs(_,{size:"sm",weight:"medium",as:l=>a.jsx(ms,{...l},o),children:[a.jsx($e,{children:o}),a.jsx($e,{children:r.offset}),a.jsx($e,{children:r.length}),a.jsx($e,{children:a.jsx(mt,{value:r.contentMAC,size:"sm",weight:"medium"})}),a.jsx($e,{children:r.entropy.toFixed(2)})]},o))})]})}),n.hasNextPage&&a.jsx(le,{size:"md",variant:"secondary",onPress:()=>n.fetchNextPage(),children:"Load more"})]})}function Zs(e){const[n,s]=p.useState(e);return p.useEffect(()=>{if(e){s(!1);return}const i=setTimeout(()=>{s(!0)},100);return()=>clearTimeout(i)},[e,100]),n}function ei({snapshot:e,entry:t}){return t.file_info.mode.isRegular()?a.jsx(ti,{snapshot:e,entry:t}):a.jsx(Ce,{type:"warning",children:"Cannot preview non-regular files."})}function ti({snapshot:e,entry:t}){const n=ot(10485760),s=ot(1024*1024*50),[i,r]=p.useState(t.file_info.size.Value>=n.Value),{data:o,error:l,isPending:c}=Ge(Ut({snapshot:e.identifier.Value,path:t.path}));return c?a.jsx(Ue,{}):l?a.jsx(Ce,{type:"error",children:l.message}):a.jsx("div",{className:"flex h-full min-h-0 flex-col gap-4",children:t.file_info.size.Value>=s.Value?a.jsxs(Ce,{type:"warning",children:["The file is ",t.file_info.size.Pretty,", exceeding the"," ",s.Pretty," display size limit."]}):i?a.jsx(Ce,{type:"warning",actions:[a.jsx(le,{onPress:()=>r(!1),variant:"secondary",children:"Display the file anyway"})],children:a.jsx("div",{className:"flex flex-col gap-4",children:a.jsxs("p",{children:["The file is ",t.file_info.size.Pretty,", which may take a while to load."]})})}):o.type.resolved==="text"||o.type.resolved=="json"?a.jsx(ni,{snapshot:e,path:t.path,signature:o.signature,entropy:t.object?.entropy,contentType:t.object?.content_type,contentMAC:t.object?.contentMAC}):o.type.resolved==="image"?a.jsx(si,{snapshot:e,path:t.path,signature:o.signature}):o.type.resolved==="pdf"?a.jsx(ii,{snapshot:e,path:t.path,signature:o.signature}):o.type.resolved==="video"?a.jsx(ai,{snapshot:e,path:t.path,signature:o.signature}):o.type.resolved==="audio"?a.jsx(ri,{snapshot:e,path:t.path,signature:o.signature}):a.jsxs(Ce,{type:"warning",children:["Unknown file type: ",o.type.raw]})})}function Ce({type:e,...t}){return a.jsx("div",{className:"p-4",children:a.jsx(ht,{variant:e==="error"?"error":"warning",title:"Unable to preview file",...t})})}function ni({snapshot:e,path:t,signature:n,entropy:s,contentType:i,contentMAC:r}){const o=[{id:"highlight",name:"Syntax highlighting"},{id:"plain",name:"Plain text preview"},{id:"rendered",name:"Rendered"}],[l,c]=Xn("filePreviewType","highlight"),[d,h]=p.useState(!1),u=l==="highlight"?"code":l==="plain"?"text_styled":"auto",m=new Le(e.identifier.Value,t).getPublicUrl(n,{render:u}),x=w=>{w!==l&&(c(String(w)),h(!1))},v=Zs(d);return a.jsxs("div",{className:"flex min-h-0 flex-1 flex-col",children:[v&&a.jsx(Ue,{className:"bg-[#282a36]"}),a.jsx("iframe",{src:m,onLoad:()=>h(!0),sandbox:"",className:q("h-full min-h-0 w-full flex-1",v&&"hidden"),style:{colorScheme:"dark",backgroundColor:"black"}}),a.jsxs("div",{className:"border-terminal bg-terminal flex w-full flex-wrap items-center justify-between border-t px-3 py-1",children:[a.jsxs(_,{size:"xs",className:"text-terminal flex flex-1 flex-wrap items-baseline justify-start gap-x-6",children:[a.jsx("span",{children:i}),s&&a.jsxs("span",{className:"hidden md:block",children:["Entropy:"," ",a.jsx(_,{as:"span",size:"sm",weight:"medium",children:s.toFixed(2)})]}),r&&a.jsx(mt,{value:r,size:"xs",className:"hidden md:block"})]}),a.jsx(cs,{selectedKey:l,defaultSelectedKey:o[0].id,options:o,onSelectionChange:x,variant:"terminal",className:"w-46"})]})]})}function si({snapshot:e,path:t,signature:n}){const i=new Le(e.identifier.Value,t).getPublicUrl(n);return a.jsx("div",{className:"max-h-full max-w-full object-contain",children:a.jsx("img",{src:i})})}function ii({snapshot:e,path:t,signature:n}){const i=new Le(e.identifier.Value,t).getPublicUrl(n);return a.jsx("embed",{src:i,type:"application/pdf",width:"100%",height:"100%"})}function ai({snapshot:e,path:t,signature:n}){const i=new Le(e.identifier.Value,t).getPublicUrl(n);return a.jsx("video",{controls:!0,width:"100%",children:a.jsx("source",{src:i})})}function ri({snapshot:e,path:t,signature:n}){const i=new Le(e.identifier.Value,t).getPublicUrl(n);return a.jsx("audio",{controls:!0,children:a.jsx("source",{src:i})})}function oi({vfsEntry:e}){const{file_info:t}=e,n=[a.jsx(xt,{mode:t.mode}),a.jsx(ae,{label:`${t.size.Value.toString()} bytes`,children:a.jsx("span",{role:"button",children:t.size.Pretty})}),a.jsxs(a.Fragment,{children:[t.uid," ",t.username]}),a.jsxs(a.Fragment,{children:[t.gid," ",t.groupname]}),a.jsx(ae,{label:t.mod_time.Value,children:a.jsx("span",{role:"button",children:t.mod_time.toHumanString()})})];return a.jsx("div",{className:"border-accent-heavy ml-4 flex shrink-0 overflow-x-auto border-l-2 pl-2",children:a.jsx("div",{className:"flex gap-4",children:n.map((s,i)=>a.jsx(_,{size:"sm",weight:"medium",className:"text-primary whitespace-nowrap",children:s},i))})})}function li(e){const t=["k","M","B"],n=[1e3,1e6,1e9];let s=`${e}`;for(let i=n.length-1;i>=0;i--){const r=n[i];if(e>=r){s=`${(e/r).toFixed(1).replace(/\.0$/,"")}${t[i]}`;break}}return{Value:e,Pretty:s}}function ci({snapshot:e,path:t,onSnapshotChange:n}){const s=Ge(Jn({snapshot:e.identifier.Value,path:t}));return s.isPending?a.jsx(Ue,{}):s.isError?a.jsx("div",{className:"p-4",children:a.jsx(ht,{variant:"error",title:"Unable to preview file",children:s.error.message})}):a.jsx(di,{snapshot:e,vfsEntry:s.data.item,onSnapshotChange:n})}function di({snapshot:e,vfsEntry:t,onSnapshotChange:n}){const{data:s,isPending:i,isError:r}=Ge(Ut({snapshot:e.identifier.Value,path:t.path})),o=pt(Vt({snapshot:e,vfsEntry:t,page:0,perPage:5})),l=li(o.data?.pages[0].response.total||0),c=[{id:"preview",title:"Preview",content:a.jsx(ei,{snapshot:e,entry:t})},{id:"timeline",title:"Timeline",tag:l.Value?l.Pretty:void 0,content:a.jsx("div",{className:"p-4",children:a.jsx(qt,{snapshot:e,vfsEntry:t,onSnapshotChange:n})})},{id:"details",title:"Details",content:a.jsx("div",{className:"p-4",children:a.jsx(Js,{snapshot:e,preview:t})})}],[d,h]=p.useState(c[0].id),{mode:u}=t.file_info,f=u.isRegular(),m=u.isSymlink();return a.jsxs("div",{className:"flex h-full flex-col gap-4",children:[a.jsxs("div",{className:"flex items-center justify-between px-4",children:[a.jsxs(_,{as:"h2",className:"text-primary flex items-center gap-2",children:[f&&a.jsx(Jt,{contentType:t.object?.content_type}),m&&a.jsx(G,{type:"md-link",size:"xl"}),ft.basename(t.path)]}),a.jsx(le,{leftIcon:"download",variant:"tertiary",size:"sm",href:s?.downloadUrl,isDisabled:i||!s?.downloadUrl||r,download:!0,children:"Download"})]}),a.jsx("div",{className:"hidden md:block",children:a.jsx(oi,{vfsEntry:t})}),a.jsx(Es,{ariaLabel:"Preview tabs",variant:"underlined",items:c,className:"flex h-full min-h-0 flex-col",selected:d,onSelectionChange:x=>h(String(x))})]})}const qe=p.createContext(null);qe.displayName="PanelGroupContext";const H={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},bt=10,pe=p.useLayoutEffect,Et=Qn.useId,ui=typeof Et=="function"?Et:()=>null;let fi=0;function gt(e=null){const t=ui(),n=p.useRef(e||t||null);return n.current===null&&(n.current=""+fi++),e??n.current}function Qt({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:i,forwardedRef:r,id:o,maxSize:l,minSize:c,onCollapse:d,onExpand:h,onResize:u,order:f,style:m,tagName:x="div",...v}){const w=p.useContext(qe);if(w===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:z,expandPanel:C,getPanelSize:E,getPanelStyle:L,groupId:J,isPanelCollapsed:R,reevaluatePanelConstraints:N,registerPanel:O,resizePanel:Q,unregisterPanel:B}=w,V=gt(o),b=p.useRef({callbacks:{onCollapse:d,onExpand:h,onResize:u},constraints:{collapsedSize:n,collapsible:s,defaultSize:i,maxSize:l,minSize:c},id:V,idIsFromProps:o!==void 0,order:f});p.useRef({didLogMissingDefaultSizeWarning:!1}),pe(()=>{const{callbacks:F,constraints:k}=b.current,A={...k};b.current.id=V,b.current.idIsFromProps=o!==void 0,b.current.order=f,F.onCollapse=d,F.onExpand=h,F.onResize=u,k.collapsedSize=n,k.collapsible=s,k.defaultSize=i,k.maxSize=l,k.minSize=c,(A.collapsedSize!==k.collapsedSize||A.collapsible!==k.collapsible||A.maxSize!==k.maxSize||A.minSize!==k.minSize)&&N(b.current,A)}),pe(()=>{const F=b.current;return O(F),()=>{B(F)}},[f,V,O,B]),p.useImperativeHandle(r,()=>({collapse:()=>{z(b.current)},expand:F=>{C(b.current,F)},getId(){return V},getSize(){return E(b.current)},isCollapsed(){return R(b.current)},isExpanded(){return!R(b.current)},resize:F=>{Q(b.current,F)}}),[z,C,E,R,V,Q]);const M=L(b.current,i);return p.createElement(x,{...v,children:e,className:t,id:V,style:{...M,...m},[H.groupId]:J,[H.panel]:"",[H.panelCollapsible]:s||void 0,[H.panelId]:V,[H.panelSize]:parseFloat(""+M.flexGrow).toFixed(1)})}const lt=p.forwardRef((e,t)=>p.createElement(Qt,{...e,forwardedRef:t}));Qt.displayName="Panel";lt.displayName="forwardRef(Panel)";let ct=null,Te=-1,re=null;function pi(e,t,n){const s=(t&nn)!==0,i=(t&sn)!==0,r=(t&an)!==0,o=(t&rn)!==0;if(t){if(s)return r?"se-resize":o?"ne-resize":"e-resize";if(i)return r?"sw-resize":o?"nw-resize":"w-resize";if(r)return"s-resize";if(o)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function hi(){re!==null&&(document.head.removeChild(re),ct=null,re=null,Te=-1)}function et(e,t,n){var s,i;const r=pi(e,t);if(ct!==r){if(ct=r,re===null&&(re=document.createElement("style"),document.head.appendChild(re)),Te>=0){var o;(o=re.sheet)===null||o===void 0||o.removeRule(Te)}Te=(s=(i=re.sheet)===null||i===void 0?void 0:i.insertRule(`*{cursor: ${r} !important;}`))!==null&&s!==void 0?s:-1}}function Yt(e){return e.type==="keydown"}function Zt(e){return e.type.startsWith("pointer")}function en(e){return e.type.startsWith("mouse")}function Xe(e){if(Zt(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(en(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function mi(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function xi(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function bi(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:Dt(e),b:Dt(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;$(s,"Stacking order can only be calculated for elements with a common ancestor");const i={a:Rt(kt(n.a)),b:Rt(kt(n.b))};if(i.a===i.b){const r=s.childNodes,o={a:n.a.at(-1),b:n.b.at(-1)};let l=r.length;for(;l--;){const c=r[l];if(c===o.a)return 1;if(c===o.b)return-1}}return Math.sign(i.a-i.b)}const gi=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function yi(e){var t;const n=getComputedStyle((t=tn(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function vi(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||yi(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||gi.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function kt(e){let t=e.length;for(;t--;){const n=e[t];if($(n,"Missing node"),vi(n))return n}return null}function Rt(e){return e&&Number(getComputedStyle(e).zIndex)||0}function Dt(e){const t=[];for(;e;)t.push(e),e=tn(e);return t}function tn(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const nn=1,sn=2,an=4,rn=8,wi=mi()==="coarse";let Z=[],ve=!1,oe=new Map,Je=new Map;const ke=new Set;function Si(e,t,n,s,i){var r;const{ownerDocument:o}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:i},c=(r=oe.get(o))!==null&&r!==void 0?r:0;return oe.set(o,c+1),ke.add(l),Ve(),function(){var h;Je.delete(e),ke.delete(l);const u=(h=oe.get(o))!==null&&h!==void 0?h:1;if(oe.set(o,u-1),Ve(),u===1&&oe.delete(o),Z.includes(l)){const f=Z.indexOf(l);f>=0&&Z.splice(f,1),Qe(),i("up",!0,null)}}}function Pi(e){const{target:t}=e,{x:n,y:s}=Xe(e);ve=!0,yt({target:t,x:n,y:s}),Ve(),Z.length>0&&(Be("down",e),Qe(),e.preventDefault(),on(t)||e.stopImmediatePropagation())}function tt(e){const{x:t,y:n}=Xe(e);if(ve&&e.type!=="pointerleave"&&e.buttons===0&&(ve=!1,Be("up",e)),!ve){const{target:s}=e;yt({target:s,x:t,y:n})}Be("move",e),Qe(),Z.length>0&&e.preventDefault()}function nt(e){const{target:t}=e,{x:n,y:s}=Xe(e);Je.clear(),ve=!1,Z.length>0&&(e.preventDefault(),on(t)||e.stopImmediatePropagation()),Be("up",e),yt({target:t,x:n,y:s}),Qe(),Ve()}function on(e){let t=e;for(;t;){if(t.hasAttribute(H.resizeHandle))return!0;t=t.parentElement}return!1}function yt({target:e,x:t,y:n}){Z.splice(0);let s=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(s=e),ke.forEach(i=>{const{element:r,hitAreaMargins:o}=i,l=r.getBoundingClientRect(),{bottom:c,left:d,right:h,top:u}=l,f=wi?o.coarse:o.fine;if(t>=d-f&&t<=h+f&&n>=u-f&&n<=c+f){if(s!==null&&document.contains(s)&&r!==s&&!r.contains(s)&&!s.contains(r)&&bi(s,r)>0){let x=s,v=!1;for(;x&&!x.contains(r);){if(xi(x.getBoundingClientRect(),l)){v=!0;break}x=x.parentElement}if(v)return}Z.push(i)}})}function st(e,t){Je.set(e,t)}function Qe(){let e=!1,t=!1;Z.forEach(s=>{const{direction:i}=s;i==="horizontal"?e=!0:t=!0});let n=0;Je.forEach(s=>{n|=s}),e&&t?et("intersection",n):e?et("horizontal",n):t?et("vertical",n):hi()}let it;function Ve(){var e;(e=it)===null||e===void 0||e.abort(),it=new AbortController;const t={capture:!0,signal:it.signal};ke.size&&(ve?(Z.length>0&&oe.forEach((n,s)=>{const{body:i}=s;n>0&&(i.addEventListener("contextmenu",nt,t),i.addEventListener("pointerleave",tt,t),i.addEventListener("pointermove",tt,t))}),oe.forEach((n,s)=>{const{body:i}=s;i.addEventListener("pointerup",nt,t),i.addEventListener("pointercancel",nt,t)})):oe.forEach((n,s)=>{const{body:i}=s;n>0&&(i.addEventListener("pointerdown",Pi,t),i.addEventListener("pointermove",tt,t))}))}function Be(e,t){ke.forEach(n=>{const{setResizeHandlerState:s}=n,i=Z.includes(n);s(e,i,t)})}function zi(){const[e,t]=p.useState(0);return p.useCallback(()=>t(n=>n+1),[])}function $(e,t){if(!e)throw console.error(t),Error(t)}function he(e,t,n=bt){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function ie(e,t,n=bt){return he(e,t,n)===0}function W(e,t,n){return he(e,t,n)===0}function ji(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const i=e[s],r=t[s];if(!W(i,r,n))return!1}return!0}function ye({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];$(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:i=0,collapsible:r,maxSize:o=100,minSize:l=0}=s;if(he(n,l)<0)if(r){const c=(i+l)/2;he(n,c)<0?n=i:n=l}else n=l;return n=Math.min(o,n),n=parseFloat(n.toFixed(bt)),n}function Ne({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:i,trigger:r}){if(W(e,0))return t;const o=[...t],[l,c]=s;$(l!=null,"Invalid first pivot index"),$(c!=null,"Invalid second pivot index");let d=0;if(r==="keyboard"){{const u=e<0?c:l,f=n[u];$(f,`Panel constraints not found for index ${u}`);const{collapsedSize:m=0,collapsible:x,minSize:v=0}=f;if(x){const w=t[u];if($(w!=null,`Previous layout not found for panel index ${u}`),W(w,m)){const z=v-w;he(z,Math.abs(e))>0&&(e=e<0?0-z:z)}}}{const u=e<0?l:c,f=n[u];$(f,`No panel constraints found for index ${u}`);const{collapsedSize:m=0,collapsible:x,minSize:v=0}=f;if(x){const w=t[u];if($(w!=null,`Previous layout not found for panel index ${u}`),W(w,v)){const z=w-m;he(z,Math.abs(e))>0&&(e=e<0?0-z:z)}}}}{const u=e<0?1:-1;let f=e<0?c:l,m=0;for(;;){const v=t[f];$(v!=null,`Previous layout not found for panel index ${f}`);const z=ye({panelConstraints:n,panelIndex:f,size:100})-v;if(m+=z,f+=u,f<0||f>=n.length)break}const x=Math.min(Math.abs(e),Math.abs(m));e=e<0?0-x:x}{let f=e<0?l:c;for(;f>=0&&f<n.length;){const m=Math.abs(e)-Math.abs(d),x=t[f];$(x!=null,`Previous layout not found for panel index ${f}`);const v=x-m,w=ye({panelConstraints:n,panelIndex:f,size:v});if(!W(x,w)&&(d+=x-w,o[f]=w,d.toFixed(3).localeCompare(Math.abs(e).toFixed(3),void 0,{numeric:!0})>=0))break;e<0?f--:f++}}if(ji(i,o))return i;{const u=e<0?c:l,f=t[u];$(f!=null,`Previous layout not found for panel index ${u}`);const m=f+d,x=ye({panelConstraints:n,panelIndex:u,size:m});if(o[u]=x,!W(x,m)){let v=m-x,z=e<0?c:l;for(;z>=0&&z<n.length;){const C=o[z];$(C!=null,`Previous layout not found for panel index ${z}`);const E=C+v,L=ye({panelConstraints:n,panelIndex:z,size:E});if(W(C,L)||(v-=L-C,o[z]=L),W(v,0))break;e>0?z--:z++}}}const h=o.reduce((u,f)=>f+u,0);return W(h,100)?o:i}function $i({layout:e,panelsArray:t,pivotIndices:n}){let s=0,i=100,r=0,o=0;const l=n[0];$(l!=null,"No pivot index found"),t.forEach((u,f)=>{const{constraints:m}=u,{maxSize:x=100,minSize:v=0}=m;f===l?(s=v,i=x):(r+=v,o+=x)});const c=Math.min(i,100-r),d=Math.max(s,100-o),h=e[l];return{valueMax:c,valueMin:d,valueNow:h}}function Re(e,t=document){return Array.from(t.querySelectorAll(`[${H.resizeHandleId}][data-panel-group-id="${e}"]`))}function ln(e,t,n=document){const i=Re(e,n).findIndex(r=>r.getAttribute(H.resizeHandleId)===t);return i??null}function cn(e,t,n){const s=ln(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function Ci(e){return e instanceof HTMLElement?!0:typeof e=="object"&&e!==null&&"tagName"in e&&"getAttribute"in e}function dn(e,t=document){if(Ci(t)&&t.dataset.panelGroupId==e)return t;const n=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return n||null}function Ye(e,t=document){const n=t.querySelector(`[${H.resizeHandleId}="${e}"]`);return n||null}function Ni(e,t,n,s=document){var i,r,o,l;const c=Ye(t,s),d=Re(e,s),h=c?d.indexOf(c):-1,u=(i=(r=n[h])===null||r===void 0?void 0:r.id)!==null&&i!==void 0?i:null,f=(o=(l=n[h+1])===null||l===void 0?void 0:l.id)!==null&&o!==void 0?o:null;return[u,f]}function Ii({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:i,panelGroupElement:r,setLayout:o}){p.useRef({didWarnAboutMissingResizeHandle:!1}),pe(()=>{if(!r)return;const l=Re(n,r);for(let c=0;c<i.length-1;c++){const{valueMax:d,valueMin:h,valueNow:u}=$i({layout:s,panelsArray:i,pivotIndices:[c,c+1]}),f=l[c];if(f!=null){const m=i[c];$(m,`No panel data found for index "${c}"`),f.setAttribute("aria-controls",m.id),f.setAttribute("aria-valuemax",""+Math.round(d)),f.setAttribute("aria-valuemin",""+Math.round(h)),f.setAttribute("aria-valuenow",u!=null?""+Math.round(u):"")}}return()=>{l.forEach((c,d)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,i,r]),p.useEffect(()=>{if(!r)return;const l=t.current;$(l,"Eager values not found");const{panelDataArray:c}=l,d=dn(n,r);$(d!=null,`No group found for id "${n}"`);const h=Re(n,r);$(h,`No resize handles found for group id "${n}"`);const u=h.map(f=>{const m=f.getAttribute(H.resizeHandleId);$(m,"Resize handle element has no handle id attribute");const[x,v]=Ni(n,m,c,r);if(x==null||v==null)return()=>{};const w=z=>{if(!z.defaultPrevented)switch(z.key){case"Enter":{z.preventDefault();const C=c.findIndex(E=>E.id===x);if(C>=0){const E=c[C];$(E,`No panel data found for index ${C}`);const L=s[C],{collapsedSize:J=0,collapsible:R,minSize:N=0}=E.constraints;if(L!=null&&R){const O=Ne({delta:W(L,J)?N-J:J-L,initialLayout:s,panelConstraints:c.map(Q=>Q.constraints),pivotIndices:cn(n,m,r),prevLayout:s,trigger:"keyboard"});s!==O&&o(O)}}break}}};return f.addEventListener("keydown",w),()=>{f.removeEventListener("keydown",w)}});return()=>{u.forEach(f=>f())}},[r,e,t,n,s,i,o])}function Lt(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function un(e,t){const n=e==="horizontal",{x:s,y:i}=Xe(t);return n?s:i}function Ei(e,t,n,s,i){const r=n==="horizontal",o=Ye(t,i);$(o,`No resize handle element found for id "${t}"`);const l=o.getAttribute(H.groupId);$(l,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const d=un(n,e),h=dn(l,i);$(h,`No group element found for id "${l}"`);const u=h.getBoundingClientRect(),f=r?u.width:u.height;return(d-c)/f*100}function ki(e,t,n,s,i,r){if(Yt(e)){const o=n==="horizontal";let l=0;e.shiftKey?l=100:i!=null?l=i:l=10;let c=0;switch(e.key){case"ArrowDown":c=o?0:l;break;case"ArrowLeft":c=o?-l:0;break;case"ArrowRight":c=o?l:0;break;case"ArrowUp":c=o?0:-l;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:Ei(e,t,n,s,r)}function Ri({panelDataArray:e}){const t=Array(e.length),n=e.map(r=>r.constraints);let s=0,i=100;for(let r=0;r<e.length;r++){const o=n[r];$(o,`Panel constraints not found for index ${r}`);const{defaultSize:l}=o;l!=null&&(s++,t[r]=l,i-=l)}for(let r=0;r<e.length;r++){const o=n[r];$(o,`Panel constraints not found for index ${r}`);const{defaultSize:l}=o;if(l!=null)continue;const c=e.length-s,d=i/c;s++,t[r]=d,i-=d}return t}function be(e,t,n){t.forEach((s,i)=>{const r=e[i];$(r,`Panel data not found for index ${i}`);const{callbacks:o,constraints:l,id:c}=r,{collapsedSize:d=0,collapsible:h}=l,u=n[c];if(u==null||s!==u){n[c]=s;const{onCollapse:f,onExpand:m,onResize:x}=o;x&&x(s,u),h&&(f||m)&&(m&&(u==null||ie(u,d))&&!ie(s,d)&&m(),f&&(u==null||!ie(u,d))&&ie(s,d)&&f())}})}function _e(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function Di({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:i,precision:r=3}){const o=n[i];let l;return o==null?l=e!=null?e.toFixed(r):"1":s.length===1?l="1":l=o.toFixed(r),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function Li(e,t=10){let n=null;return(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...i)},t)}}function Ft(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function fn(e){return`react-resizable-panels:${e}`}function pn(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:i,order:r}=t;return i?s:r?`${r}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function hn(e,t){try{const n=fn(e),s=t.getItem(n);if(s){const i=JSON.parse(s);if(typeof i=="object"&&i!=null)return i}}catch{}return null}function Fi(e,t,n){var s,i;const r=(s=hn(e,n))!==null&&s!==void 0?s:{},o=pn(t);return(i=r[o])!==null&&i!==void 0?i:null}function Mi(e,t,n,s,i){var r;const o=fn(e),l=pn(t),c=(r=hn(e,i))!==null&&r!==void 0?r:{};c[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{i.setItem(o,JSON.stringify(c))}catch(d){console.error(d)}}function Mt({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((r,o)=>r+o,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(r=>`${r}%`).join(", ")}`);if(!W(s,100)&&n.length>0)for(let r=0;r<t.length;r++){const o=n[r];$(o!=null,`No layout data found for index ${r}`);const l=100/s*o;n[r]=l}let i=0;for(let r=0;r<t.length;r++){const o=n[r];$(o!=null,`No layout data found for index ${r}`);const l=ye({panelConstraints:t,panelIndex:r,size:o});o!=l&&(i+=o-l,n[r]=l)}if(!W(i,0))for(let r=0;r<t.length;r++){const o=n[r];$(o!=null,`No layout data found for index ${r}`);const l=o+i,c=ye({panelConstraints:t,panelIndex:r,size:l});if(o!==c&&(i-=c-o,n[r]=c,W(i,0)))break}return n}const Ai=100,Ie={getItem:e=>(Ft(Ie),Ie.getItem(e)),setItem:(e,t)=>{Ft(Ie),Ie.setItem(e,t)}},At={};function mn({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:i,id:r=null,onLayout:o=null,keyboardResizeBy:l=null,storage:c=Ie,style:d,tagName:h="div",...u}){const f=gt(r),m=p.useRef(null),[x,v]=p.useState(null),[w,z]=p.useState([]),C=zi(),E=p.useRef({}),L=p.useRef(new Map),J=p.useRef(0),R=p.useRef({autoSaveId:e,direction:s,dragState:x,id:f,keyboardResizeBy:l,onLayout:o,storage:c}),N=p.useRef({layout:w,panelDataArray:[],panelDataArrayChanged:!1});p.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),p.useImperativeHandle(i,()=>({getId:()=>R.current.id,getLayout:()=>{const{layout:g}=N.current;return g},setLayout:g=>{const{onLayout:P}=R.current,{layout:I,panelDataArray:S}=N.current,y=Mt({layout:g,panelConstraints:S.map(j=>j.constraints)});Lt(I,y)||(z(y),N.current.layout=y,P&&P(y),be(S,y,E.current))}}),[]),pe(()=>{R.current.autoSaveId=e,R.current.direction=s,R.current.dragState=x,R.current.id=f,R.current.onLayout=o,R.current.storage=c}),Ii({committedValuesRef:R,eagerValuesRef:N,groupId:f,layout:w,panelDataArray:N.current.panelDataArray,setLayout:z,panelGroupElement:m.current}),p.useEffect(()=>{const{panelDataArray:g}=N.current;if(e){if(w.length===0||w.length!==g.length)return;let P=At[e];P==null&&(P=Li(Mi,Ai),At[e]=P);const I=[...g],S=new Map(L.current);P(e,I,S,w,c)}},[e,w,c]),p.useEffect(()=>{});const O=p.useCallback(g=>{const{onLayout:P}=R.current,{layout:I,panelDataArray:S}=N.current;if(g.constraints.collapsible){const y=S.map(ne=>ne.constraints),{collapsedSize:j=0,panelSize:D,pivotIndices:K}=ue(S,g,I);if($(D!=null,`Panel size not found for panel "${g.id}"`),!ie(D,j)){L.current.set(g.id,D);const se=ge(S,g)===S.length-1?D-j:j-D,T=Ne({delta:se,initialLayout:I,panelConstraints:y,pivotIndices:K,prevLayout:I,trigger:"imperative-api"});_e(I,T)||(z(T),N.current.layout=T,P&&P(T),be(S,T,E.current))}}},[]),Q=p.useCallback((g,P)=>{const{onLayout:I}=R.current,{layout:S,panelDataArray:y}=N.current;if(g.constraints.collapsible){const j=y.map(Y=>Y.constraints),{collapsedSize:D=0,panelSize:K=0,minSize:ne=0,pivotIndices:se}=ue(y,g,S),T=P??ne;if(ie(K,D)){const Y=L.current.get(g.id),Pe=Y!=null&&Y>=T?Y:T,Ze=ge(y,g)===y.length-1?K-Pe:Pe-K,U=Ne({delta:Ze,initialLayout:S,panelConstraints:j,pivotIndices:se,prevLayout:S,trigger:"imperative-api"});_e(S,U)||(z(U),N.current.layout=U,I&&I(U),be(y,U,E.current))}}},[]),B=p.useCallback(g=>{const{layout:P,panelDataArray:I}=N.current,{panelSize:S}=ue(I,g,P);return $(S!=null,`Panel size not found for panel "${g.id}"`),S},[]),V=p.useCallback((g,P)=>{const{panelDataArray:I}=N.current,S=ge(I,g);return Di({defaultSize:P,dragState:x,layout:w,panelData:I,panelIndex:S})},[x,w]),b=p.useCallback(g=>{const{layout:P,panelDataArray:I}=N.current,{collapsedSize:S=0,collapsible:y,panelSize:j}=ue(I,g,P);return $(j!=null,`Panel size not found for panel "${g.id}"`),y===!0&&ie(j,S)},[]),M=p.useCallback(g=>{const{layout:P,panelDataArray:I}=N.current,{collapsedSize:S=0,collapsible:y,panelSize:j}=ue(I,g,P);return $(j!=null,`Panel size not found for panel "${g.id}"`),!y||he(j,S)>0},[]),F=p.useCallback(g=>{const{panelDataArray:P}=N.current;P.push(g),P.sort((I,S)=>{const y=I.order,j=S.order;return y==null&&j==null?0:y==null?-1:j==null?1:y-j}),N.current.panelDataArrayChanged=!0,C()},[C]);pe(()=>{if(N.current.panelDataArrayChanged){N.current.panelDataArrayChanged=!1;const{autoSaveId:g,onLayout:P,storage:I}=R.current,{layout:S,panelDataArray:y}=N.current;let j=null;if(g){const K=Fi(g,y,I);K&&(L.current=new Map(Object.entries(K.expandToSizes)),j=K.layout)}j==null&&(j=Ri({panelDataArray:y}));const D=Mt({layout:j,panelConstraints:y.map(K=>K.constraints)});Lt(S,D)||(z(D),N.current.layout=D,P&&P(D),be(y,D,E.current))}}),pe(()=>{const g=N.current;return()=>{g.layout=[]}},[]);const k=p.useCallback(g=>{let P=!1;const I=m.current;return I&&window.getComputedStyle(I,null).getPropertyValue("direction")==="rtl"&&(P=!0),function(y){y.preventDefault();const j=m.current;if(!j)return()=>null;const{direction:D,dragState:K,id:ne,keyboardResizeBy:se,onLayout:T}=R.current,{layout:Y,panelDataArray:Pe}=N.current,{initialLayout:Fe}=K??{},Ze=cn(ne,g,j);let U=ki(y,g,D,K,se,j);const vt=D==="horizontal";vt&&P&&(U=-U);const gn=Pe.map(yn=>yn.constraints),ze=Ne({delta:U,initialLayout:Fe??Y,panelConstraints:gn,pivotIndices:Ze,prevLayout:Y,trigger:Yt(y)?"keyboard":"mouse-or-touch"}),wt=!_e(Y,ze);(Zt(y)||en(y))&&J.current!=U&&(J.current=U,!wt&&U!==0?vt?st(g,U<0?nn:sn):st(g,U<0?an:rn):st(g,0)),wt&&(z(ze),N.current.layout=ze,T&&T(ze),be(Pe,ze,E.current))}},[]),A=p.useCallback((g,P)=>{const{onLayout:I}=R.current,{layout:S,panelDataArray:y}=N.current,j=y.map(Y=>Y.constraints),{panelSize:D,pivotIndices:K}=ue(y,g,S);$(D!=null,`Panel size not found for panel "${g.id}"`);const se=ge(y,g)===y.length-1?D-P:P-D,T=Ne({delta:se,initialLayout:S,panelConstraints:j,pivotIndices:K,prevLayout:S,trigger:"imperative-api"});_e(S,T)||(z(T),N.current.layout=T,I&&I(T),be(y,T,E.current))},[]),ee=p.useCallback((g,P)=>{const{layout:I,panelDataArray:S}=N.current,{collapsedSize:y=0,collapsible:j}=P,{collapsedSize:D=0,collapsible:K,maxSize:ne=100,minSize:se=0}=g.constraints,{panelSize:T}=ue(S,g,I);T!=null&&(j&&K&&ie(T,y)?ie(y,D)||A(g,D):T<se?A(g,se):T>ne&&A(g,ne))},[A]),te=p.useCallback((g,P)=>{const{direction:I}=R.current,{layout:S}=N.current;if(!m.current)return;const y=Ye(g,m.current);$(y,`Drag handle element not found for id "${g}"`);const j=un(I,P);v({dragHandleId:g,dragHandleRect:y.getBoundingClientRect(),initialCursorPosition:j,initialLayout:S})},[]),ce=p.useCallback(()=>{v(null)},[]),de=p.useCallback(g=>{const{panelDataArray:P}=N.current,I=ge(P,g);I>=0&&(P.splice(I,1),delete E.current[g.id],N.current.panelDataArrayChanged=!0,C())},[C]),xe=p.useMemo(()=>({collapsePanel:O,direction:s,dragState:x,expandPanel:Q,getPanelSize:B,getPanelStyle:V,groupId:f,isPanelCollapsed:b,isPanelExpanded:M,reevaluatePanelConstraints:ee,registerPanel:F,registerResizeHandle:k,resizePanel:A,startDragging:te,stopDragging:ce,unregisterPanel:de,panelGroupElement:m.current}),[O,x,s,Q,B,V,f,b,M,ee,F,k,A,te,ce,de]),Se={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return p.createElement(qe.Provider,{value:xe},p.createElement(h,{...u,children:t,className:n,id:r,ref:m,style:{...Se,...d},[H.group]:"",[H.groupDirection]:s,[H.groupId]:f}))}const xn=p.forwardRef((e,t)=>p.createElement(mn,{...e,forwardedRef:t}));mn.displayName="PanelGroup";xn.displayName="forwardRef(PanelGroup)";function ge(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function ue(e,t,n){const s=ge(e,t),r=s===e.length-1?[s-1,s]:[s,s+1],o=n[s];return{...t.constraints,panelSize:o,pivotIndices:r}}function _i({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){p.useEffect(()=>{if(e||n==null||s==null)return;const i=Ye(t,s);if(i==null)return;const r=o=>{if(!o.defaultPrevented)switch(o.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{o.preventDefault(),n(o);break}case"F6":{o.preventDefault();const l=i.getAttribute(H.groupId);$(l,`No group element found for id "${l}"`);const c=Re(l,s),d=ln(l,t,s);$(d!==null,`No resize element found for id "${t}"`);const h=o.shiftKey?d>0?d-1:c.length-1:d+1<c.length?d+1:0;c[h].focus();break}}};return i.addEventListener("keydown",r),()=>{i.removeEventListener("keydown",r)}},[s,e,t,n])}function bn({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:i,onBlur:r,onClick:o,onDragging:l,onFocus:c,onPointerDown:d,onPointerUp:h,style:u={},tabIndex:f=0,tagName:m="div",...x}){var v,w;const z=p.useRef(null),C=p.useRef({onClick:o,onDragging:l,onPointerDown:d,onPointerUp:h});p.useEffect(()=>{C.current.onClick=o,C.current.onDragging=l,C.current.onPointerDown=d,C.current.onPointerUp=h});const E=p.useContext(qe);if(E===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:L,groupId:J,registerResizeHandle:R,startDragging:N,stopDragging:O,panelGroupElement:Q}=E,B=gt(i),[V,b]=p.useState("inactive"),[M,F]=p.useState(!1),[k,A]=p.useState(null),ee=p.useRef({state:V});pe(()=>{ee.current.state=V}),p.useEffect(()=>{if(n)A(null);else{const xe=R(B);A(()=>xe)}},[n,B,R]);const te=(v=s?.coarse)!==null&&v!==void 0?v:15,ce=(w=s?.fine)!==null&&w!==void 0?w:5;p.useEffect(()=>{if(n||k==null)return;const xe=z.current;$(xe,"Element ref not attached");let Se=!1;return Si(B,xe,L,{coarse:te,fine:ce},(P,I,S)=>{if(!I){b("inactive");return}switch(P){case"down":{b("drag"),Se=!1,$(S,'Expected event to be defined for "down" action'),N(B,S);const{onDragging:y,onPointerDown:j}=C.current;y?.(!0),j?.();break}case"move":{const{state:y}=ee.current;Se=!0,y!=="drag"&&b("hover"),$(S,'Expected event to be defined for "move" action'),k(S);break}case"up":{b("hover"),O();const{onClick:y,onDragging:j,onPointerUp:D}=C.current;j?.(!1),D?.(),Se||y?.();break}}})},[te,L,n,ce,R,B,k,N,O]),_i({disabled:n,handleId:B,resizeHandler:k,panelGroupElement:Q});const de={touchAction:"none",userSelect:"none"};return p.createElement(m,{...x,children:e,className:t,id:i,onBlur:()=>{F(!1),r?.()},onFocus:()=>{F(!0),c?.()},ref:z,role:"separator",style:{...de,...u},tabIndex:f,[H.groupDirection]:L,[H.groupId]:J,[H.resizeHandle]:"",[H.resizeHandleActive]:V==="drag"?"pointer":M?"keyboard":void 0,[H.resizeHandleEnabled]:!n,[H.resizeHandleId]:B,[H.resizeHandleState]:V})}bn.displayName="PanelResizeHandle";function Ti({controls:e=[],main:t,sidebar:n,onCollapse:s}){const{position:i,moveSidebar:r}=as(),o=p.useRef(null),l=()=>{const x=o.current;x&&(x.isCollapsed()?x.expand():s?s():x.collapse())},[c,d]=p.useState(!1),{isMdDown:h}=bs(),u=h?"vertical":i,f=u==="horizontal"?20:3,m=u==="horizontal"?30:10;return a.jsx("div",{className:"h-full",children:a.jsxs(xn,{autoSaveId:"sidebar",direction:u,children:[a.jsx(lt,{id:"main",order:1,minSize:m,className:"relative",children:a.jsx("div",{className:"h-full overflow-auto",children:t})}),n&&a.jsxs(a.Fragment,{children:[a.jsx(bn,{className:q("border-primary relative flex items-center justify-center",u==="horizontal"?"border-l-1":"border-t-1"),children:a.jsx("div",{className:"absolute inset-0 -m-2"})}),a.jsx(lt,{id:"sidebar",order:2,defaultSize:50,minSize:f,className:"bg-primary min-h-[50px] min-w-[58px] flex-shrink-0 overflow-hidden md:pt-4",collapsible:!0,collapsedSize:f,ref:o,onCollapse:()=>d(!0),onExpand:()=>d(!1),children:a.jsxs("div",{className:"flex h-full flex-col gap-4",children:[a.jsx("div",{className:"hidden px-4 lg:block",children:a.jsx(Hi,{moveSidebar:r,collapseSidebar:l,controls:e,position:u,collapsed:c})}),a.jsx("div",{className:"flex min-h-0 flex-1 flex-col overflow-auto",children:a.jsx("div",{className:"h-full pt-4 md:pt-0",children:n})})]})})]})]})})}function Hi({moveSidebar:e,collapseSidebar:t,controls:n,position:s,collapsed:i}){return a.jsxs("div",{className:"text-action-tertiary flex items-center justify-between gap-x-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Ae,{tooltip:i?"Expand sidebar":"Collapse sidebar",variant:"tertiary",size:"sm",icon:s==="horizontal"?i?"chevrons-left":"chevrons-right":i?"chevrons-up":"chevrons-down",onPress:t}),n.length>0&&a.jsx("div",{className:"border-primary ml-2 flex gap-2 border-l pl-2",children:n.map(r=>a.jsx(Ae,{tooltip:r.tooltip,variant:"tertiary",size:"sm",icon:r.icon,isDisabled:r.isDisabled,onPress:r.onPress},r.icon))})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Ae,{tooltip:"Move the sidebar to the right",variant:"tertiary",size:"sm",icon:"sidebar-right",onPress:()=>e("horizontal"),isDisabled:s==="horizontal"}),a.jsx(Ae,{tooltip:"Move the sidebar to the bottom",variant:"tertiary",size:"sm",icon:"sidebar-bottom",onPress:()=>e("vertical"),isDisabled:s==="vertical"})]})]})}const at=ts();function Ki({snapshot:e,vfsEntry:t,page:n,perPage:s,filters:i,onPageChange:r,onPathChange:o,onSnapshotChange:l,preview:c,onPreviewChange:d}){const h=Object.values(i).some(b=>b),u=Ge({...Yn({snapshot:e.identifier.Value,vfsEntry:t,page:n,perPage:s,search:h?{contentTypes:i.mime?.contentTypes,filename:i.filename}:void 0}),placeholderData:es}),f=p.useMemo(()=>[at.accessor("file_info.name",{header:()=>"Name",cell:({row:{original:b}})=>{const{mode:M,name:F}=b.file_info,k=M.isDir(),A=M.isRegular(),ee=M.isSymlink(),te=b.summary?.Total.errors??0,ce=k&&F!==".."&&te>0,de=ft.relative(t.path,b.parent_path);return a.jsxs("div",{className:"grid grid-cols-[auto_1fr] items-center gap-1",children:[a.jsxs("div",{className:"flex h-6 items-center",children:[k&&a.jsxs(a.Fragment,{children:[ce&&a.jsx(ae,{label:`${te} errors in this directory`,offset:4,children:a.jsx(G,{type:"md-error",size:"xl",className:"text-error",role:"button"})}),a.jsx(G,{type:"md-folder",size:"xl"})]}),A&&a.jsx(Jt,{contentType:b.object?.content_type}),ee&&a.jsx(G,{type:"md-link",size:"xl"})]}),k?a.jsx(_,{variant:"body",size:"sm",className:q("cursor-pointer text-left break-all hover:underline"),as:Ee,onPress:()=>{k&&o(b.path)},children:F}):a.jsx(_,{variant:"body",size:"sm",className:"break-all",as:"span",children:F}),de&&u.data?.isSearching&&a.jsx(_,{variant:"body",size:"xs",className:"text-tertiary col-start-2 w-fit cursor-pointer text-left break-all hover:underline",as:Ee,onPress:()=>{o(b.parent_path)},children:de})]})}}),at.display({id:"size",meta:{cellClassName:"md:w-[15%]"},header:()=>"Size",cell:({row:{original:b}})=>{if(b.file_info.name==="..")return;const F=b.file_info.mode.isDir()?b.summary?.Total.size:b.file_info.size,k=F?.Value?.toString()??"0",A=F?.Pretty,ee=b.weight.directory,te=ee>1?` (${ee.toFixed(0)}%)`:"";return a.jsx(ae,{label:`${k} bytes`,offset:4,children:a.jsx("span",{className:"inline-block",role:"button",children:a.jsxs(_,{variant:"body",size:"sm",className:"text-secondary w-fit whitespace-nowrap",children:[A,te]})})})}}),at.accessor("file_info.mod_time",{meta:{cellClassName:"md:w-[20%]"},header:()=>"Modified",cell:b=>{const M=b.getValue();if(!(b.row.original.file_info.name===".."||!M.toHumanString()))return a.jsx(ae,{label:M.Value,offset:4,children:a.jsx("span",{className:"inline-block",role:"button",children:a.jsx(_,{variant:"body",size:"sm",className:"text-secondary",children:M.toHumanString()})})})}})],[o,u.data?.isSearching,t.path]),m={pageIndex:n,pageSize:s},[x,v]=p.useState([]),w=x.reduce((b,M)=>(b[M.path]=!0,b),{}),z=ns({data:u.data?.items??[],rowCount:u.data&&Zn(u.data)?u.data.total:void 0,columns:f,state:{pagination:m,rowSelection:w},enableRowSelection:b=>b.original.file_info.name!=="..",onRowSelectionChange:b=>{const M=typeof b=="function"?b(w):b;v(F=>Object.keys(M).map(k=>F.find(A=>k===A.path)||u.data?.items.find(A=>k===A.path)).filter(k=>k!==void 0))},getRowId:b=>b.path,manualPagination:!0,onPaginationChange:b=>{const M=typeof b=="function"?b(m):b;r(M.pageIndex,M.pageSize)},getCoreRowModel:ss()}),C=u.data?.items??[],E=C.findIndex(b=>b.path===c),L=C.slice(E+1),J=E===-1?[]:C.slice(0,E).reverse(),R=L.findIndex(b=>!b.file_info.mode.isDir()),N=J.findIndex(b=>!b.file_info.mode.isDir()),O=R===-1,Q=N===-1,B=()=>{if(O)return;const b=C[E+1+R];b&&d(b.path)},V=()=>{if(Q)return;const b=C[E-N-1];b&&d(b.path)};return a.jsx(Ti,{main:a.jsx(xs,{title:t.file_info.name,isLoading:u.isFetching,children:a.jsxs("div",{className:q(x.length>0&&"mb-18"),children:[a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsx(Ls,{snapshot:e,childEntry:t,onSnapshotChange:l}),t.summary&&t.summary.Total.errors>0&&a.jsx(Ws,{snapshot:e,vfsEntry:t}),a.jsx(is,{query:u,table:z,softSelectionState:[C.find(b=>b.path===c)??null,b=>{b&&d(b.path)}],isSoftSelectionEnabledForRow:b=>!b.file_info.mode.isDir(),filters:a.jsx(Vs,{}),ariaLabel:"Snapshot files table",isLoading:u.isFetching})]}),x.length>0&&a.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 -translate-y-1/2",children:a.jsx(Us,{snapshot:e,childEntries:x,removeSelection:()=>v([])})})]})}),sidebar:c&&a.jsx(ci,{snapshot:e,path:c,onSnapshotChange:l}),controls:[{icon:"chevron-down",tooltip:"Next file",isDisabled:O,onPress:B},{icon:"chevron-up",tooltip:"Previous file",isDisabled:Q,onPress:V}],onCollapse:()=>d(void 0)})}function Vi({keys:e,action:t}){p.useEffect(()=>{const n=s=>{const i=s.target,r=i.tagName.toLowerCase();r==="input"||r==="textarea"||r==="select"||i.isContentEditable||e.includes(s.key)&&(s.preventDefault(),s.stopPropagation(),t(s.key))};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[e,t])}function ia(){const e=fe.useParams(),t=fe.useLoaderDeps(),n=fe.useSearch(),s=fe.useLoaderData(),i=fe.useNavigate(),r=rt.find(u=>u.id===n.mime),o=()=>i({to:"/snapshots"}),l=p.useCallback(u=>i({params:{snapshotId:e.snapshotId},search:f=>({...f,path:u,page:0})}),[i,e.snapshotId]),c=p.useCallback((u,f)=>i({search:m=>({...m,page:m.per_page!==f?0:u,per_page:f})}),[i]),d=p.useCallback(u=>{i({params:{snapshotId:u},search:f=>({...f,page:0})})},[i]),h=p.useCallback(u=>{i({params:{snapshotId:e.snapshotId},search:f=>({...f,preview:u}),replace:!0})},[i,e.snapshotId]);return Vi({keys:["Escape"],action:()=>{const u=ft.dirname(t.path);u===""||u==="/"||u.length<s.getSnapshotResponse.item.sources[0].importer.directory.Value.length?o():l(u+"/")}}),a.jsx(Ki,{snapshot:s.getSnapshotResponse.item,vfsEntry:s.getSnapshotPathResponse.item,page:n.page,perPage:n.per_page,filters:{mime:r,filename:n.filename},onPageChange:c,onPathChange:l,onSnapshotChange:d,preview:n.preview,onPreviewChange:h},e.snapshotId)}export{ia as component};
