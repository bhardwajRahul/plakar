import{j as e,aK as f,l as p,m as d,T as m,I as v,V as I,W as N,X as b,H as $,J as x,K as T,aL as A,P as g,U as k,a1 as h}from"./index-CdIc90l8.js";import{A as q}from"./alert-SgQz-3jM.js";import{u as C}from"./useQuery-BzyMkyU9.js";import{A as S}from"./proxy.account.me-CFcDkCU0.js";function H({name:s="<name>",version:a="<version>",os:t="<os>",arch:i="<arch>"}){return e.jsxs(q,{title:"Login is required to install pre-built integrations",variant:"warning",actions:e.jsx(p,{variant:"secondary",href:{to:"/login",search:{returnUrl:"/integrations"}},children:"Login"}),children:[e.jsx("p",{children:"To make your life easier, we host pre-built integrations for various systems that can be installed in one click directly from the UI (login required)."}),e.jsx("p",{className:"mt-2",children:"Alternatively, you can build and install integrations manually with the CLI."}),e.jsx("div",{className:"mt-2",children:e.jsxs(f,{title:"Build & Install integration with the CLI",children:[e.jsx(f.Command,{prompt:"$ ",command:`plakar pkg build ${s}`}),e.jsx(f.Command,{prompt:"$ ",command:`plakar pkg add ./${s}_${a}_${t}_${i}.ptar`})]})})]})}function P({stage:s}){const t={stable:"green",testing:"blue",beta:"yellow",devel:"red"}[s]??"red";return e.jsx(d,{variant:t,size:"sm",children:s})}function _({icon:s,name:a,version:t,stage:i,installationStatus:n,types:r,tags:c,description:o,documentationProps:l,onInstall:y,onRemove:E,pending:u}){return e.jsxs("div",{className:"border-primary bg-primary flex flex-col gap-4 rounded-xl border p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsx("div",{className:"bg-tertiary h-11 w-11 shrink-0 rounded-lg p-2",children:e.jsx("img",{src:s,className:"h-full w-full object-cover object-center",alt:""})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(m,{as:"h2",variant:"heading",weight:"medium",size:"sm",className:"text-primary break-all leading-none",children:a}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"text-tertiary break-all leading-none",children:t}),e.jsx(P,{stage:i})]})]}),(l!==void 0||n!=="not-installed")&&e.jsx("div",{className:"ml-auto",children:e.jsx(w,{status:n,onInstall:y,pending:u})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.storage&&e.jsx(d,{variant:"default",radius:"sqrt",children:"Storage"}),r.source&&e.jsx(d,{variant:"default",radius:"sqrt",children:"Source"}),r.destination&&e.jsx(e.Fragment,{children:e.jsx(d,{variant:"default",radius:"sqrt",children:"Destination"})}),c.map(j=>e.jsx(d,{variant:"transparent",radius:"rounded",children:j},j))]}),e.jsx(m,{className:"text-secondary overflow-auto",size:"sm",children:o})]}),e.jsxs("div",{className:"mt-auto flex gap-2 text-center",children:[l&&e.jsx(p,{variant:"secondary",className:"flex-1",...l,children:"Read documentation"}),!l&&n==="not-installed"&&e.jsx(w,{status:n,onInstall:y,pending:u}),n==="installed"&&e.jsx(p,{variant:"tertiary",className:"ml-auto",leftIcon:"trash",onPress:E,isDisabled:u,isPending:u,children:"Remove"})]})]})}function w({status:s,onInstall:a,pending:t}){return{installed:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{type:"success-circle",size:"md",className:"text-accent"}),e.jsx(m,{weight:"medium",size:"sm",className:"text-accent",children:"Installed"})]}),"not-installed":e.jsx(p,{leftIcon:"download",isDisabled:!a||t,onPress:a,isPending:t,className:"w-full",children:"Install"}),"built-in":e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{type:"success-circle",size:"md",className:"text-accent"}),e.jsx(m,{weight:"medium",size:"sm",className:"text-accent",children:"Built-in"})]})}[s]}const D=x({status:A(["ok","failed"]),messages:T(x({date:g().transform(Date),message:g()}))});async function Q({integrationId:s}){let a;const t=`/api/integrations/${s}`,i=await $(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});try{a=await i.json()}catch{throw new Error(`the API endpoint ${t} returned HTTP/${i.status} with an invalid JSON payload`)}let n;try{n=D.parse(a)}catch(r){throw new Error(`Failed to parse ${t} response: ${r}`)}if(n.status==="failed")throw new Error(n.messages.map(r=>r.message).join(`
`));return n}function z(){const s=I();return N({mutationFn:async a=>{if((await s.ensureQueryData(b())).demo_mode)throw new Error("It is not possible to remove integrations in demo mode.");return Q(a)},onSettled:async()=>{s.invalidateQueries({queryKey:["api","api.plakar.io","integrations"]})}})}const L=x({status:A(["ok","failed"]),messages:T(x({date:g().transform(k),message:g()}))});async function R({integrationId:s,version:a}){let t;const i="/api/integrations/install",n=await $(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,version:a})});try{t=await n.json()}catch{throw new Error(`the API endpoint ${i} returned HTTP/${n.status} with an invalid JSON payload`)}let r;try{r=L.parse(t)}catch(c){throw new Error(`Failed to parse ${i} response: ${c}`)}if(r.status==="failed")throw new Error(r.messages.map(c=>c.message).join(`
`));return r}function O(){const s=I();return N({mutationFn:async a=>{if((await s.ensureQueryData(b())).demo_mode)throw new Error("It is not possible to install integrations in demo mode.");return R(a)},onSettled:()=>{s.invalidateQueries({queryKey:["api","api.plakar.io","integrations"]})}})}function U({integration:s,installDisabled:a=!1,...t}){const i=O(),n=z(),r=!a&&s.installation.available?()=>{i.mutate({integrationId:s.id,version:s.latest_version},{onSuccess:({messages:o})=>{h({content:{children:o.map(l=>l.message).join(" - "),variant:"success"}})},onError:o=>{h({content:{children:o.message,variant:"error"}})}})}:void 0,c=()=>{n.mutate({integrationId:s.id},{onSuccess:({messages:o})=>{h({content:{children:o.map(l=>l.message).join(" - "),variant:"success"}})},onError:o=>{h({content:{children:o.message,variant:"error"}})}})};return e.jsx(_,{icon:s.icon,name:s.display_name,version:s.latest_version,stage:s.stage,installationStatus:s.installation.status,types:{source:s.types.source,destination:s.types.destination,storage:s.types.storage},tags:s.tags,description:s.description,onInstall:r,onRemove:c,pending:i.isPending||n.isPending,...t},s.id)}function M(){return{isAuthenticated:C(S()).data!==null}}export{H as I,U as a,M as u};
