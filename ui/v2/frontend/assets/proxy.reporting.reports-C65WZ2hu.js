import{ap as _,aq as M,ar as h,as as w,at as H,au as A,av as Y,aw as b,ax as q,ay as O,az as L,aA as v,aB as C,aC as P,q as U,C as z,E,F as x,H as $,J as I,K as j,O as k,P as m,U as T,aD as F,aE as u}from"./index-Aj8lmPfQ.js";function J(t,e,r){const n=_(t);return isNaN(e)?M(t,NaN):(e&&n.setDate(n.getDate()+e),n)}function K(t,e,r){const n=_(t);if(isNaN(e))return M(t,NaN);if(!e)return n;const s=n.getDate(),o=M(t,n.getTime());o.setMonth(n.getMonth()+e+1,0);const a=o.getDate();return s>=a?o:(n.setFullYear(o.getFullYear(),o.getMonth(),s),n)}function p(t,e,r){const{years:n=0,months:s=0,weeks:o=0,days:a=0,hours:c=0,minutes:i=0,seconds:l=0}=e,d=_(t),f=s||n?K(d,s+n*12):d,g=a||o?J(f,a+o*7):f,y=i+c*60,D=(l+y*60)*1e3;return M(t,+g+D)}function N(t,e){const r=_(t);return r.setHours(0,0,0,0),r}function W(t,e,r){const[n,s]=h(r?.in,t,e),o=N(n),a=N(s),c=+o-w(o),i=+a-w(a);return Math.round((c-i)/H)}function G(t,e,r){const[n,s]=h(r?.in,t,e);return n.getFullYear()-s.getFullYear()}function V(t,e,r){const[n,s]=h(r?.in,t,e),o=R(n,s),a=Math.abs(W(n,s));n.setDate(n.getDate()-o*a);const c=+(R(n,s)===-o),i=o*(a-c);return i===0?0:i}function R(t,e){const r=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return r<0?-1:r>0?1:r}function B(t,e,r){const[n,s]=h(r?.in,t,e),o=(+n-+s)/Y;return A(r?.roundingMethod)(o)}function Q(t,e,r){const n=b(t,e)/q;return A(r?.roundingMethod)(n)}function X(t,e,r){const[n,s]=h(r?.in,t,e),o=O(n,s),a=Math.abs(G(n,s));n.setFullYear(1584),s.setFullYear(1584);const c=O(n,s)===-o,i=o*(a-+c);return i===0?0:i}function Z(t,e){const[r,n]=h(t,e.start,e.end);return{start:r,end:n}}const tt=["years","months","weeks","days","hours","minutes","seconds"];function nt(t,e){const n=L().locale??v,s=e?.format??tt,o=" ";return n.formatDistance?s.reduce((c,i)=>{const l=`x${i.replace(/(^.)/,f=>f.toUpperCase())}`,d=t[i];return d!==void 0&&t[i]?c.concat(n.formatDistance(l,d)):c},[]).join(o):""}function et(t,e){const{start:r,end:n}=Z(e?.in,t),s={},o=X(n,r);o&&(s.years=o);const a=p(r,{years:s.years}),c=C(n,a);c&&(s.months=c);const i=p(a,{months:s.months}),l=V(n,i);l&&(s.days=l);const d=p(i,{days:s.days}),f=B(n,d);f&&(s.hours=f);const g=p(d,{hours:s.hours}),y=Q(n,g);y&&(s.minutes=y);const S=p(g,{minutes:s.minutes}),D=P(n,S);return D&&(s.seconds=D),s}function st(t){const e=et({start:0,end:t/1e6});return{Value:t,toHumanString:()=>{const r=nt(e);return r===""?"less than a second":r},toJSON(){return t}}}const rt=I({type:F([u("maintenance"),u("backup"),u("check"),u("restore"),u("sync"),u("rm"),u("unknown")]).catch("unknown").transform(t=>({Value:t,HumanString:{maintenance:"maintenance",backup:"backup",check:"check",restore:"restore",sync:"sync",rm:"remove",unknown:"unknown"}[t]})),name:m(),start_time:m().transform(T),duration:k().transform(st),status:F([u("OK"),u("FAILURE"),u("WARNING"),u("unknown")]).catch("unknown"),error_code:k(),error_message:m()}),ot=I({name:m()}),at=I({id:m(),timestamp:m().transform(T),report_task:rt,report_repository:ot}),it=I({total:k(),items:j(at)});async function ct({repository:t,pagination:e}){let r;const s=`/api/proxy/v1/reporting/reports?${new URLSearchParams({repository_id:t,reverse:"1",...z(e)})}`,o=await E(()=>$(s),x);if(o.error)return{__type:"unauthenticated"};try{r=await o.data.json()}catch{throw new Error(`the API endpoint ${s} returned HTTP/${o.data.status} with an invalid JSON payload`)}return{__type:"ok",...it.parse(r)}}const dt=({repository:t,page:e,perPage:r})=>U({queryKey:["api","api.plakar.io","reporting","reports_list",t,e,r],refetchInterval:60*1e3,queryFn:async()=>ct({repository:t,pagination:{page:e,perPage:r}})});export{dt as R};
